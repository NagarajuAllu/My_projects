<?xml version="1.0" encoding="UTF-8" ?>
<script name="processSTC.generateJMSErrorMsgForNoResponse">
  <label>Generate JMS Error Message For No Response From Granite</label>
  <metaVersion>4</metaVersion>
  <parameterList>
    <parameter name="orderNumber" type="rifp">
      <type>dtype_com.conceptwave.system.String</type>
    </parameter>
    <parameter name="orderItem" type="rifp">
      <type>nmeta_com.conceptwave.system.Object</type>
    </parameter>
    <parameter name="isSubmit" type="rifp">
      <type>dtype_com.conceptwave.system.String</type>
    </parameter>
    <parameter name="provisioningProcessId" type="rifp">
      <type>dtype_cwf_pm.PROCESS_ID</type>
    </parameter>
  </parameterList>
  <script><![CDATA[
    // generate error ack to avoid to put process in error status due too many iterations
    var inputJMS = new DataStructure("ds_jms.orderAcknowledgementWithFailure_el");
    inputJMS.crmOrderNumber = orderNumber;
    inputJMS.workOrderNumber = orderItem.workOrderNumber;
    inputJMS.lineItemIdentifier = orderItem.lineItemIdentifier;
    inputJMS.status = "Rejected";
    inputJMS.xngOrderNumber = null;

    var failure = new DataStructure("ds_jms.failure");
    failure.errorCode = "AE0041";
    failure.errorDescription = Global.translateText("AE0041");
    failure.errorTime = common.common_currentDateAsStringDDMMYYYYHH24MISS();
    failure.errorType = "Functional";
    failure.systemName = "Expediter";

    inputJMS.failure[0] = failure;

    if(provisioningProcessId != null) {
        var operation = "ifGranite_jms.XngServicesNotificationToProcesses/UpdateOrder";
        if(isSubmit != null && isSubmit == "Y") {
            operation = "ifGranite_jms.XngServicesNotificationToProcesses/SubmitOrder";
        }
        Process.sendMessageToProcess(provisioningProcessId, null, operation, inputJMS);
    }
    else {
        ifGranite_jms.manageGraniteMsg_SubmitUpdateOrderResponse(inputJMS);
    }
  ]]></script>
</script>