<?xml version="1.0" encoding="UTF-8" ?>
<script filenameHash="7c85c6dc4ec52d861507c774ebe0815e" versionHash="a87ff679a2f3e71d9181a67b7542122c" name="processSTC.generateWONumber">
  <label>Generate WO Number</label>
  <metaVersion>4</metaVersion>
  <parameterList>
    <parameter name="orderItem" type="rifp">
      <type>nmeta_com.conceptwave.system.Object</type>
    </parameter>
    <parameter name="workOrderType" type="rifp">
      <type>dtype_com.conceptwave.system.String</type>
    </parameter>
    <parameter name="bundleOrder" type="rifp">
      <type>order_com.conceptwave.system.Order</type>
    </parameter>
  </parameterList>
  <script><![CDATA[
    var woNumber = null;

    if(orderItem.elementTypeInOrderTree == "B") {
        // it's a bundle lineItem
        if(bundleOrder.orderHeader.orderType == "F" && orderItem.action == "D") {
            // in case the action of the feasibility is "D" - it means OM received a Cancel on a COMPLETED feasibility,
            // OM has to generate a disconnect workOrder in Granite
            woNumber = processSTC.getNewChildOrderNumber("O");
        }
        else {
            // check if it's a legacy order
            var isLegacyService = ds_ws.isLegacyService(orderItem.parentOrderItem);
            if(isLegacyService) {
                // in case of legacy order, generate WO with the same CRM orderNumber
                woNumber = bundleOrder.orderHeader.orderNumber;
            }
            else {
                woNumber = processSTC.getNewChildOrderNumber(workOrderType);
            }
        }
    }
    else {
        woNumber = processSTC.getNewChildOrderNumber(workOrderType);
    }

    return woNumber;
  ]]></script>
</script>