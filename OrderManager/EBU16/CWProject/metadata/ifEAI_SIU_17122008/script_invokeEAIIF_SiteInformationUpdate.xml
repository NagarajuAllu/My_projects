<?xml version="1.0" encoding="UTF-8" ?>
<script filenameHash="a4bd2773bd4570f449060999d4863c02" versionHash="eccbc87e4b5ce2fe28308fd9f2a7baf3" name="ifEAI_SIU_17122008.invokeEAIIF_SiteInformationUpdate">
  <guid>{072d7abb-9bc6-bae8-1a2b-21f8d7122976}</guid>
  <label>Invoke EAI Interface: Site Information Update [SOAP]</label>
  <metaVersion>3</metaVersion>
  <parameterList>
    <parameter name="input" type="rifp">
      <type>nmeta_com.conceptwave.system.Object</type>
    </parameter>
  </parameterList>
  <script><![CDATA[
    var debug = "[INVOKE EAI INTERFACE VIA 'SOAP': SITE INFORMATION UPDATE] ";
    debugPrintln("[" + common.common_currentDateAsStringDDMMYYYYHH24MISS() + "]" + debug + "START...");
    debugPrintln("[" + common.common_currentDateAsStringDDMMYYYYHH24MISS() + "]" + debug + "INPUT: " + (input != null ? input.toXML() : "") + "...");

          var output = null;
          var resultType = null;
          try {
    debugPrintln("[" + common.common_currentDateAsStringDDMMYYYYHH24MISS() + "]" + debug + "INVOKING INTERFACE...");
                output = Global.invokeInterface("ifEAI_SIU_17122008:SIU",
                                                                "receiveRequest",
                                                                input);
    debugPrintln("[" + common.common_currentDateAsStringDDMMYYYYHH24MISS() + "]" + debug + "RESULT: " + output + "...");

                resultType = "OK";
          }
          catch (exc){
    debugPrintln("[" + common.common_currentDateAsStringDDMMYYYYHH24MISS() + "]" + debug + "EXCEPTION: " + exc);
              resultType = exc.message;
          }


          var resultMsg = (resultType == "OK" ? "SUCCESS" : "FAILURE");
          var errorType = resultType;
          var errorDescription = null;
          if(resultType == "OK" && output != null) {
              resultMsg = output[0].Status;
              errorType = output[0].ErrorType;
              errorDescription = output[0].ErrorDescription;
          }

          var now = new Date();
          var eventId = now.getFullYear().toString().substring(2) +
                        now.getMonth().toString().leftPad(2, "0") +
                        now.getDate().toString().leftPad(2, "0") +
                        now.getHours().toString().leftPad(2, "0") +
                        now.getMinutes().toString().leftPad(2, "0") +
                        now.getSeconds().toString().leftPad(2, "0") +
                        now.getMilliseconds().toString().leftPad(3, "0");

          // saving siuInfoForReport
          graniteReport.storeSIUInfoForReport(eventId,
                                              now,
                                              input.SiteInformationUpdate.PlateID,
                                              input.SiteInformationUpdate.SiteID,
                                              resultMsg,
                                              errorType,
                                              errorDescription);

    debugPrintln("[" + common.common_currentDateAsStringDDMMYYYYHH24MISS() + "]" + debug + "END...");
          return output;
  ]]></script>
</script>