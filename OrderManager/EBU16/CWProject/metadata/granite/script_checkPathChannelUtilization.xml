<?xml version="1.0" encoding="UTF-8" ?>
<script filenameHash="e5bc59bfb64c6bcdb351fb296a2e4dde" versionHash="a87ff679a2f3e71d9181a67b7542122c" name="granite.checkPathChannelUtilization">
  <label>Check Path Channel Utilization</label>
  <metaVersion>4</metaVersion>
  <parameterList>
    <parameter name="pathName" type="rifp">
      <type>dtype_com.conceptwave.system.String</type>
    </parameter>
  </parameterList>
  <script><![CDATA[
    var validationErrors = null;

    if(pathName != null) {
        var finderPathChannelUtilization = new Finder("granite.findPathChannelUtilization");
        finderPathChannelUtilization.searchDocument.CIRC_PATH_HUM_ID = pathName;

        var pathChannelUtilizationResultList = finderPathChannelUtilization.search();
        if(pathChannelUtilizationResultList != null && pathChannelUtilizationResultList.length > 0) {
            var alreadyFoundStatus = null;
            var errorCode = "AE0116";
            for(var i=0; i<pathChannelUtilizationResultList.length; i++) {
                var memberPathStatus = pathChannelUtilizationResultList[i].MEMBER_PATH_STATUS;
                var nextPathStatus = pathChannelUtilizationResultList[i].NEXT_PATH_STATUS;

                if(memberPathStatus != null) {
                    if(memberPathStatus == "TEMP DISCONNECT") {
                        memberPathStatus = "SUSPENDED";
                    }

                    if(alreadyFoundStatus == null) {
                        alreadyFoundStatus = memberPathStatus;
                    }
                    else {
                        if(alreadyFoundStatus != memberPathStatus) {
                            errorCode = "AE0117";
                        }
                    }
                }
                else {
                    if(nextPathStatus != null) {
                        if(nextPathStatus == "TEMP DISCONNECT") {
                            nextPathStatus = "SUSPENDED";
                        }

                        if(alreadyFoundStatus == null) {
                            alreadyFoundStatus = nextPathStatus;
                        }
                        else {
                            if(alreadyFoundStatus != nextPathStatus) {
                                errorCode = "AE0117";
                            }
                        }
                    }
                }
            }

            validationErrors = [errorCode, Global.translateText(errorCode, null, alreadyFoundStatus)];
        }
    }

    return validationErrors;
  ]]></script>
</script>