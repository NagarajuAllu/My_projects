<?xml version="1.0" encoding="UTF-8" ?>
<script name="ds_ws.archiveExistingOrderDueToUpdate">
  <label>Archive Existing Order Due To Update</label>
  <metaVersion>4</metaVersion>
  <parameterList>
    <parameter name="existingOrder" type="rifp">
      <type>order_ds_ws.bundleOrderSTC</type>
    </parameter>
    <parameter name="isCancel" type="rifp">
      <type>dtype_com.conceptwave.system.Boolean</type>
    </parameter>
  </parameterList>
  <script><![CDATA[
    var newOrderNumber = existingOrder.orderHeader.orderNumber + (isCancel ? "_CANC_" : "_REVI_") + common.common_currentDateAsString("yyyyMMddHHmm");

    existingOrder.orderHeader.orderNumber = newOrderNumber;

    if(existingOrder.bundles != null) {
        for(var i=0; i<existingOrder.bundles.length; i++) {
            existingOrder.bundles[i].bundle.provisioningFlag = "OLD";
        }
    }

    existingOrder.save();

    processSTC.updateOrchestrationRecordsForNewOrderNumber(existingOrder, newOrderNumber);
  ]]></script>
</script>