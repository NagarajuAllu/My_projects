<?xml version="1.0" encoding="UTF-8" ?>
<script filenameHash="57a97a857abd7070c0a99df1ea22e654" versionHash="a87ff679a2f3e71d9181a67b7542122c" name="ds_ws.generateInputDataForGraniteValidationWS">
  <label>Generate Input Data For Granite ValidationWS</label>
  <metaVersion>4</metaVersion>
  <parameterList>
    <parameter name="bundleOrder" type="rifp">
      <type>order_ds_ws.bundleOrderSTC</type>
    </parameter>
  </parameterList>
  <script><![CDATA[
    var validationItemArray = null;

    for(var i=0; i<bundleOrder.bundles.length; i++) {
        var bundleContainer = bundleOrder.bundles[i];

        if(ds_ws.isLegacyService(bundleContainer)) {
            checkAndAppendInputDataForLineItem_(bundleContainer.bundle);
        }
        else {
            if(bundleContainer.circuits != null) {
                for(var j=0; j<bundleContainer.circuits.length; j++) {
                    var circuitContainer = bundleContainer.circuits[j];
                    checkAndAppendInputDataForLineItem_(circuitContainer.circuit);

                    if(circuitContainer.services != null) {
                        for(var l=0; l<circuitContainer.services.length; l++) {
                            var serviceContainer = circuitContainer.services[l];
                            checkAndAppendInputDataForLineItem_(serviceContainer.service);

                            if(serviceContainer.subServices != null) {
                                for(var m=0; m<serviceContainer.subServices.length; m++) {
                                    var subServiceContainer = serviceContainer.subServices[m];
                                    checkAndAppendInputDataForLineItem_(subServiceContainer.subService);
                                }
                            }
                        }
                    }
                }
            }
        }
    }

    return validationItemArray;


    function checkAndAppendInputDataForLineItem_(lineItem) {
        if(ds_ws.checkIfServiceTypeRequiresExternalValidation(lineItem.serviceType)) {
            if(validationItemArray == null) {
                validationItemArray = new Array();
            }

            var validationItem = new DataStructure("ifCIM_E_ws.validationItem");
            validationItem.bwName = lineItem.bandwidth;
            validationItem.siteACCLICode = lineItem.locationACCLICode;
            validationItem.siteAPlateID = lineItem.locationAPlateID;
            validationItem.siteAOldPlateID = lineItem.locationAOldPlateID;
            validationItem.siteZCCLICode = lineItem.locationBCCLICode;
            validationItem.siteZPlateID = lineItem.locationBPlateID;
            validationItem.siteZOldPlateID = lineItem.locationBOldPlateID;
            validationItem.serviceType = lineItem.serviceType;
            validationItem.workOrderType = processSTC.getWorkOrderType(bundleOrder.orderHeader.orderType, lineItem.action);
            validationItem.lineItemIdentifier = lineItem.lineItemIdentifier;
            validationItem.serviceNumber = lineItem.serviceNumber;
            validationItemArray.push(validationItem);
        }
    }
  ]]></script>
</script>