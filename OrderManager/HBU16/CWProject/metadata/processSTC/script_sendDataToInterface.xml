<?xml version="1.0" encoding="UTF-8" ?>
<script name="processSTC.sendDataToInterface">
  <label>Send Data To Interface</label>
  <metaVersion>3</metaVersion>
  <parameterList>
    <parameter name="inputData" type="rifp">
      <type>nmeta_com.conceptwave.system.Object</type>
    </parameter>
    <parameter name="interfaceName" type="rifp">
      <type>dtype_com.conceptwave.system.String</type>
    </parameter>
    <parameter name="operationName" type="rifp">
      <type>dtype_com.conceptwave.system.String</type>
    </parameter>
    <parameter name="existResult" type="rifp">
      <mandatory>true</mandatory>
      <type>dtype_com.conceptwave.system.Boolean</type>
    </parameter>
    <parameter name="processId" type="rifp">
      <type>dtype_cwf_pm.PROCESS_ID</type>
    </parameter>
    <parameter name="operationDescription" type="rifp">
      <type>dtype_com.conceptwave.system.String</type>
    </parameter>
    <parameter name="userData1ValueForLog" type="rifp">
      <type>dtype_com.conceptwave.system.String</type>
    </parameter>
    <parameter name="userData2ValueForLog" type="rifp">
      <type>dtype_com.conceptwave.system.String</type>
    </parameter>
  </parameterList>
  <script><![CDATA[
    var debugHeader = "[" + processId + "] " + operationDescription + " - ";
    var result = null;

    try {
    debugPrintln("[" + ds_ws.common_currentDateAsStringDDMMYYYYHH24MISS() + "]" + debugHeader + "Sending: " + inputData.toXML());
        var outputInvokeIF = Global.invokeInterface(interfaceName,
                                                    operationName,
                                                    inputData);

        var logMsgId = UserProfile.getMsgLogId();
    debugPrintln("[" + ds_ws.common_currentDateAsStringDDMMYYYYHH24MISS() + "]" + debugHeader + "Adding UserData_1 = " + userData1ValueForLog + " to id = " + logMsgId);

        UserProfile.setMsgLogData(userData1ValueForLog, userData2ValueForLog, null, logMsgId);

        if(existResult) {
            if(outputInvokeIF != null && outputInvokeIF.length == 1) {
                result = outputInvokeIF[0];

    debugPrintln("[" + ds_ws.common_currentDateAsStringDDMMYYYYHH24MISS() + "]" + debugHeader + "RESULT: " + result.toXML() + "...");
            }
        }
        else {
            // workaround to fix the following issue: in case there is no response in the operation and there is a communication issue, the error is returned as result
            if(outputInvokeIF != null && outputInvokeIF.length > 0) {
                if(! (outputInvokeIF[0] instanceof DataStructure)) {
    debugPrintln("[" + ds_ws.common_currentDateAsStringDDMMYYYYHH24MISS() + "]" + debugHeader + "found exception in response: " + outputInvokeIF[0] + "...");
                    Global.rethrowException(outputInvokeIF[0]);
                }
            }
        }
    }
    catch (exc){
    debugPrintln("[" + ds_ws.common_currentDateAsStringDDMMYYYYHH24MISS() + "]" + debugHeader + "EXCEPTION: " + exc.message);

        if(exc.message.indexOf("XE0023") >= 0) {
            Global.logDebug(debugHeader + "I/F " + interfaceName + ": getDelay = " + Global.getInterfaceDelay(interfaceName));
    debugPrintln("[" + ds_ws.common_currentDateAsStringDDMMYYYYHH24MISS() + "]" + debugHeader + "I/F " + interfaceName + ": getDelay = " + Global.getInterfaceDelay(interfaceName));
        }
        else if(exc.message.indexOf("XE0002") >= 0) {
            Global.logDebug(debugHeader + "I/F " + interfaceName + ": caught Interface Error XE0002");
    debugPrintln("[" + ds_ws.common_currentDateAsStringDDMMYYYYHH24MISS() + "]" + debugHeader + "I/F " + interfaceName + ": caught Interface Error XE0002");
        }

        Global.rethrowException(exc);
    }

    return result;
  ]]></script>
</script>