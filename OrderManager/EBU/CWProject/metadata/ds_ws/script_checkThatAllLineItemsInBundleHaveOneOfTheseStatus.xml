<?xml version="1.0" encoding="UTF-8" ?>
<script filenameHash="4a993953839576db99214d54eb602ab6" versionHash="a87ff679a2f3e71d9181a67b7542122c" name="ds_ws.checkThatAllLineItemsInBundleHaveOneOfTheseStatus">
  <label>Check That All LineItems In Bundle Have One Of These Status</label>
  <metaVersion>4</metaVersion>
  <parameterList>
    <parameter name="lineItemExpectedStatusArray" type="rifp">
      <type>nmeta_com.conceptwave.system.Object</type>
    </parameter>
    <parameter name="lineItemParent" type="rifp">
      <type>doc_ds_ws.lineItemDocument</type>
    </parameter>
    <parameter name="bundleOrder" type="rifp">
      <type>order_ds_ws.bundleOrderSTC</type>
    </parameter>
    <parameter name="considerOnlyProvisionable" type="rifp">
      <type>dtype_com.conceptwave.system.Boolean</type>
    </parameter>
  </parameterList>
  <script><![CDATA[
    debugPrintln("[" + common.common_currentDateAsStringDDMMYYYYHH24MISS() + "] checkThatAllLineItemsInBundleHaveOneOfTheseStatus([" + lineItemExpectedStatusArray + "]," + lineItemParent + ")");

    var sameStatus = true;
    var orchestrationRecordForChildLineItems = processSTC.findRecordsInOrchTabByOrderId_ParentId(bundleOrder.id, lineItemParent.id);
    if(orchestrationRecordForChildLineItems != null && orchestrationRecordForChildLineItems.length > 0) {
        for(var i=0; i<orchestrationRecordForChildLineItems.length && sameStatus; i++) {
            var orchestrationRecord = orchestrationRecordForChildLineItems[i];
            var lineItem = Document.readDoc("ds_ws:lineItemDocument", orchestrationRecordForChildLineItems[i].cwDocId);

            if(orchestrationRecord.provisionable || !considerOnlyProvisionable) {
                var found = false;
                for(var j=0; j<lineItemExpectedStatusArray.length && !found; j++) {
                    found = (lineItem.lineItemStatus.toUpperCase() == lineItemExpectedStatusArray[j].toUpperCase());
                }
                sameStatus = found;
            }
            else {
                sameStatus = true;
            }

            if(sameStatus) {
                // loop for children of the record
                sameStatus = ds_ws.checkThatAllLineItemsInBundleHaveOneOfTheseStatus(lineItemExpectedStatusArray, lineItem, bundleOrder, considerOnlyProvisionable);
            }
        }
    }

    debugPrintln("[" + common.common_currentDateAsStringDDMMYYYYHH24MISS() + "] checkThatAllLineItemsInBundleHaveOneOfTheseStatus([" + lineItemExpectedStatusArray + "]," + lineItemParent + "): " + sameStatus);
    return sameStatus;
  ]]></script>
</script>