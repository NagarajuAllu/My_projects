<?xml version="1.0" encoding="UTF-8" ?>
<script filenameHash="230c67366a332c7e4809bcd99a10aedb" versionHash="a87ff679a2f3e71d9181a67b7542122c" name="ds_ws.performFullValidationOnSubService">
  <label>Perform Full Validation On SubService</label>
  <metaVersion>4</metaVersion>
  <parameterList>
    <parameter name="subServiceContainer" type="rifp">
      <type>nmeta_com.conceptwave.system.Object</type>
    </parameter>
    <parameter name="failureArray" type="rifp">
      <type>nmeta_com.conceptwave.system.Object</type>
    </parameter>
    <parameter name="orderType" type="rifp">
      <type>dtype_ds_ws.orderType</type>
    </parameter>
    <parameter name="orderStatus" type="rifp">
      <type>dtype_com.conceptwave.system.String</type>
    </parameter>
    <parameter name="parentLineItemAction" type="rifp">
      <type>dtype_com.conceptwave.system.String</type>
    </parameter>
    <parameter name="parentLineItemStatus" type="rifp">
      <type>dtype_com.conceptwave.system.String</type>
    </parameter>
    <parameter name="bundleLineItemActive" type="rifp">
      <type>nmeta_com.conceptwave.system.Object</type>
    </parameter>
    <parameter name="isSubmit" type="rifp">
      <type>dtype_com.conceptwave.system.Boolean</type>
    </parameter>
  </parameterList>
  <script><![CDATA[
    // subService
    failureArray = ds_ws.validateElementOfOrder(subServiceContainer.subService, subServiceContainer.subService.lineItemIdentifier, isSubmit, failureArray);

    // mandatory attributes according to OrderType and ServiceType
    failureArray  = ds_ws.performValidationOfMandatoryAttributesInLineItem(subServiceContainer.subService, orderType, subServiceContainer.subService.serviceType, subServiceContainer.subService.lineItemIdentifier, isSubmit, failureArray);

    if(!ds_ws.checkIfActionIsOKWithOrderTypeAndParentAction(orderType, orderStatus, parentLineItemAction, parentLineItemStatus, subServiceContainer.subService.action, subServiceContainer.subService.serviceType, subServiceContainer.subService.lineItemStatus)) {
        var validationError = ["AE0043", Global.translateText("AE0043", null, [orderType, parentLineItemAction, subServiceContainer.subService.action, orderStatus])];
    debugPrintln("[" + common.common_currentDateAsStringDDMMYYYYHH24MISS() + "] performFullValidationOnSubService (" + subServiceContainer.subService.lineItemIdentifier + "): Found error [" + validationError + "]");
        failureArray = ds_ws.addValidationErrorsToFailureArrayForSub_UpdInWD(validationError, subServiceContainer.subService.lineItemIdentifier, failureArray, isSubmit);
    }

    if(isSubmit) {
        // check lineItemIdentifier existance ds_ws.checkIfActionIsCorrectForLineItemIdentifier(bundleLineItemActive, lineItemToCheck)
        var validationError = ds_ws.checkIfActionIsCorrectForLineItemIdentifier(bundleLineItemActive, subServiceContainer.subService);
        if(validationError != null) {
            failureArray = ds_ws.addValidationErrorsToFailureArrayForSub_UpdInWD(validationError, subServiceContainer.subService.lineItemIdentifier, failureArray, isSubmit);
        }
    }


    // service NV pair
    if(subServiceContainer.subServiceParameters != null) {
        for(var i=0; i<subServiceContainer.subServiceParameters.length; i++) {
            failureArray = ds_ws.validateElementOfOrder(subServiceContainer.subServiceParameters[i], subServiceContainer.subService.lineItemIdentifier, isSubmit, failureArray);
            failureArray = ds_ws.validateNVPairValueForServiceTypeInPickList(subServiceContainer.subService.serviceType, subServiceContainer.subService.lineItemIdentifier,
                                                                             subServiceContainer.subServiceParameters[i].subServiceParameter.name, subServiceContainer.subServiceParameters[i].subServiceParameter.value,
                                                                             isSubmit, failureArray);
        }

        failureArray = ds_ws.performValidationOfMandatoryNVPairs(subServiceContainer.subServiceParameters, orderType, subServiceContainer.subService.serviceType, subServiceContainer.subService.lineItemIdentifier, isSubmit, failureArray);
    }

    // service Block NV pair
    if(subServiceContainer.subServiceBlockParameters != null) {
        for(var i=0; i<subServiceContainer.subServiceBlockParameters.length; i++) {
            failureArray = ds_ws.validateElementOfOrder(subServiceContainer.subServiceBlockParameters[i], subServiceContainer.subService.lineItemIdentifier, isSubmit, failureArray);
        }
    }


    return failureArray;
  ]]></script>
</script>