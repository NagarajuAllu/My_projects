<?xml version="1.0" encoding="UTF-8" ?>
<script filenameHash="ab1961c190c92eeef03eb172b7ebcdb9" versionHash="eccbc87e4b5ce2fe28308fd9f2a7baf3" name="stcw.sendSyncIssueMessageToProcess">
  <guid>{0cf9f22e-48af-4292-0cdb-fa67e2d88815}</guid>
  <label>Send SyncInssue Message To Process</label>
  <metaVersion>3</metaVersion>
  <parameterList>
    <parameter name="cwOrder" type="rifp">
      <type>order_com.conceptwave.system.Order</type>
    </parameter>
    <parameter name="processId" type="rifp">
      <type>dtype_cwf_pm.PROCESS_ID</type>
    </parameter>
  </parameterList>
  <script><![CDATA[
    var debugHeader = " sendSyncIssueMessage - ";

    debugPrintln(stcc.getSysdateForLog() + debugHeader + "cwOrder.id " + cwOrder.id);
    debugPrintln(stcc.getSysdateForLog() + debugHeader + "processId " + processId);

          var worklistDocumentFinder = new Finder("stcw:OrderItemWorklist");
          worklistDocumentFinder.searchDocument.SenderId = processId;
          worklistDocumentFinder.searchDocument.OrderId  = cwOrder.id;
          worklistDocumentFinder.search();

          var worklistDocList = worklistDocumentFinder.list;
          if (worklistDocList != null && worklistDocList.size >= 1) {
                var worklistDocument = worklistDocList[0];
    debugPrintln(stcc.getSysdateForLog() + debugHeader + "Found worklist " + worklistDocument.toXML());

                cwOrder.header.skipSendToGranite = "Y";
                cwOrder.save();
    debugPrintln(stcc.getSysdateForLog() + debugHeader + "Updated skipSendToGranite in orderHeader to Y ...");

                Process.performWorklistAction(worklistDocument,
                                                            null,
                                                            "errorResolved",
                                                            null,
                                                            cwOrder,
                                                            null);
    debugPrintln(stcc.getSysdateForLog() + debugHeader + "Performed worklist action ...");
          }
          else {
    debugPrintln(stcc.getSysdateForLog() + debugHeader + "Found " + worklistDocList == null ? "0" : worklistDocList.size +
                 " worklist records for process " + processId);
          }
  ]]></script>
</script>