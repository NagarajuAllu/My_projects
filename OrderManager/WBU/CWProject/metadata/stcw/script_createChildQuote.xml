<?xml version="1.0" encoding="UTF-8" ?>
<script filenameHash="e61fcb71526237124f9b564f3771c62e" versionHash="eccbc87e4b5ce2fe28308fd9f2a7baf3" name="stcw.createChildQuote">
  <guid>{02b383d4-01ea-343a-93fa-008fd5b0a479}</guid>
  <label>Create Child Quote</label>
  <metaVersion>3</metaVersion>
  <parameterList>
    <parameter name="input" type="rifp">
      <mandatory>true</mandatory>
      <type>nmeta_com.conceptwave.system.Object</type>
    </parameter>
    <parameter name="orderRowItemId" type="rifp">
      <type>dtype_stcw.orderRowItemId</type>
    </parameter>
  </parameterList>
  <valueType>order_com.conceptwave.system.Order</valueType>
  <script><![CDATA[
    var order = new Order ("stcw:wholesaleQuote");

    order.header.quoteNumber       = input.quoteNumber + "#" + orderRowItemId;
    order.header.orderAction       = "Add";
    order.header.orderNumber       = input.quoteNumber;
    order.header.orderRowItemId    = orderRowItemId;
    order.header.completedDate     = null;
    order.header.quoteStatus       = input.quoteStatus;
    order.header.quoteType         = input.quoteType;
    order.header.skipSendToGranite = "N";


    for(var i=0; i<input.lineItems.length; i++) {
          if(input.lineItems[i].orderRowItemId == orderRowItemId) {
                order.header.productCode = input.lineItems[i].productCode;
                order.header.quantity    = parseInt(input.lineItems[i].quantity);
          }
    }

    if(input.quoteStatus == "Reservation") {
          order.header.reservationNumber = stcw.createReservationNumber(input.quoteNumber, orderRowItemId);
    }

    if (order.versions == null)
          order.addItem ("versions");

    var orderVersion = order.versions.newInstance ();
    orderVersion.header.versionName = "INITIAL";

    return (order);
  ]]></script>
</script>