<?xml version="1.0" encoding="UTF-8" ?>
<process filenameHash="1072a50a6d636b8761ad3794ba37d00c" versionHash="eccbc87e4b5ce2fe28308fd9f2a7baf3" name="stcw.syncAllQuoteBetweenExpdAndGraniteProcess">
  <activity name="start" type="seqActivity">
    <guid>{045cc3fe-3794-62cc-72e7-4eea62894a69}</guid>
    <label>Start</label>
    <x>132.0</x>
    <y>49.0</y>
    <childList>
      <child name="getAllProcessIdForProcessRunning" type="scriptActivity">
        <guid>{03e93f86-c1bd-31b2-65a7-506d251dfd1b}</guid>
        <label>Get All ProcessIds For Processes Running</label>
        <x>337.0</x>
        <y>5.0</y>
        <methodList>
          <method name="cwOnProcActBefore" type="action">
            <category>before</category>
            <guid>{00527b3a-08d7-5bb5-ac6c-d884fb378fa2}</guid>
            <system>true</system>
            <script><![CDATA[
              debugPrintln(stcc.getSysdateForLog() + "[" + this.process.id + "] - getting all processIds");

                    this.process.processDocument.idList = stcw.findProcessIdsForQuoteProcessesRunning();
              debugPrintln(stcc.getSysdateForLog() + "[" + this.process.id + "] - processIds found: " + this.process.processDocument.idList);

                    if(this.process.processDocument.idList != null) {
                          this.process.processDocument.countProcessIdFound = this.process.processDocument.idList.split(";").length;
                    }
                    else {
                          this.process.processDocument.countProcessIdFound = 0;
                    }

                    this.process.processDocument.processIdCounter = 0;
            ]]></script>
          </method>
        </methodList>
      </child>
      <child name="existAnotherProcessToBeChecked" type="switchActivity">
        <guid>{02417730-1c8f-c336-704d-3f277d2f1c3f}</guid>
        <label>Exist Another Process To Be Checked?</label>
        <x>336.0</x>
        <y>156.0</y>
        <childList>
          <child name="yes" type="caseActivity">
            <guid>{0add3a3e-de2c-29b6-bb84-4b68f8b3cbe0}</guid>
            <label>Yes</label>
            <x>0.0</x>
            <y>0.0</y>
            <childList>
              <child name="start" type="seqActivity">
                <guid>{0503e435-6556-9089-d063-2ae1a0b2f7b3}</guid>
                <label>Start</label>
                <x>344.0</x>
                <y>361.0</y>
                <childList>
                  <child name="syncQuoteBetweenExpdAndGranite" type="spawnActivity">
                    <element>proc_stcw.syncQuoteBetweenExpdAndGranite</element>
                    <guid>{083643c3-5a28-7130-05f5-3f6881eb5a6d}</guid>
                    <label>Sync Quote Between Expediter And Granite</label>
                    <x>672.0</x>
                    <y>333.0</y>
                    <methodList>
                      <method name="cwOnProcActBefore" type="action">
                        <category>before</category>
                        <guid>{0009d25d-7de6-ff44-79bb-519b84615a44}</guid>
                        <system>true</system>
                        <script><![CDATA[
                          debugPrintln(stcc.getSysdateForLog() + "[" + this.process.id + "] - Start Process SyncQuote for process: " + this.process.processDocument.currentProcessId);
                        ]]></script>
                      </method>
                    </methodList>
                  </child>
                  <child name="waitOnSyncQuoteProcess" type="joinActivity">
                    <element>proc_stcw.syncQuoteBetweenExpdAndGranite</element>
                    <guid>{0c0d3965-262b-8228-610b-0a071078289b}</guid>
                    <label>Wait On Sync Quote Process</label>
                    <x>673.0</x>
                    <y>140.0</y>
                  </child>
                  <child name="repeat" type="repeatActivity">
                    <element>proc_stcw.syncAllQuoteBetweenExpdAndGraniteProcess/seqActivity_start/switchActivity_existAnotherProcessToBeChecked</element>
                    <guid>{0d39aded-439a-9512-5190-6fd290ab7fcb}</guid>
                    <label>Repeat</label>
                    <x>527.0</x>
                    <y>156.0</y>
                    <methodList>
                      <method name="cwOnProcActBefore" type="action">
                        <category>before</category>
                        <guid>{0223d9e7-7592-988f-cdaf-1ba214e020c8}</guid>
                        <system>true</system>
                        <script>this.process.processDocument.processIdCounter++;</script>
                      </method>
                    </methodList>
                  </child>
                </childList>
                <methodList>
                  <method name="cwOnProcActBefore" type="action">
                    <category>before</category>
                    <guid>{0cc6c16a-49d9-b107-2396-b04f3b12e16e}</guid>
                    <system>true</system>
                    <script><![CDATA[
                      this.process.processDocument.currentProcessId = this.process.processDocument.idList.split(";")[this.process.processDocument.processIdCounter];
                      debugPrintln(stcc.getSysdateForLog() + "[" + this.process.id + "] - Selected another processId => " + this.process.processDocument.currentProcessId);
                    ]]></script>
                  </method>
                </methodList>
              </child>
            </childList>
            <methodList>
              <method name="cwOnProcActCond" type="action">
                <category>cond</category>
                <guid>{022a52e5-9c89-647d-6433-fd770bcd76f0}</guid>
                <system>true</system>
                <script><![CDATA[
                  var result = (this.process.processDocument.processIdCounter < this.process.processDocument.countProcessIdFound);
                  debugPrintln(stcc.getSysdateForLog() + "[" + this.process.id + "] - Another quote to be processed ? (" + this.process.processDocument.processIdCounter + "/" + this.process.processDocument.countProcessIdFound + ") => " + result);

                        return result;
                ]]></script>
              </method>
            </methodList>
          </child>
          <child name="no" type="caseActivity">
            <guid>{01fa9494-dbaa-68f7-1082-e62299a02904}</guid>
            <label>No</label>
            <x>193.0</x>
            <y>160.0</y>
          </child>
        </childList>
      </child>
      <child name="getAllRejectedOrderIds" type="scriptActivity">
        <guid>{020a0a43-b681-7582-c681-ab9b2ca32278}</guid>
        <label>Get All Rejected OrderIds</label>
        <x>186.0</x>
        <y>285.0</y>
        <methodList>
          <method name="cwOnProcActBefore" type="action">
            <category>before</category>
            <guid>{0faa01bd-023f-0b60-3ab5-205640a6fcc9}</guid>
            <system>true</system>
            <script><![CDATA[
              debugPrintln(stcc.getSysdateForLog() + "[" + this.process.id + "] - getting all rejectedQuoteIds");

                    this.process.processDocument.idList = stcw.findRejectedQuoteIds();
              debugPrintln(stcc.getSysdateForLog() + "[" + this.process.id + "] - orderIds found: " + this.process.processDocument.idList);

                    if(this.process.processDocument.idList != null) {
                          this.process.processDocument.countRejectedOrderIdFound = this.process.processDocument.idList.split(";").length;
                    }
                    else {
                          this.process.processDocument.countRejectedOrderIdFound = 0;
                    }

                    this.process.processDocument.rejectedOrderIdCounter = 0;
            ]]></script>
          </method>
        </methodList>
      </child>
      <child name="existAnotherRejectedQuoteToBeChecked" type="switchActivity">
        <guid>{07eb6c73-d084-14b9-cfd8-a5d6e7017b57}</guid>
        <label>Exist Another Rejected Quote To Be Checked?</label>
        <x>182.0</x>
        <y>492.0</y>
        <childList>
          <child name="yes" type="caseActivity">
            <guid>{007ee422-f874-57fe-8982-e045cca64868}</guid>
            <label>Yes</label>
            <x>0.0</x>
            <y>0.0</y>
            <childList>
              <child name="startManagingRejectedOrder" type="seqActivity">
                <guid>{0f7aeb85-4a95-662c-ea22-1796ae674f3b}</guid>
                <label>Start Managing Rejected Order</label>
                <x>330.0</x>
                <y>540.0</y>
                <childList>
                  <child name="syncRejectedQuoteBetweenExpdAndGranite" type="spawnActivity">
                    <element>proc_stcw.syncRejectedQuoteBetweenExpdAndGranite</element>
                    <guid>{0590aa93-0bc4-621a-1471-224d71720892}</guid>
                    <label>Sync Rejected Quote Between Expediter And Granite</label>
                    <x>583.0</x>
                    <y>502.0</y>
                    <methodList>
                      <method name="cwOnProcActBefore" type="action">
                        <category>before</category>
                        <guid>{008246ca-fff4-4bed-3e6f-3b4b774e3451}</guid>
                        <system>true</system>
                        <script><![CDATA[
                          debugPrintln(stcc.getSysdateForLog() + "[" + this.process.id + "] - Start Process SyncRejectedQuote for orderId: " + this.process.processDocument.currentRejectedOrderId);
                        ]]></script>
                      </method>
                    </methodList>
                  </child>
                  <child name="waitOnSyncRejectedQuote" type="joinActivity">
                    <element>proc_stcw.syncRejectedQuoteBetweenExpdAndGranite</element>
                    <guid>{0192e96f-7397-da63-2b99-b8351b39cf61}</guid>
                    <label>Wait On Sync Rejected Quote</label>
                    <x>592.0</x>
                    <y>664.0</y>
                  </child>
                  <child name="repeat" type="repeatActivity">
                    <element>proc_stcw.syncAllQuoteBetweenExpdAndGraniteProcess/seqActivity_start/switchActivity_existAnotherRejectedQuoteToBeChecked</element>
                    <guid>{02a1e771-c715-0c3f-1967-84576020fef2}</guid>
                    <label>Repeat</label>
                    <x>190.0</x>
                    <y>683.0</y>
                    <methodList>
                      <method name="cwOnProcActBefore" type="action">
                        <category>before</category>
                        <guid>{0223d9e7-7592-988f-cdaf-1ba214e020c8}</guid>
                        <system>true</system>
                        <script>this.process.processDocument.rejectedOrderIdCounter++;</script>
                      </method>
                    </methodList>
                  </child>
                </childList>
                <methodList>
                  <method name="cwOnProcActBefore" type="action">
                    <category>before</category>
                    <guid>{096f8512-01f6-a0b2-85b0-bccd6caa208e}</guid>
                    <system>true</system>
                    <script><![CDATA[
                      this.process.processDocument.currentRejectedOrderId = this.process.processDocument.idList.split(";")[this.process.processDocument.rejectedOrderIdCounter];

                      var order = Order.getOrderById(this.process.processDocument.currentRejectedOrderId);
                      var rejectedOrderNumber    = order.header.orderNumber;
                      var rejectedOrderRowItemId = order.header.orderRowItemId;
                      this.process.processDocument.originalOrderNumber = rejectedOrderNumber.substring(0, rejectedOrderNumber.indexOf("_201", 0));
                      this.process.processDocument.originalOrderRowItemId = (rejectedOrderRowItemId <= 0) ? -rejectedOrderRowItemId : rejectedOrderRowItemId;
                      debugPrintln(stcc.getSysdateForLog() + "[" + this.process.id + "] - Selected another orderId => " + this.process.processDocument.currentRejectedOrderId +
                                         "; originalOrderNumber = " + this.process.processDocument.originalOrderNumber +
                                         "; originalOrderRowItemId = " + this.process.processDocument.originalOrderRowItemId);
                    ]]></script>
                  </method>
                </methodList>
              </child>
            </childList>
            <methodList>
              <method name="cwOnProcActCond" type="action">
                <category>cond</category>
                <guid>{0d464927-8606-90ec-0f46-20ac330c03ed}</guid>
                <system>true</system>
                <script><![CDATA[
                  var result = (this.process.processDocument.rejectedOrderIdCounter < this.process.processDocument.countRejectedOrderIdFound);
                  debugPrintln(stcc.getSysdateForLog() + "[" + this.process.id + "] - Another quote to be processed ? (" + this.process.processDocument.rejectedOrderIdCounter + "/" + this.process.processDocument.countRejectedOrderIdFound + ") => " + result);

                        return result;
                ]]></script>
              </method>
            </methodList>
          </child>
          <child name="no" type="caseActivity">
            <guid>{0a03c30e-6178-79ab-9630-b0339a04bd4d}</guid>
            <label>No</label>
            <x>102.0</x>
            <y>537.0</y>
          </child>
        </childList>
      </child>
      <child name="end" type="completeActivity">
        <guid>{034545cc-40ce-8add-4e35-8a9febe91d7d}</guid>
        <label>End</label>
        <x>102.0</x>
        <y>678.0</y>
        <methodList>
          <method name="cwOnProcActBefore" type="action">
            <category>before</category>
            <guid>{068f63ce-a509-3b96-8365-535a045d01eb}</guid>
            <system>true</system>
            <script><![CDATA[
              debugPrintln(stcc.getSysdateForLog() + "[" + this.process.id + "] - Completed process 'SyncAllQuotesBetweenExpediterAndGranite'");
            ]]></script>
          </method>
        </methodList>
      </child>
    </childList>
    <methodList>
      <method name="cwOnProcActBefore" type="action">
        <category>before</category>
        <guid>{0c3eddf0-4afc-5837-60a0-35f3f1828988}</guid>
        <system>true</system>
        <script><![CDATA[debugPrintln(stcc.getSysdateForLog() + "[" + this.process.id + "] - Starting");]]></script>
      </method>
    </methodList>
  </activity>
  <curRevision>true</curRevision>
  <document>doc_stcw.syncOrderQuoteGlobalProcessDocument</document>
  <guid>{0b928218-ed3d-860c-af36-aad665828f9c}</guid>
  <highlight>10</highlight>
  <label>Sync All Quotes Between Expediter And Granite</label>
  <metaVersion>3</metaVersion>
  <priority>8</priority>
  <type>User</type>
</process>