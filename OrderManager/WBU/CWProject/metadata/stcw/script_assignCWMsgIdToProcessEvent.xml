<?xml version="1.0" encoding="UTF-8" ?>
<script filenameHash="2294dfe40416a359b460f2b9cd3d6346" versionHash="eccbc87e4b5ce2fe28308fd9f2a7baf3" name="stcw.assignCWMsgIdToProcessEvent">
  <guid>{031d48b2-6934-0b63-e061-1d4f21530586}</guid>
  <label>Assign CWMsgId To ProcessHistoryEvents</label>
  <metaVersion>3</metaVersion>
  <parameterList>
    <parameter name="processActivity" type="rifp">
      <type>nmeta_com.conceptwave.system.Object</type>
    </parameter>
    <parameter name="cwMsgId" type="rifp">
      <type>dtype_stcw.messageId</type>
    </parameter>
  </parameterList>
  <script><![CDATA[
    if (processActivity == null)
          return (false);

    var eventDocument = getEventDocument_ (processActivity);
    if (eventDocument == null)
          return (false);

    eventDocument.messageId = cwMsgId;
    eventDocument.save ();

    debugPrintln("assignCWMsgIdToProcessEvent <" + processActivity.process.id + "," + cwMsgId + "> - Updated event " + eventDocument.cwDocId);

          return true;

          //
          // getEventDocument_
          //
          function getEventDocument_ (processActivity) {

                var eventFinder = new Finder ("rpts:historyEventFinder");
                eventFinder.searchDocument.processId = processActivity.process.id;
                eventFinder.searchDocument.activityIndex = processActivity.index;
                eventFinder.search ();
                eventFinder.sort ("-cwDocId");

                if (eventFinder.list == null || eventFinder.list.size <= 0 )
                      return (null);

                return (eventFinder.list.start);
          }      // g e t E v e n t D o c u m e n t _
  ]]></script>
</script>