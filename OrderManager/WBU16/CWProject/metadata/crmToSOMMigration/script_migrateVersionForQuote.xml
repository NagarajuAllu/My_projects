<?xml version="1.0" encoding="UTF-8" ?>
<script name="crmToSOMMigration.migrateVersionForQuote">
  <label>Migrate Version For Quote</label>
  <metaVersion>25</metaVersion>
  <parameterList>
    <parameter name="crmQuote" type="rifp">
      <type>order_stcw.wholesaleQuote</type>
    </parameter>
    <parameter name="versionName" type="rifp">
      <type>dtype_com.conceptwave.system.String</type>
    </parameter>
    <parameter name="versionNumber" type="rifp">
      <type>dtype_com.conceptwave.system.Integer</type>
    </parameter>
  </parameterList>
  <script><![CDATA[
    var migratedOrder = null;

    var debug = " migrateVersion[" + crmQuote.header.orderNumber + "," + versionName + "] ";

    var versionPositionInOrder = crmToSOMMigration.getVersionPositionInOrder(crmQuote, versionName);
    var versionInOrder = crmQuote.versions[versionPositionInOrder];

    // found version; searching input data
    var inputRequestInterface = crmToSOMMigration.getInterfacePositionInVersion(crmQuote, versionPositionInOrder, "CRM_QUOTE_VALIDATION");

    if(inputRequestInterface == null) {
    debugPrintln(stcc.getSysdateForLog() + debug + "Unable to find interface 'CRM_QUOTE_VALIDATION' in version " + versionName);
    }
    else {
        var receivedFlow = stcw.readStructure(versionInOrder.interfaces[inputRequestInterface].interfaceData.responseData, "wsws.quoteValidation");

        if(receivedFlow != null) {
    debugPrintln(stcc.getSysdateForLog() + debug + "ReceivedFlow " + receivedFlow.toXML());
            migratedOrder = crmToSOMMigration.mapCRMChildQuoteIntoBundleOrder(receivedFlow, crmQuote.orderInstance.creationDate, versionName, versionNumber, crmQuote.header);
            if(migratedOrder != null) {
    debugPrintln(stcc.getSysdateForLog() + debug + "MigratedOrder " + migratedOrder.toXML());
            }
            else {
    debugPrintln(stcc.getSysdateForLog() + debug + "MigratedOrder IS NULL!!!! ");
            }
        }
        else {
    debugPrintln(stcc.getSysdateForLog() + debug + "Not able to parse the ReceivedFlow");
        }
    }

    return migratedOrder;
  ]]></script>
</script>