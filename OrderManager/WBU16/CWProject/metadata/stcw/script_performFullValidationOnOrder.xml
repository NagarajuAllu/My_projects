<?xml version="1.0" encoding="UTF-8" ?>
<script name="stcw.performFullValidationOnOrder">
  <label>Perform Full Validation On Order</label>
  <metaVersion>25</metaVersion>
  <parameterList>
    <parameter name="bundleOrder" type="rifp">
      <type>order_stcw.wholesaleBundleOrderSTC</type>
    </parameter>
    <parameter name="isSubmit" type="rifp">
      <type>dtype_com.conceptwave.system.Boolean</type>
    </parameter>
    <parameter name="failureArray" type="rifp">
      <type>nmeta_com.conceptwave.system.Object</type>
    </parameter>
  </parameterList>
  <script><![CDATA[
    // validate header
    failureArray = stcw.validateElementOfOrder(bundleOrder.orderHeader, bundleOrder.orderHeader.orderNumber, isSubmit, failureArray);

    // checking if the attributes configured as mandatory in the table STCW_OH_VALIDATION_MAP are set
    failureArray  = stcw.performValidationOfMandatoryAttributesInOrdHeader(bundleOrder.orderHeader, isSubmit, failureArray);

    // validate headers NV pair
    if(bundleOrder.orderHeaderParameters != null) {
        for(var i=0; i<bundleOrder.orderHeaderParameters.length; i++) {
            failureArray = stcw.validateElementOfOrder(bundleOrder.orderHeaderParameters[i], bundleOrder.orderHeader.orderNumber, isSubmit, failureArray);
        }
    }

    // loop on parent lineitems
    for(var i=0; i<bundleOrder.parentLineItems.length; i++) {
        var bundleContainer = bundleOrder.parentLineItems[i];
        failureArray = stcw.performFullValidationOnParentLineItem(bundleContainer, failureArray, bundleOrder.orderHeader, isSubmit);
    }

    // check if there are lineItemIdentifier or serviceNumber repeated in the order
    failureArray = stcw.checkIfIdentifierOrServiceNumRepeatedInOrder(bundleOrder, isSubmit, failureArray);

    // check if there are lineItems with orderRowItemId repeated in the order
    if(bundleOrder.orderHeader.orderType == "F") {
        failureArray = stcw.checkIfOrderRowItemIdRepeatedInOrder(bundleOrder, isSubmit, failureArray);
    }

    return failureArray;
  ]]></script>
</script>