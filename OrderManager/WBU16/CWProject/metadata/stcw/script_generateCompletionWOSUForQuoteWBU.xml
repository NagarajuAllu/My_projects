<?xml version="1.0" encoding="UTF-8" ?>
<script name="stcw.generateCompletionWOSUForQuoteWBU">
  <label>Generate Completion WOSU For Quote WBU</label>
  <metaVersion>25</metaVersion>
  <parameterList>
    <parameter name="processId" type="rifp">
      <type>dtype_com.conceptwave.system.String</type>
    </parameter>
    <parameter name="workOrderNumber" type="rifp">
      <type>dtype_com.conceptwave.system.String</type>
    </parameter>
    <parameter name="quoteNumber" type="rifp">
      <type>dtype_com.conceptwave.system.String</type>
    </parameter>
    <parameter name="orderRowItemId" type="rifp">
      <type>dtype_wsws.orderRowItemId</type>
    </parameter>
    <parameter name="reservationNumber" type="rifp">
      <type>dtype_com.conceptwave.system.String</type>
    </parameter>
  </parameterList>
  <script><![CDATA[
    debugPrintln(stcc.getSysdateForLog() + "[" + processId + "] - Generating COMPLETED or CANCELLED QSU event for WO " + workOrderNumber);

    var qsuEvent = null;

    var qsuFinder = new Finder("granite.findQuoteInfoByQuoteNumber");
    qsuFinder.searchDocument.WO_NAME = workOrderNumber;
    qsuFinder.search();

    var completedQSUList = qsuFinder.list;
    if(completedQSUList != null && completedQSUList.size > 0) {
        var completedQSU = completedQSUList[0];

        qsuEvent = new DataStructure("wgws.updateQuoteStatus");
        qsuEvent.actualImplementationDays = completedQSU.ACTUAL_IMPLEMENTATION_DAYS;
        qsuEvent.businessUnit             = "Wholesale";
        qsuEvent.comments                 = completedQSU.WO_COMMENTS;
        qsuEvent.feasibilityStatus        = completedQSU.FEASIBILITY_STATUS;
        qsuEvent.orderRowItemId           = orderRowItemId;
        qsuEvent.plannedFeasibleDays      = completedQSU.PLANNED_FEASIBLE_DAYS;
        qsuEvent.quoteNumber              = quoteNumber;
        qsuEvent.reservationDays          = completedQSU.RESERVATION_DAYS;
        qsuEvent.reservationNumber        = reservationNumber;
        qsuEvent.workOrderStatus          = ((completedQSU.WO_STATUS == '8') ? "CANCELLED" : "COMPLETED");


    }

    if (qsuEvent != null) {
    debugPrintln(stcc.getSysdateForLog() + "[" + processId + "] - Generated COMPLETED or CANCELLED QSU event for WO " + workOrderNumber + "; qsu = " + qsuEvent.toXML());
    }

    return qsuEvent;
  ]]></script>
</script>