<?xml version="1.0" encoding="UTF-8" ?>
<script name="stcw.generateWONumber">
  <label>Generate WorkOrder Number</label>
  <metaVersion>25</metaVersion>
  <parameterList>
    <parameter name="orderItem" type="rifp">
      <type>nmeta_com.conceptwave.system.Object</type>
    </parameter>
    <parameter name="workOrderType" type="rifp">
      <type>dtype_com.conceptwave.system.String</type>
    </parameter>
    <parameter name="bundleOrder" type="rifp">
      <type>nmeta_com.conceptwave.system.Object</type>
    </parameter>
  </parameterList>
  <script><![CDATA[
    var woNumber = orderItem.workOrderNumber;

    if(woNumber == null) {
        if(orderItem.elementTypeInOrderTree == "B") {
            // it's a bundle lineItem
            if(bundleOrder.orderHeader.orderType == "F" && orderItem.action == "D") {
                // in case the action of the feasibility is "D" - it means OM received a Cancel on a COMPLETED feasibility,
                // OM has to generate a disconnect workOrder in Granite
                woNumber = stcw.getNewChildOrderNumber("O");
            }
            else {
                // check if it's a legacy order
                var isLegacyService = stcw.isLegacyService(orderItem.parentOrderItem, true);
                if(isLegacyService) {
                    if(orderItem.elementTypeInOrderTree == "B") {
                        // in case of legacy order and parentLineItem, generate WO with the same COM orderNumber
                        woNumber = bundleOrder.orderHeader.orderNumber;
                    }
                    else {
                        // it means that they are VAS and so the workOrderNumber is generated according to the bundle rules
                        woNumber = stcw.getNewChildOrderNumber(workOrderType);
                    }
                }
                else {
                    woNumber = stcw.getNewChildOrderNumber(workOrderType);
                }
            }
        }
        else {
            woNumber = stcw.getNewChildOrderNumber(workOrderType);
        }
    }

    return woNumber;
  ]]></script>
</script>