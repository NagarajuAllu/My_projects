<?xml version="1.0" encoding="UTF-8" ?>
<script name="stcw.checkIfExistALineItemInProgressInBundleForQuote">
  <label>Check If Exist A LineItem In Progress In Bundle For Quote</label>
  <metaVersion>25</metaVersion>
  <parameterList>
    <parameter name="lineItemParent" type="rifp">
      <type>nmeta_com.conceptwave.system.Object</type>
    </parameter>
  </parameterList>
  <script><![CDATA[
    var found = false;
    var orchestrationRecordForChildLineItems = stcw.findRecordsInOrchTabByOrderId_ParentId(lineItemParent.orderId, lineItemParent.id);
    if(orchestrationRecordForChildLineItems != null && orchestrationRecordForChildLineItems.length > 0) {
        for(var i=0; i<orchestrationRecordForChildLineItems.length && !found; i++) {
            var orchestrationRecord = orchestrationRecordForChildLineItems[i];
            var lineItem = Document.readDoc("stcw.lineItemDocument", orchestrationRecordForChildLineItems[i].cwDocId);
            if(orchestrationRecord.provisionable) {
                found = (lineItem.lineItemStatus.toUpperCase() != "FEASIBLE" &&
                         lineItem.lineItemStatus.toUpperCase() != "NOT FEASIBLE" &&
                         lineItem.lineItemStatus.toUpperCase() != "PLANNED FEASIBLE" &&
                         lineItem.lineItemStatus.toUpperCase() != "CANCELLED");
            }

            if(!found) {
                // loop for children of the record
                found = stcw.checkIfExistALineItemInProgressInBundleForQuote(lineItem);
            }
        }
    }

    debugPrintln(stcc.getSysdateForLog() + " checkIfExistALineItemInProgressInBundleForQuote(" + lineItemParent + "): " + found);

    return found;
  ]]></script>
</script>