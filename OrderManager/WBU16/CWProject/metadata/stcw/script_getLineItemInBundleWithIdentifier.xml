<?xml version="1.0" encoding="UTF-8" ?>
<script name="stcw.getLineItemInBundleWithIdentifier">
  <label>Get LineItem In Bundle With Identifier</label>
  <metaVersion>25</metaVersion>
  <parameterList>
    <parameter name="bundleLineItem" type="rifp">
      <type>doc_stcw.lineItemDocument</type>
    </parameter>
    <parameter name="childLineItemIdentifier" type="rifp">
      <type>dtype_com.conceptwave.system.String</type>
    </parameter>
  </parameterList>
  <script><![CDATA[
    var foundLineItem = null;
    if(bundleLineItem.lineItemIdentifier == childLineItemIdentifier) {
        foundLineItem = bundleLineItem;
    }
    else {
        var foundLineItemId = null;
        var servicesInOrchestrationRecord = stcw.findRecordsInOrchTabByOrderId_ParentId(bundleLineItem.cwOrderId, bundleLineItem.id);
        if(servicesInOrchestrationRecord != null) {
            for(var i=0; i<servicesInOrchestrationRecord.length && foundLineItemId == null; i++) {
                if(servicesInOrchestrationRecord[i].lineItemIdentifier == childLineItemIdentifier) {
                    foundLineItemId = servicesInOrchestrationRecord[i].cwDocId;
                }
                else {
                    var subServicesInOrchestrationRecord = stcw.findRecordsInOrchTabByOrderId_ParentId(bundleLineItem.cwOrderId, servicesInOrchestrationRecord[i].cwDocId);
                    if(subServicesInOrchestrationRecord != null) {
                        for(var j=0; j<subServicesInOrchestrationRecord.length && foundLineItemId == null; j++) {
                            if(subServicesInOrchestrationRecord[j].lineItemIdentifier == childLineItemIdentifier) {
                                foundLineItemId = subServicesInOrchestrationRecord[j].cwDocId;
                            }
                            else {
                                var subSubServicesInOrchestrationRecord = stcw.findRecordsInOrchTabByOrderId_ParentId(bundleLineItem.cwOrderId, subServicesInOrchestrationRecord[j].cwDocId);
                                if(subSubServicesInOrchestrationRecord != null) {
                                    for(var k=0; k<subSubServicesInOrchestrationRecord.length && foundLineItemId == null; k++) {
                                        if(subSubServicesInOrchestrationRecord[k].lineItemIdentifier == childLineItemIdentifier) {
                                            foundLineItemId = subSubServicesInOrchestrationRecord[k].cwDocId;
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }

        if(foundLineItemId != null) {
            foundLineItem = Document.readDoc("stcw.lineItemDocument", foundLineItemId);
        }
    }

    return foundLineItem;
  ]]></script>
</script>