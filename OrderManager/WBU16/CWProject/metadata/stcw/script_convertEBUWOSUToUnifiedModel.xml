<?xml version="1.0" encoding="UTF-8" ?>
<script name="stcw.convertEBUWOSUToUnifiedModel">
  <label>Convert EBU WOSU To Unified Model</label>
  <metaVersion>25</metaVersion>
  <parameterList>
    <parameter name="inputEBUWOSU" type="rifp">
      <type>nmeta_com.conceptwave.system.Object</type>
    </parameter>
    <parameter name="lineItemId" type="rifp">
      <type>dtype_com.conceptwave.system.String</type>
    </parameter>
    <parameter name="isQuote" type="rifp">
      <type>dtype_com.conceptwave.system.Boolean</type>
    </parameter>
  </parameterList>
  <script><![CDATA[
    var wosuUnifiedModel = new DataStructure("stcw.wosuUnifiedModel");
    wosuUnifiedModel.comOrderNumber = inputEBUWOSU.crmOrderNumber;
    wosuUnifiedModel.orderStatus = inputEBUWOSU.workOrderStatus;
    wosuUnifiedModel.businessUnit = "Wholesale";
    wosuUnifiedModel.reservationNumber = inputEBUWOSU.reservationNumber;
    wosuUnifiedModel.feasibilityStatus = (isQuote_() ? getFeasibilityStatus_() : null);
    wosuUnifiedModel.reservationDays = null;
    wosuUnifiedModel.actualImplementationDays = null;
    wosuUnifiedModel.plannedFeasibleDays = null;
    wosuUnifiedModel.lineItemIdentifier = null;
    wosuUnifiedModel.lineItemStatus = inputEBUWOSU.workOrderStatus;
    wosuUnifiedModel.assetNumber = inputEBUWOSU.serviceNumber;
    wosuUnifiedModel.niNumber = null;
    wosuUnifiedModel.systemDesignation = null;
    wosuUnifiedModel.workOrderName = inputEBUWOSU.workOrderNumber;
    wosuUnifiedModel.workOrderStatus = inputEBUWOSU.workOrderStatus;
    wosuUnifiedModel.workOrderRemarks = inputEBUWOSU.workOrderRemarks;
    wosuUnifiedModel.workOrderProblemDescription = inputEBUWOSU.workOrderProblemDescription;
    wosuUnifiedModel.taskNumber = inputEBUWOSU.taskNumber;
    wosuUnifiedModel.taskName = inputEBUWOSU.taskName;
    wosuUnifiedModel.taskAllocatedTime = inputEBUWOSU.taskAllocatedTime;
    wosuUnifiedModel.taskDescription = inputEBUWOSU.taskDescription;
    wosuUnifiedModel.taskOperation = inputEBUWOSU.taskOperation;
    wosuUnifiedModel.taskPriority = inputEBUWOSU.taskPriority;
    wosuUnifiedModel.taskServiceStatus = inputEBUWOSU.serviceStatus;
    wosuUnifiedModel.taskStatusCode = inputEBUWOSU.taskStatusCode;
    wosuUnifiedModel.taskRemarks = inputEBUWOSU.taskRemarks;
    wosuUnifiedModel.workOrderStage = inputEBUWOSU.woStage;

    if(inputEBUWOSU.parameters != null && inputEBUWOSU.parameters.length > 0) {
        for(var i=0; i<inputEBUWOSU.parameters.length; i++) {
            var nvPairDS = new DataStructure("stcw.wosuNVPair");
            nvPairDS.name = inputEBUWOSU.parameters[i].name; // do i have to convert name?
            nvPairDS.value = inputEBUWOSU.parameters[i].value; // do i have to convert value?
            wosuUnifiedModel.nvPairs[i] = nvPairDS;
        }
    }

    return wosuUnifiedModel;


    function getFeasibilityStatus_() {
        var feasibilityStatus = null;
        var foundValue = null;

        if(inputEBUWOSU.parameters != null && inputEBUWOSU.parameters.length > 0) {
            for(var i=0; i<inputEBUWOSU.parameters.length; i++) {
                if(inputEBUWOSU.parameters[i].name == "FeasibilityStatus") {
                    foundValue = inputEBUWOSU.parameters[i].value;
                }
            }
        }

        if(foundValue == null || foundValue.toUpperCase() == "YES" || foundValue.toUpperCase() == "PARTIAL FEASIBLE") {
            feasibilityStatus = "FEASIBLE";
        }
        else {
            feasibilityStatus = "NOT FEASIBLE";
        }

        return feasibilityStatus;
    }


    function isQuote_() {
        var isQuote = false;

        var searchDoc = new Document("stcw.search_bundleOrder");
        searchDoc.orderNumber = inputEBUWOSU.crmOrderNumber;
        var orderListFound = Finder.runFinder("stcw.findAllSTCBundleOrders_Script", "select", searchDoc);
        if(orderListFound != null && orderListFound.length > 0) {
            isQuote = (orderListFound[0].orderType != null && orderListFound[0].orderType == "F");
        }

        return isQuote;
    }
  ]]></script>
</script>