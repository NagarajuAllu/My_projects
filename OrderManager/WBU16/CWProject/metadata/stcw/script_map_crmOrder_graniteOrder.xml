<?xml version="1.0" encoding="UTF-8" ?>
<script name="stcw.map_crmOrder_graniteOrder">
  <label>(map) map_crmOrder_graniteOrder</label>
  <metaVersion>3</metaVersion>
  <parameterList>
    <parameter name="output" type="rifp">
      <mandatory>true</mandatory>
      <type>nmeta_com.conceptwave.system.Object</type>
    </parameter>
    <parameter name="input" type="rifp">
      <mandatory>true</mandatory>
      <type>nmeta_com.conceptwave.system.Object</type>
    </parameter>
  </parameterList>
  <valueType>dtype_com.conceptwave.system.Boolean</valueType>
  <script><![CDATA[
    // computing reservationNumber
    var reservationNumber = null;
    if (stcc.stringHasValue (input.reservationNumber)) {
          reservationNumber = input.reservationNumber;
    }
    else if(stcc.stringHasValue(input.service.reservationNumber)) {
          reservationNumber = input.service.reservationNumber;
    }

    output.order.AccountNumber = input.accountNumber;
    output.order.BusinessUnit = input.businessUnit;
    output.order.ChangeRequestType = input.changeRequestType;
    output.order.DisconnectionReason = input.disconnectionReason;
    output.order.Comments = input.comments;
    output.order.CreatedBy = input.createdBy;
    output.order.CreationDate = input.creationDate;
    output.order.Description = input.description;
    output.order.ExpectedDate = input.expectedDate;
    output.order.OrderNumber = input.orderNumber;
    output.order.OrderStatus = input.orderStatus;
    output.order.OrderType = input.orderType;
    output.order.QuoteNumber = input.quoteNumber;

    // According to mail sent to Maksym & Ravi 05/06/2010, we don't set
    // reservationNumber at Order level but only at Service level.
    output.order.ReservationNumber = null;
    output.order.Restoration = input.restoration;
    output.order.SegmentFlag = input.segmentFlag;

    if (input.service != null)
          mapService_ (output.order.Service, input.service, input.expectedDate, reservationNumber);

    return (true);

    //
    //  mapService_
    //
    function mapService_ (output, input, expectedDate, reservationNumber) {

          output.AssetNumber = input.assetNumber;
          output.Bandwidth = input.bandwidth
          output.CreationDate = input.creationDate;
          output.PrimaryAssetNumber = input.primaryAssetNumber;
          output.ProductCode = input.productCode;
          output.ReservationNumber = reservationNumber;
          output.SegmentFlag = input.segmentFlag;
          output.ServiceDate = input.serviceDate;
          output.NumberOfChannels = input.numberOfChannels;
          if(input.serviceDate == null) {
                output.ServiceDate = expectedDate;
          }

          if(input.subservices != null) {
                for (var index = 0; index < input.subservices.length; index++)      {
                      mapSubService_ (output.Subservices [index], input.subservices [index], expectedDate);
                }
          }

          if(input.nameValue != null) {
                for (var index = 0; index < input.nameValue.length; index++) {
                      mapNameValue_ (output.NameValue [index], input.nameValue [index]);
                }
          }
    }            // m a p S e r v i c e _

    //
    //  mapSubService_
    //
    function mapSubService_ (outputx, inputx, expectedDate) {

          outputx.AssetNumber = inputx.assetNumber;
          outputx.Bandwidth = inputx.bandwidth
          outputx.CreationDate = inputx.creationDate;
          outputx.PrimaryAssetNumber = inputx.primaryAssetNumber;
          outputx.ProductCode = inputx.productCode;
          outputx.ReservationNumber = inputx.reservationNumber;
          outputx.SegmentFlag = inputx.segmentFlag;
          outputx.ServiceDate = inputx.serviceDate;
          outputx.NumberOfChannels = inputx.numberOfChannels;
          if(inputx.serviceDate == null) {
                outputx.ServiceDate = expectedDate;
          }

          if(inputx.nameValue != null) {
                for (var index = 0; index < inputx.nameValue.length; index++) {
                      mapNameValue_ (outputx.NameValue [index], inputx.nameValue [index]);
                }
          }
    }            // m a p S u b S e r v i c e _

    //
    //  mapNameValue_
    //
    function mapNameValue_ (output, input) {
          // output.Name  = input.name;
          // output.Value = input.value;
          output.Name  = stcw.convertCOMNameToGraniteOne(input.name);
          output.Value = stcw.convertCOMValueToGraniteOne(input.name, input.value);
    }            // m a p N a m e V a l u e _
  ]]></script>
</script>