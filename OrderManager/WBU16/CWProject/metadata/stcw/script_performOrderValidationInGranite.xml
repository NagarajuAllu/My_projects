<?xml version="1.0" encoding="UTF-8" ?>
<script name="stcw.performOrderValidationInGranite">
  <label>Perform Order Validation In Granite</label>
  <metaVersion>25</metaVersion>
  <parameterList>
    <parameter name="bundleOrder" type="rifp">
      <type>order_stcw.wholesaleBundleOrderSTC</type>
    </parameter>
    <parameter name="isSubmit" type="rifp">
      <type>dtype_com.conceptwave.system.Boolean</type>
    </parameter>
    <parameter name="failureArray" type="rifp">
      <type>nmeta_com.conceptwave.system.Object</type>
    </parameter>
  </parameterList>
  <script><![CDATA[
    var mrLaptop = Global.getConfigVariable("MR_LAPTOP", "N");
    var isMRLaptop = false;
    if(mrLaptop != null && mrLaptop == "Y") {
        isMRLaptop = true;
    }

    if(! isMRLaptop) {
        // Customer validation
        if(bundleOrder.orderHeader.customerIdNumber != null) {
            var graniteCustomer = granite.getCustomerDataInGranite(bundleOrder.orderHeader.customerIdNumber);
            if(graniteCustomer == null) {
                var validationErrors = ["AE0181", Global.translateText("AE0181", null, bundleOrder.orderHeader.customerIdNumber)];
                failureArray = stcw.addValidationErrorsToFailureArray(validationErrors, bundleOrder.orderHeader.orderNumber, failureArray, "VALIDATION ERROR IN GRANITE", (isSubmit ? "SUBMIT ORDER" : "UPDATE ORDER"), "EOC_XNG");
            }
        }
    }

    // perform validation with CIM-E services for elements whose BU provisioning is "E"
    failureArray = stcw.performOrderValidationWithCIMEValidationWS(bundleOrder,isSubmit,failureArray);

    // perform validation directly in Granite DB for elements whose BU provisioning is "W"
    failureArray = stcw.performOrderValidationWithGraniteQuery(bundleOrder,isSubmit,failureArray);

    return failureArray;
  ]]></script>
</script>