<?xml version="1.0" encoding="UTF-8" ?>
<script name="stcc.sendDataToInterfaceWithLogging">
  <label>Send Data To Interface With Logging</label>
  <metaVersion>25</metaVersion>
  <parameterList>
    <parameter name="inputData" type="rifp">
      <type>nmeta_com.conceptwave.system.Object</type>
    </parameter>
    <parameter name="interfaceName" type="rifp">
      <type>dtype_com.conceptwave.system.String</type>
    </parameter>
    <parameter name="operationName" type="rifp">
      <type>dtype_com.conceptwave.system.String</type>
    </parameter>
    <parameter name="existResult" type="rifp">
      <type>dtype_com.conceptwave.system.Boolean</type>
    </parameter>
    <parameter name="processId" type="rifp">
      <type>dtype_cwf_pm.PROCESS_ID</type>
    </parameter>
    <parameter name="operationDescription" type="rifp">
      <type>dtype_com.conceptwave.system.String</type>
    </parameter>
    <parameter name="logUserData1" type="rifp">
      <type>dtype_com.conceptwave.system.String</type>
    </parameter>
    <parameter name="logUserData2" type="rifp">
      <type>dtype_com.conceptwave.system.String</type>
    </parameter>
  </parameterList>
  <script><![CDATA[
    var debugHeader = (processId != null ? ("[" + processId + "] ") : " ") + operationDescription + " - ";
    var result = null;

    try {

    debugPrintln(stcc.getSysdateForLog() + debugHeader + "Invoking interface: " + interfaceName + "; operationName" + operationName + "...");

        var outputInvokeIF = Global.invokeInterface(interfaceName, operationName, inputData);

        // adding CRMOrderNumber and WorkOrderNumber to data just sent
        var logDoc = UserProfile.getMsgLogDoc();
        logDoc.userData1 = logUserData1;
        logDoc.userData2 = logUserData2;
        logDoc.save();


        if(existResult) {
            if(outputInvokeIF != null && outputInvokeIF.length == 1) {
                result = outputInvokeIF[0];

    debugPrintln(stcc.getSysdateForLog() + debugHeader + "RESULT: " + result.toXML() + "...");
            }
        }
        else {
            // workaround to fix the following issue: in case there is no response in the operation and there is a communication issue, the error is returned as result
            if(outputInvokeIF != null && outputInvokeIF.length > 0) {
                if(! (outputInvokeIF[0] instanceof DataStructure)) {
    debugPrintln(stcc.getSysdateForLog() + debugHeader + "found exception in response: " + outputInvokeIF[0] + "...");
                    Global.rethrowException(outputInvokeIF[0]);
                }
            }
        }
    }
    catch (exc){
    debugPrintln(stcc.getSysdateForLog() + debugHeader + "EXCEPTION: " + exc.message);

        if(exc.message.indexOf("XE0023") >= 0) {
            Global.logDebug(debugHeader + "I/F " + interfaceName + ": getDelay = " + Global.getInterfaceDelay(interfaceName));
            debugPrintln(stcc.getSysdateForLog() + debugHeader + "I/F " + interfaceName + ": getDelay = " + Global.getInterfaceDelay(interfaceName));
        }
        else if(exc.message.indexOf("XE0002") >= 0) {
            Global.logDebug(debugHeader + "I/F " + interfaceName + ": caught Interface Error XE0002");
            debugPrintln(stcc.getSysdateForLog() + debugHeader + "I/F " + interfaceName + ": caught Interface Error XE0002");
        }

        Global.rethrowException(exc);
    }

    return result;
  ]]></script>
</script>