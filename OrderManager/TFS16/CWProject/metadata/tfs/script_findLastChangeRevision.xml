<?xml version="1.0" encoding="UTF-8" ?>
<script name="tfs.findLastChangeRevision">
  <label>Find Last Change Revision</label>
  <metaVersion>25</metaVersion>
  <parameterList>
    <parameter name="tfr" type="rifp"/>
  </parameterList>
  <script><![CDATA[
    if(!tfr){
        return null;
    }

    var baseNumber = tfr.tfrNumber.replace(/\/[0-9]+$/,"")+"/%";


    var tfrFinder = new Finder("tfs.findTFR");
    tfrFinder.searchDocument.tfrNumber = baseNumber;
    var resultList = tfrFinder.search();

    var lastRev = 0;

    if(resultList != null && resultList.length > 0) {
        for(var i=0; i<resultList.length; i++){
            if(lastRev < resultList[i].revision){
                lastRev = resultList[i].revision;
            }
        }
    }

    return lastRev;
  ]]></script>
</script>