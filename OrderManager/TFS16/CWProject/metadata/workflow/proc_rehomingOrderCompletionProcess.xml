<?xml version="1.0" encoding="UTF-8" ?>
<process name="workflow.rehomingOrderCompletionProcess">
  <activity name="start" type="seqActivity">
    <label>Start</label>
    <x>46.5</x>
    <y>30.0</y>
    <childList>
      <child name="startReviewCWOReportActivity" type="seqActivity">
        <label>Start Review CWO Report Activity</label>
        <x>32.22734</x>
        <y>122.0</y>
        <childList>
          <child name="reviewCWOReport" type="opActivity">
            <element>iface_workflow.orderInitiatorTeamIF/oper_reviewCWOReport</element>
            <label>Review CWO Report</label>
            <participant>part_workflow.installOrderInitiatorParticipant</participant>
            <x>48.82715</x>
            <y>216.76093</y>
          </child>
          <child name="acceptCWOReport" type="opActivity">
            <element>iface_workflow.orderInitiatorTeamIF/oper_acceptCWOReport</element>
            <label>Accept CWO Report</label>
            <participant>part_workflow.installOrderInitiatorParticipant</participant>
            <x>50.149414</x>
            <y>483.66913</y>
            <methodList>
              <method name="cwOnProcActAfter" type="action">
                <category>script</category>
                <system>true</system>
                <script><![CDATA[
                  debugPrintln("Rehome compeltion process: CWO Report accepted!Send TFR to COMPLETED state.");
                  this.process.processOrder.tfrDocument.tfrStatus = configuration.getExternalNameForStatusByInternalName("COMPLETED", "TFR");
                  debugPrintln("Clean TFR user...");
                  this.process.processOrder.tfrDocument.currentUserId = null;
                  this.process.processOrder.tfrDocument.currentUserDepartment = null;
                  this.process.processOrder.save();
                ]]></script>
              </method>
            </methodList>
          </child>
          <child name="completeReview" type="scriptActivity">
            <label>Complete Review</label>
            <x>42.82129</x>
            <y>609.77264</y>
            <methodList>
              <method name="cwOnProcActBefore" type="action">
                <category>before</category>
                <system>true</system>
                <script><![CDATA[
                  // complete reconnect order and reset users
                  if( this.process.processOrder.tfrDocument && this.process.processOrder.tfrDocument.tfrId){ // set status for TFR
                      this.process.processOrder.tfrDocument.tfrStatus = configuration.getExternalNameForStatusByInternalName("COMPLETED", "TFR");
                      this.process.processOrder.tfrDocument.currentUserId = null;
                      this.process.processOrder.tfrDocument.currentUserDepartment = null;
                  }
                  if( this.process.processOrder.prnDocument && this.process.processOrder.prnDocument.prnId){ // set status for PRN
                      this.process.processOrder.prnDocument.prnStatus = configuration.getExternalNameForStatusByInternalName("COMPLETED", "PRN");
                      this.process.processOrder.prnDocument.currentUserId = null;
                      this.process.processOrder.prnDocument.currentUserDepartment = null;
                  }
                  if( this.process.processOrder.prnrDocument && this.process.processOrder.prnrDocument.prnrId){ // set status for PRNR
                      this.process.processOrder.prnrDocument.prnrStatus = configuration.getExternalNameForStatusByInternalName("COMPLETED", "PRNR");
                      this.process.processOrder.prnrDocument.currentUserId = null;
                      this.process.processOrder.prnrDocument.currentUserDepartment = null;
                  }

                  this.process.processOrder.save();

                  // wake up rehome process
                  if  (this.process.processOrder.prnrDocument.parentProcId){
                      debugPrintln("Wake up parent process:"+this.process.processOrder.prnrDocument.parentProcId);
                      Process.sendSignal("workflow:wakeUpParent", this.process.processOrder.prnrDocument.parentProcId);
                  }
                  else{
                      debugPrintln("No process to wake up:"+this.process.processOrder.prnrDocument.parentProcId + " order:"+this.process.prcessOrder.id);
                  }
                ]]></script>
              </method>
            </methodList>
          </child>
          <child name="end" type="completeActivity">
            <label>End</label>
            <x>52.5</x>
            <y>721.175</y>
            <methodList>
              <method name="cwOnProcActBefore" type="action">
                <category>before</category>
                <system>true</system>
                <script><![CDATA[debugPrintln("rehomingOrderCompletionProcess: End.");]]></script>
              </method>
            </methodList>
          </child>
        </childList>
      </child>
      <child name="installOrderInitiatorParticipant" type="participantActivity">
        <label>Install Order Initiator Participant</label>
        <participant>part_workflow.installOrderInitiatorParticipant</participant>
        <x>54.0</x>
        <y>342.86444</y>
      </child>
    </childList>
    <methodList>
      <method name="cwOnProcActBefore" type="action">
        <category>before</category>
        <system>true</system>
        <script><![CDATA[debugPrintln("rehomingOrderCompletionProcess: Start.");]]></script>
      </method>
    </methodList>
  </activity>
  <curRevision>true</curRevision>
  <description>Used to finish Rehome order process. Allow to review Reconnect order CWO Report.</description>
  <document>doc_workflow.rehomingProcessDocument</document>
  <label>Rehoming Order Completion Process</label>
  <metaVersion>25</metaVersion>
  <priority>8</priority>
  <type>User</type>
</process>