<?xml version="1.0" encoding="UTF-8" ?>
<script name="workflow.resumeWorkItemsForOrder">
  <label>Resume Work Items For Order</label>
  <metaVersion>25</metaVersion>
  <parameterList>
    <parameter name="orderId" type="rifp"/>
    <parameter name="excludeProcessId" type="rifp"/>
  </parameterList>
  <script><![CDATA[
    var f = new Document("cwf_pm.ProcessSearch");
    f.ORDER_ID = orderId;

    var procList = [];

    var resultList = Finder.runFinder("workflow:workItemFinder", "select", f);



    // Enable all realated work items for current order, assigning original user for the document
    for(var i=0; i< resultList.length; i++){
        if(resultList[i].senderId == excludeProcessId){
            continue;
        }
        var order = Order.getOrderById(orderId);

        if(resultList[i].objectType == "PRNR") {
            _assignUserAndDep(order.prnrDocument,resultList[i].userId);
        }
        else if(resultList[i].objectType == "PRN") {
            _assignUserAndDep(order.prnDocument,resultList[i].userId);
        }
        else if(resultList[i].objectType == "TFR") {
            _assignUserAndDep(order.tfrDocument,resultList[i].userId);
        }
        else if(resultList[i].objectType == "BI") {
            _assignUserAndDep(order.biDocument,resultList[i].userId);
        }

        order.save();

        resultList[i].disabled = 0;
        resultList[i].save();
    };


    function _assignUserAndDep(obj, u) {
            obj.currentUserId = u;
            obj.currentUserDepartment = up_priv.getDepartmentByUserId(u);
            return obj;
    }
  ]]></script>
</script>