<?xml version="1.0" encoding="UTF-8" ?>
<script name="workflow.setUserInUsersForOrder">
  <label>Set User In Users For Order</label>
  <metaVersion>4</metaVersion>
  <parameterList>
    <parameter name="orderId" type="rifp">
      <type>dtype_cwf.docId</type>
    </parameter>
    <parameter name="orderItemId" type="rifp">
      <type>dtype_cwf.docId</type>
    </parameter>
    <parameter name="participantType" type="rifp">
      <type>dtype_com.conceptwave.system.String</type>
    </parameter>
    <parameter name="userId" type="rifp">
      <type>dtype_com.conceptwave.system.String</type>
    </parameter>
  </parameterList>
  <script><![CDATA[
    var finder = new Finder("workflow.usersForOrderFinder");
    finder.searchDocument.orderId = orderId;
    finder.searchDocument.orderItemId = orderItemId;
    var recordsFound = finder.search();

    var usersForOrder = null;
    if(recordsFound != null && recordsFound.length > 0) {
        usersForOrder = recordsFound[0];
    }
    else {
        usersForOrder = new Document("workflow.usersForOrder");
        usersForOrder.orderId = orderId;
        usersForOrder.orderItemId = orderItemId;
    }

    var mappingTable = workflow.getTypeToUserIdMapping();
    var attr = mappingTable[participantType];
    debugPrintln("Setting USER: "+attr);
    if(attr){
        usersForOrder[attr] = userId;
        debugPrintln("User assigned attribute user: " + userId + " type: " + attr + "for order: " + orderId + " orderItemId:" + orderItemId);
    }
    else {
        debugPrintln("User assigned attribute not found for participant: " + participantType);
    }

    usersForOrder.save();
  ]]></script>
</script>