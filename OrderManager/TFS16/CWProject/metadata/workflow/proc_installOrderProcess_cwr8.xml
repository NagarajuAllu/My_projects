<?xml version="1.0" encoding="UTF-8" ?>
<process name="workflow.installOrderProcess_cwr8">
  <activity name="start" type="seqActivity">
    <label>Start</label>
    <x>1429.2747</x>
    <y>47.051758</y>
    <childList>
      <child name="prepareToSubmitPRNR" type="opActivity">
        <element>iface_workflow.orderInitiatorTeamIF/oper_prepareToSubmitPRNR</element>
        <label>Prepare To Submit PRNR</label>
        <participant>part_workflow.installOrderInitiatorParticipant</participant>
        <x>1342.7229</x>
        <y>1216.342</y>
      </child>
      <child name="submitPRNR" type="opActivity">
        <element>iface_workflow.orderInitiatorTeamIF/oper_submitPRNR</element>
        <label>Submit PRNR</label>
        <participant>part_workflow.installOrderInitiatorParticipant</participant>
        <x>1238.8083</x>
        <y>2026.9114</y>
      </child>
      <child name="startProvisioningWorkflow" type="seqActivity">
        <label>Start Provisioning Workflow</label>
        <x>1206.0461</x>
        <y>2613.451</y>
        <childList>
          <child name="prepareToValidatePRNRAndFeasibilityCheck" type="opActivity">
            <element>iface_workflow.networkDesignTeamIF/oper_prepareToValidatePRNRAndFeasibilityCheck</element>
            <label>Prepare To Validate PRNR &amp; Feasibility Check</label>
            <participant>part_workflow.networkDesignParticipant</participant>
            <x>1285.721</x>
            <y>406.66916</y>
          </child>
          <child name="choiceValidatePRNR" type="choiceActivity">
            <label>Choice Validate PRNR</label>
            <x>1151.9797</x>
            <y>614.2268</y>
            <childList>
              <child name="rejectPRNR" type="opActivity">
                <element>iface_workflow.networkDesignTeamIF/oper_rejectPRNR</element>
                <label>Reject PRNR</label>
                <participant>part_workflow.networkDesignParticipant</participant>
                <x>1205.4456</x>
                <y>897.08325</y>
                <methodList>
                  <method name="cwOnProcActAfter" type="action">
                    <category>script</category>
                    <system>true</system>
                    <script><![CDATA[
                      this.process.processDocument.isPRNRAccepted = false;

                      this.process.processOrder.prnrDocument.prnrStatus =  configuration.getExternalNameForStatusByInternalName("REJECTED", "PRNR");
                      this.process.processOrder.save();
                    ]]></script>
                  </method>
                </methodList>
              </child>
              <child name="acceptPRNR" type="opActivity">
                <element>iface_workflow.networkDesignTeamIF/oper_acceptPRNR</element>
                <label>Accept PRNR</label>
                <participant>part_workflow.networkDesignParticipant</participant>
                <x>1120.7444</x>
                <y>897.08325</y>
                <methodList>
                  <method name="cwOnProcActAfter" type="action">
                    <category>script</category>
                    <system>true</system>
                    <script><![CDATA[
                      this.process.processDocument.isPRNRAccepted = true;
                      this.process.processDocument.skipReservationManagement = false;

                      this.process.processOrder.prnrDocument.releasedDate = new Date();
                      this.process.processOrder.prnrDocument.prnrStatus =  configuration.getExternalNameForStatusByInternalName("ACCEPTED", "PRNR");
                      this.process.processOrder.save();
                    ]]></script>
                  </method>
                </methodList>
              </child>
            </childList>
          </child>
          <child name="isPRNRAccepted" type="switchActivity">
            <label>Is PRNR Accepted?</label>
            <x>1132.2382</x>
            <y>1067.888</y>
            <childList>
              <child name="no" type="caseActivity">
                <label>No</label>
                <x>495.0</x>
                <y>472.0</y>
                <childList>
                  <child name="startRejectedPRNRManaging" type="seqActivity">
                    <label>Start Rejected PRNR Managing</label>
                    <x>1117.796</x>
                    <y>1372.818</y>
                    <childList>
                      <child name="receiveRejection" type="opActivity">
                        <element>iface_workflow.orderInitiatorTeamIF/oper_receiveRejection</element>
                        <label>Receive Rejection</label>
                        <participant>part_workflow.installOrderInitiatorParticipant</participant>
                        <x>1071.0894</x>
                        <y>1512.9514</y>
                      </child>
                      <child name="rejectedPRNRManagement" type="choiceActivity">
                        <label>Rejected PRNR Management</label>
                        <x>1128.0076</x>
                        <y>1729.0549</y>
                        <childList>
                          <child name="revisePRNR" type="opActivity">
                            <element>iface_workflow.orderInitiatorTeamIF/oper_revisedPRNR</element>
                            <label>Revise PRNR</label>
                            <participant>part_workflow.installOrderInitiatorParticipant</participant>
                            <x>1154.1287</x>
                            <y>2026.9114</y>
                            <methodList>
                              <method name="cwOnProcActAfter" type="action">
                                <category>script</category>
                                <system>true</system>
                                <script><![CDATA[
                                  this.process.processDocument.isPRNRRevised = true;
                                  this.process.processOrder.prnrDocument.prnrStatus = configuration.getExternalNameForStatusByInternalName("REVISED", "PRNR");
                                  this.process.processOrder.save();
                                ]]></script>
                              </method>
                            </methodList>
                          </child>
                          <child name="cancelPRNR" type="opActivity">
                            <element>iface_workflow.orderInitiatorTeamIF/oper_cancelPRNR</element>
                            <label>Cancel PRNR</label>
                            <participant>part_workflow.installOrderInitiatorParticipant</participant>
                            <x>1057.0857</x>
                            <y>2026.9114</y>
                            <childList>
                              <child name="terminateRehomeIfExists" type="scriptActivity">
                                <label>Terminate Rehome If exists</label>
                                <x>1054.7603</x>
                                <y>2167.716</y>
                                <methodList>
                                  <method name="cwOnProcActBefore" type="action">
                                    <category>before</category>
                                    <system>true</system>
                                    <script><![CDATA[
                                      // Install process cancel is possible from Install process
                                      // Install process could be started as a part of Rehome process
                                      // In case of start from Rehome process we need also to stop rehome process when cancelling Install

                                      debugPrintln("Install: PRNR cancel requested...");
                                      debugPrintln("Checking if linked Rehome process exists...");
                                      var connection_id = null;

                                      if(this.process.processOrder.prnrDocument != null){
                                          connection_id = this.process.processOrder.prnrDocument.connectionTFRId;
                                      }

                                      debugPrintln("Connection TFR:"+connection_id);

                                      if( connection_id ){  // if Rehome TFR exists
                                          debugPrintln("Rehome process exists. Stopping Rehome process...");
                                          var rehomeTFR = Document.readDoc("tfs.tfr", connection_id); // load document
                                          workflow.terminateProcessByOrderId(rehomeTFR.cwOrderId, "workflow.rehomingOrderProcess"); // stop Rehome process
                                      }
                                      else{
                                          debugPrintln("Rehome process does not exist.");
                                      }
                                    ]]></script>
                                  </method>
                                </methodList>
                              </child>
                            </childList>
                            <methodList>
                              <method name="cwOnProcActAfter" type="action">
                                <category>script</category>
                                <system>true</system>
                                <script><![CDATA[
                                  this.process.processDocument.isPRNRRevised = false;

                                  this.process.processOrder.prnrDocument.prnrStatus =  configuration.getExternalNameForStatusByInternalName("CANCELLED", "PRNR");
                                  this.process.processOrder.prnrDocument.cancelledDate = new Date();
                                  this.process.processOrder.prnrDocument.currentUserId = null;
                                  this.process.processOrder.prnrDocument.currentUserDepartment = null;
                                  this.process.processOrder.save();
                                ]]></script>
                              </method>
                            </methodList>
                          </child>
                        </childList>
                      </child>
                      <child name="isPRNRRevised" type="switchActivity">
                        <label>Is PRNR Revised?</label>
                        <x>1067.0975</x>
                        <y>2308.5208</y>
                        <childList>
                          <child name="yes" type="caseActivity">
                            <label>Yes</label>
                            <x>615.0</x>
                            <y>89.0</y>
                            <childList>
                              <child name="submitAgainPRNR" type="repeatActivity">
                                <element>proc_workflow.installOrderProcess_cwr8/seqActivity_start/seqActivity_startProvisioningWorkflow</element>
                                <label>Submit Again PRNR</label>
                                <x>1160.1112</x>
                                <y>2441.9749</y>
                              </child>
                            </childList>
                            <methodList>
                              <method name="cwOnProcActCond" type="action">
                                <category>cond</category>
                                <system>true</system>
                                <script>return this.process.processDocument.isPRNRRevised;</script>
                              </method>
                            </methodList>
                          </child>
                          <child name="no" type="caseActivity">
                            <label>No</label>
                            <x>819.0</x>
                            <y>193.0</y>
                            <childList>
                              <child name="end" type="completeActivity">
                                <label>End</label>
                                <x>1066.44</x>
                                <y>2456.676</y>
                                <methodList>
                                  <method name="cwOnProcActBefore" type="action">
                                    <category>before</category>
                                    <system>true</system>
                                    <script><![CDATA[
                                      debugPrintln(workflow.getLogHeaderForProcess(this.process.id) + "Completed: PRNR Rejected and cancelled by the initiator");
                                    ]]></script>
                                  </method>
                                </methodList>
                              </child>
                            </childList>
                          </child>
                        </childList>
                      </child>
                    </childList>
                  </child>
                </childList>
                <methodList>
                  <method name="cwOnProcActCond" type="action">
                    <category>cond</category>
                    <system>true</system>
                    <script>return (!this.process.processDocument.isPRNRAccepted);</script>
                  </method>
                </methodList>
              </child>
              <child name="yes" type="caseActivity">
                <label>Yes</label>
                <x>524.0</x>
                <y>532.0</y>
                <childList>
                  <child name="startPRNAndTFRManagement" type="seqActivity">
                    <label>Start PRN and TFR Management</label>
                    <x>1175.1986</x>
                    <y>1232.0133</y>
                    <childList>
                      <child name="skipReservationManagement" type="switchActivity">
                        <label>Skip Reservation Management?</label>
                        <x>682.9762</x>
                        <y>30.0</y>
                        <childList>
                          <child name="no" type="caseActivity">
                            <label>No</label>
                            <x>133.35756</x>
                            <y>945.18884</y>
                            <childList>
                              <child name="startReservationManagement" type="seqActivity">
                                <label>Start Reservation Management</label>
                                <x>758.12286</x>
                                <y>171.10353</y>
                                <childList>
                                  <child name="generatePRNUsingPRNR" type="scriptActivity">
                                    <label>Generate PRN Using PRNR</label>
                                    <x>761.5309</x>
                                    <y>273.21506</y>
                                    <methodList>
                                      <method name="cwOnProcActBefore" type="action">
                                        <category>before</category>
                                        <system>true</system>
                                        <script><![CDATA[
                                          debugPrintln("Generate PRN from PRNR...");

                                          // Note: in case of Revise, PRN document will be reused

                                          var prnDocument = this.process.processOrder.createOrderItemByPath("prnDocument");
                                          tfs.copyValuesUsing_STC_MAP_DOC2DOC(prnDocument, "PRN", this.process.processOrder.prnrDocument, "PRNR");
                                          prnDocument.prnrId = this.process.processOrder.prnrDocument.id;
                                          prnDocument.parentProcId = this.process.id;
                                          // need to reset cancelled date in case of Revise
                                          this.process.processOrder.prnDocument.cancelledDate=null;
                                          this.process.processOrder.save();

                                          debugPrintln("PRN generated.");
                                        ]]></script>
                                      </method>
                                    </methodList>
                                  </child>
                                  <child name="prepareToCreateReservation" type="opActivity">
                                    <element>iface_workflow.networkDesignTeamIF/oper_prepareToCreateReservation</element>
                                    <label>Prepare To Create Reservation</label>
                                    <participant>part_workflow.networkDesignParticipant</participant>
                                    <x>759.19006</x>
                                    <y>421.37033</y>
                                  </child>
                                  <child name="createReservation" type="opActivity">
                                    <element>iface_workflow.networkDesignTeamIF/oper_createReservation</element>
                                    <label>Create Reservation</label>
                                    <participant>part_workflow.networkDesignParticipant</participant>
                                    <x>747.13074</x>
                                    <y>897.08325</y>
                                    <methodList>
                                      <method name="cwOnProcActAfter" type="action">
                                        <category>script</category>
                                        <system>true</system>
                                        <script><![CDATA[
                                          this.process.processOrder.prnDocument.prnStatus =  configuration.getExternalNameForStatusByInternalName("RESERVATION CREATED", "PRN");
                                          this.process.processOrder.prnDocument.createdBy = workflow.getUserForOrder(this.process.processOrder.id, "0", "NetworkDesign"); // returns user current user id
                                          this.process.processOrder.save();
                                        ]]></script>
                                      </method>
                                    </methodList>
                                  </child>
                                  <child name="startGraniteReservationMngt" type="seqActivity">
                                    <label>Start Granite reservation management</label>
                                    <x>818.57275</x>
                                    <y>1518.3319</y>
                                    <childList>
                                      <child name="performReservationOnGranite" type="opActivity">
                                        <element>iface_workflow.networkDesignTeamIF/oper_performReservationOnGranite</element>
                                        <label>Perform Reservation On Granite</label>
                                        <participant>part_workflow.networkDesignParticipant</participant>
                                        <x>724.697</x>
                                        <y>1729.0549</y>
                                      </child>
                                      <child name="acceptOrRejectReservationOnGranite" type="choiceActivity">
                                        <label>Accept Or Reject Reservation On Granite</label>
                                        <x>819.2057</x>
                                        <y>606.8762</y>
                                        <childList>
                                          <child name="acceptReservationOnGranite" type="opActivity">
                                            <element>iface_workflow.networkDesignTeamIF/oper_acceptReservation</element>
                                            <label>Accept Reservation on Granite</label>
                                            <participant>part_workflow.networkDesignParticipant</participant>
                                            <x>867.162</x>
                                            <y>889.73267</y>
                                            <methodList>
                                              <method name="cwOnProcActAfter" type="action">
                                                <category>script</category>
                                                <system>true</system>
                                                <script><![CDATA[
                                                  this.process.processDocument.skipTFRGeneration = false;
                                                  this.process.processOrder.prnDocument.prnStatus =  configuration.getExternalNameForStatusByInternalName("RESERVATION_PERFORMED", "PRN");
                                                  this.process.processOrder.save();
                                                ]]></script>
                                              </method>
                                            </methodList>
                                          </child>
                                          <child name="issueInReservation" type="opActivity">
                                            <element>iface_workflow.networkDesignTeamIF/oper_issueInReservation</element>
                                            <label>Issue in reservation</label>
                                            <participant>part_workflow.networkDesignParticipant</participant>
                                            <x>1013.3831</x>
                                            <y>897.08325</y>
                                            <childList>
                                              <child name="startAsyncBIManagement" type="seqActivity">
                                                <label>Start async Blocking Issue management</label>
                                                <x>985.9403</x>
                                                <y>1073.2684</y>
                                                <childList>
                                                  <child name="startBIForPRN" type="scriptActivity">
                                                    <label>Start Blocking Issue for PRN</label>
                                                    <x>989.87976</x>
                                                    <y>1208.9915</y>
                                                    <methodList>
                                                      <method name="cwOnProcActBefore" type="action">
                                                        <category>before</category>
                                                        <system>true</system>
                                                        <script><![CDATA[
                                                          debugPrintln("Requested BI Management for PRN");

                                                          this.process.processDocument.isBICreatedDuringReservation = true;

                                                          var processId = Process.startProcess("workflow.biAssociationProcess", this.process.processOrder.id, this.process.processOrder.prnDocument.id);

                                                          var dataSharing = new Document("workflow.dataSharingForBIAssociation");
                                                          dataSharing.processId = processId;
                                                          dataSharing.parentProcessId = this.process.id;
                                                          dataSharing.requestNotification = false;
                                                          dataSharing.save();

                                                          debugPrintln(workflow.getLogHeaderForProcess(this.process.id) + "Started BI Association Process with id " + processId);
                                                        ]]></script>
                                                      </method>
                                                    </methodList>
                                                  </child>
                                                  <child name="repeatReservationAfterBIStarted" type="repeatActivity">
                                                    <element>proc_workflow.installOrderProcess_cwr8/seqActivity_start/seqActivity_startProvisioningWorkflow/switchActivity_isPRNRAccepted/caseActivity_yes/seqActivity_startPRNAndTFRManagement/switchActivity_skipReservationManagement/caseActivity_no/seqActivity_startReservationManagement/seqActivity_startGraniteReservationMngt</element>
                                                    <label>Repeat reservation after BI started</label>
                                                    <x>983.20886</x>
                                                    <y>1349.7961</y>
                                                  </child>
                                                </childList>
                                              </child>
                                            </childList>
                                          </child>
                                        </childList>
                                      </child>
                                    </childList>
                                  </child>
                                </childList>
                              </child>
                            </childList>
                            <methodList>
                              <method name="cwOnProcActCond" type="action">
                                <category>cond</category>
                                <system>true</system>
                                <script>return (!this.process.processDocument.skipReservationManagement);</script>
                              </method>
                            </methodList>
                          </child>
                          <child name="yes" type="caseActivity">
                            <label>Yes</label>
                            <x>57.98767</x>
                            <y>436.0715</y>
                          </child>
                        </childList>
                      </child>
                      <child name="skipTFRGeneration" type="switchActivity">
                        <label>Skip TFR Generation?</label>
                        <x>53.30542</x>
                        <y>1067.888</y>
                        <childList>
                          <child name="no" type="caseActivity">
                            <label>No</label>
                            <x>133.35756</x>
                            <y>945.18884</y>
                            <childList>
                              <child name="submitTFRManagement" type="seqActivity">
                                <label>Submit TFR Management</label>
                                <x>74.65273</x>
                                <y>1232.0133</y>
                                <childList>
                                  <child name="generateTFRUsingPRN" type="scriptActivity">
                                    <label>Generate TFR Using PRN</label>
                                    <x>70.0</x>
                                    <y>1357.1467</y>
                                    <methodList>
                                      <method name="cwOnProcActBefore" type="action">
                                        <category>before</category>
                                        <system>true</system>
                                        <script><![CDATA[
                                          /****
                                          var sem = theAVM.getSemaphore("TFRNumberLock");
                                          if(!sem){
                                           sem = theAVM.setSemaphore("TFRNumberLock",0);
                                          }
                                          while( sem > 0){
                                            sem = theAVM.getSemaphore("TFRNumberLock");
                                          }
                                          theAVM.setSemaphore("TFRNumberLock",0,1);

                                          ***/

                                          var tfrDocument = this.process.processOrder.createOrderItemByPath("tfrDocument");
                                          tfs.copyValuesUsing_STC_MAP_DOC2DOC(tfrDocument, "TFR", this.process.processOrder.prnDocument, "PRN");
                                          tfrDocument.prnId = this.process.processOrder.prnDocument.id;
                                          tfrDocument.generateTFRNumber();
                                          tfrDocument.save();

                                          // theAVM.setSemaphore("TFRNumberLock",1,0);

                                          this.process.processOrder.save(); // save tfr to be able to create connection between reconnect and source TFR
                                          // if current porcess is started from Rehoming
                                          if( this.process.processOrder.prnrDocument.connectionTFRId ){
                                              //debugPrintln("Connection TFR exists. Setting in TFR ids to the Source and Reconnected TFRs.");
                                              var sourceTFR = Document.readDoc("tfs.tfr", this.process.processOrder.prnrDocument.connectionTFRId); // load source TFR
                                              //debugPrintln("sourceTFR:"+sourceTFR+" type:"+typeof(sourceTFR));
                                              //debugPrintln("New TFR:"+tfrDocument.tfrId);
                                              if ( sourceTFR ){ // if such document exists
                                                  sourceTFR.connectionTFRId = tfrDocument.tfrId; // set in reconnect tfr id to source TFR id
                                                  tfrDocument.connectionTFRId = this.process.processOrder.prnrDocument.connectionTFRId; // set in connection tfr id with source TFR id
                                                  //tfrDocument.parentProcId = this.process.processOrder.prnrDocument.parentProcId; // need to define if Install started from Rehome
                                                  tfrDocument.tfrStatus = configuration.getExternalNameForStatusByInternalName("SUBMIT", "TFR"); // set status of reconnect tfr to SUBMIT
                                                  sourceTFR.save();
                                              }
                                          }

                                          //this.process.processOrder.tfrDocument.parentProcId = this.process.processOrder.prnrDocument.parentProcId; // map parentProcId from PRNR to TFR to be able to terminate Rehome process on TFR Cancell
                                          this.process.processOrder.prnDocument.tfrId = tfrDocument.id;
                                          this.process.processOrder.save();
                                        ]]></script>
                                      </method>
                                    </methodList>
                                  </child>
                                  <child name="prepareToSubmitTFR" type="opActivity">
                                    <element>iface_workflow.orderInitiatorTeamIF/oper_prepareToSubmitTFR</element>
                                    <label>Prepare To Submit TFR</label>
                                    <participant>part_workflow.installOrderInitiatorParticipant</participant>
                                    <x>291.3391</x>
                                    <y>1505.6008</y>
                                  </child>
                                  <child name="submitTFR" type="opActivity">
                                    <element>iface_workflow.orderInitiatorTeamIF/oper_submitTFR</element>
                                    <label>Submit TFR</label>
                                    <participant>part_workflow.installOrderInitiatorParticipant</participant>
                                    <x>273.0271</x>
                                    <y>2026.9114</y>
                                    <methodList>
                                      <method name="cwOnProcActBefore" type="action">
                                        <category>before</category>
                                        <system>true</system>
                                        <script><![CDATA[
                                          this.process.processOrder.tfrDocument.tfrStatus =  configuration.getExternalNameForStatusByInternalName("SUBMIT", "TFR");
                                          this.process.processOrder.tfrDocument.creationDate = new Date();
                                          this.process.processOrder.save();

                                          this.process.processDocument.skipFacilityDesignTeamActivities = false;
                                        ]]></script>
                                      </method>
                                      <method name="cwOnProcActAfter" type="action">
                                        <category>script</category>
                                        <system>true</system>
                                        <script><![CDATA[
                                          debugPrintln("Set TFR Status to SUBMIT");
                                          this.process.processOrder.tfrDocument.tfrStatus =  configuration.getExternalNameForStatusByInternalName("SUBMIT", "TFR");
                                          this.process.processOrder.tfrDocument.creationDate = new Date();
                                          this.process.processOrder.save();

                                          this.process.processDocument.skipFacilityDesignTeamActivities = false;
                                        ]]></script>
                                      </method>
                                    </methodList>
                                  </child>
                                </childList>
                              </child>
                            </childList>
                            <methodList>
                              <method name="cwOnProcActCond" type="action">
                                <category>cond</category>
                                <system>true</system>
                                <script>return (!this.process.processDocument.skipTFRGeneration);</script>
                              </method>
                            </methodList>
                          </child>
                          <child name="yes" type="caseActivity">
                            <label>Yes</label>
                            <x>30.0</x>
                            <y>1520.302</y>
                          </child>
                        </childList>
                      </child>
                      <child name="skipWaitForBIOnReservation" type="switchActivity">
                        <label>Skip Wait For BI On Reservation?</label>
                        <x>130.83911</x>
                        <y>2167.716</y>
                        <childList>
                          <child name="no" type="caseActivity">
                            <label>No</label>
                            <x>316.25702</x>
                            <y>2521.224</y>
                            <childList>
                              <child name="waitForBIOnReservation" type="syncActivity">
                                <element>signal_workflow.wakeUpParent</element>
                                <label>Wait For BI On Reservation</label>
                                <x>184.18384</x>
                                <y>2301.1702</y>
                                <methodList>
                                  <method name="cwOnProcActAfter" type="action">
                                    <category>script</category>
                                    <system>true</system>
                                    <script><![CDATA[
                                      this.process.processOrder.prnDocument.prnStatus =  configuration.getExternalNameForStatusByInternalName("ISSUE IN COMPLETING RESERVATION SOLVED", "PRN");
                                      this.process.processOrder.save();
                                    ]]></script>
                                  </method>
                                </methodList>
                              </child>
                            </childList>
                            <methodList>
                              <method name="cwOnProcActCond" type="action">
                                <category>cond</category>
                                <system>true</system>
                                <script><![CDATA[
                                  // return this.process.processDocument.isBICreatedDuringReservation;

                                  var hasToWait = false;

                                  if(this.process.processOrder.prnDocument != null) {
                                      var biFinder = new Finder("tfs.findBIForPRNOrTFR");
                                      biFinder.searchDocument.sourcePRNId = this.process.processOrder.prnDocument.prnId;
                                      var biFoundList = biFinder.search();

                                      hasToWait = (biFoundList != null && biFoundList.length > 0);
                                  }

                                  return hasToWait;
                                ]]></script>
                              </method>
                            </methodList>
                          </child>
                          <child name="yes" type="caseActivity">
                            <label>Yes</label>
                            <x>100.18384</x>
                            <y>2315.8713</y>
                          </child>
                        </childList>
                      </child>
                      <child name="skipFacilityDesignTeamActivities" type="switchActivity">
                        <label>Skip Facility Design Team Activities?</label>
                        <x>134.177</x>
                        <y>2434.6243</y>
                        <childList>
                          <child name="no" type="caseActivity">
                            <label>No</label>
                            <x>508.6974</x>
                            <y>2356.224</y>
                            <childList>
                              <child name="start" type="seqActivity">
                                <label>Start</label>
                                <x>420.37878</x>
                                <y>2614.8313</y>
                                <childList>
                                  <child name="prepareToCompleteNI" type="opActivity">
                                    <element>iface_workflow.facilityDesignTeamIF/oper_prepareToCompleteNI</element>
                                    <label>Prepare To Complete NI</label>
                                    <participant>part_workflow.facilityDesignTeamParticipant</participant>
                                    <x>458.1584</x>
                                    <y>2761.2336</y>
                                    <methodList>
                                      <method name="cwOnProcActBefore" type="action">
                                        <category>before</category>
                                        <system>true</system>
                                        <script><![CDATA[
                                          debugPrintln("Task Assigned to Facility Team");


                                          this.process.processDocument.isCompleteNIOK = false;
                                          this.process.processDocument.assignToXC = false;
                                          this.process.processDocument.rejectToInitiator = false;
                                        ]]></script>
                                      </method>
                                    </methodList>
                                  </child>
                                  <child name="completeNIOrRequestBIOrRejectToInitiatorTeam" type="choiceActivity">
                                    <label>Complete NI Or Request BI Or Reject To Initiator Team</label>
                                    <x>269.28003</x>
                                    <y>592.17505</y>
                                    <childList>
                                      <child name="crossConnectionRequired" type="opActivity">
                                        <element>iface_workflow.facilityDesignTeamIF/oper_xcRequired</element>
                                        <label>Cross-Connection Required</label>
                                        <participant>part_workflow.facilityDesignTeamParticipant</participant>
                                        <x>522.1198</x>
                                        <y>889.73267</y>
                                        <methodList>
                                          <method name="cwOnProcActAfter" type="action">
                                            <category>script</category>
                                            <system>true</system>
                                            <script><![CDATA[
                                              this.process.processOrder.tfrDocument.tfrStatus =  configuration.getExternalNameForStatusByInternalName("CROSS-CONNECTION REQUIRED", "TFR");
                                              this.process.processOrder.save();

                                              this.process.processDocument.isCompleteNIOK = true;
                                              this.process.processDocument.assignToXC = true;
                                              this.process.processDocument.rejectToInitiator = false;
                                            ]]></script>
                                          </method>
                                        </methodList>
                                      </child>
                                      <child name="crossConnectionNotRequired" type="opActivity">
                                        <element>iface_workflow.facilityDesignTeamIF/oper_xcNotRequired</element>
                                        <label>Cross Connection not Required</label>
                                        <participant>part_workflow.facilityDesignTeamParticipant</participant>
                                        <x>413.41083</x>
                                        <y>882.3821</y>
                                        <methodList>
                                          <method name="cwOnProcActAfter" type="action">
                                            <category>script</category>
                                            <system>true</system>
                                            <script><![CDATA[
                                              this.process.processOrder.tfrDocument.tfrStatus =  configuration.getExternalNameForStatusByInternalName("NO CROSS-CONNECTION REQUIRED", "TFR");
                                              this.process.processOrder.save();

                                              this.process.processDocument.isCompleteNIOK = true;
                                              this.process.processDocument.assignToXC = false;
                                              this.process.processDocument.rejectToInitiator = false;
                                            ]]></script>
                                          </method>
                                        </methodList>
                                      </child>
                                      <child name="rejectToInitiator" type="opActivity">
                                        <element>iface_workflow.facilityDesignTeamIF/oper_rejectToInitiator</element>
                                        <label>Reject To Initiator</label>
                                        <participant>part_workflow.facilityDesignTeamParticipant</participant>
                                        <x>286.71948</x>
                                        <y>897.08325</y>
                                        <methodList>
                                          <method name="cwOnProcActAfter" type="action">
                                            <category>script</category>
                                            <system>true</system>
                                            <script><![CDATA[
                                              this.process.processDocument.isCompleteNIOK = false;
                                              this.process.processDocument.assignToXC = false;
                                              this.process.processDocument.rejectToInitiator = true;
                                            ]]></script>
                                          </method>
                                        </methodList>
                                      </child>
                                      <child name="requestBITicket" type="opActivity">
                                        <element>iface_workflow.facilityDesignTeamIF/oper_requestBI</element>
                                        <label>Request BI Ticket</label>
                                        <participant>part_workflow.facilityDesignTeamParticipant</participant>
                                        <x>175.3523</x>
                                        <y>897.08325</y>
                                        <methodList>
                                          <method name="cwOnProcActAfter" type="action">
                                            <category>script</category>
                                            <system>true</system>
                                            <script><![CDATA[
                                              this.process.processOrder.tfrDocument.tfrStatus =  configuration.getExternalNameForStatusByInternalName("ISSUE IN COMPLETING NI", "TFR");
                                              this.process.processOrder.save();

                                              this.process.processDocument.isCompleteNIOK = false;
                                              this.process.processDocument.assignToXC = false;
                                              this.process.processDocument.rejectToInitiator = false;
                                            ]]></script>
                                          </method>
                                        </methodList>
                                      </child>
                                    </childList>
                                  </child>
                                  <child name="possibleProceedWithNextStep" type="switchActivity">
                                    <label>Possible Proceed With Next Step?</label>
                                    <x>341.7439</x>
                                    <y>1053.1868</y>
                                    <childList>
                                      <child name="notProceed" type="caseActivity">
                                        <label>Not Proceed</label>
                                        <x>503.51935</x>
                                        <y>1438.2822</y>
                                        <childList>
                                          <child name="backToInitiator" type="switchActivity">
                                            <label>Back To Initiator?</label>
                                            <x>433.6214</x>
                                            <y>1223.6926</y>
                                            <childList>
                                              <child name="rejectedToInitiator" type="caseActivity">
                                                <label>Rejected To Initiator</label>
                                                <x>121.350586</x>
                                                <y>3547.9785</y>
                                                <childList>
                                                  <child name="start" type="seqActivity">
                                                    <label>Start Revise TFR</label>
                                                    <x>414.82364</x>
                                                    <y>1374.1985</y>
                                                    <childList>
                                                      <child name="prepareToReviseTFR" type="opActivity">
                                                        <element>iface_workflow.orderInitiatorTeamIF/oper_prepareToReviseTFR</element>
                                                        <label>Prepare To Revise TFR</label>
                                                        <participant>part_workflow.installOrderInitiatorParticipant</participant>
                                                        <x>466.42328</x>
                                                        <y>1512.9514</y>
                                                      </child>
                                                      <child name="reviseTFR" type="opActivity">
                                                        <element>iface_workflow.orderInitiatorTeamIF/oper_reviseTFR</element>
                                                        <label>Revise TFR</label>
                                                        <participant>part_workflow.installOrderInitiatorParticipant</participant>
                                                        <x>470.3827</x>
                                                        <y>2034.262</y>
                                                        <methodList>
                                                          <method name="cwOnProcActBefore" type="action">
                                                            <category>before</category>
                                                            <system>true</system>
                                                            <script><![CDATA[
                                                              this.process.processOrder.tfrDocument.tfrStatus =  configuration.getExternalNameForStatusByInternalName("REVISED", "TFR");
                                                              this.process.processOrder.save();
                                                            ]]></script>
                                                          </method>
                                                          <method name="cwOnProcActAfter" type="action">
                                                            <category>script</category>
                                                            <system>true</system>
                                                            <script><![CDATA[
                                                              debugPrintln("Setting TFR status to REVISED");
                                                              this.process.processOrder.tfrDocument.tfrStatus =  configuration.getExternalNameForStatusByInternalName("REVISED", "TFR");
                                                              this.process.processOrder.save();
                                                            ]]></script>
                                                          </method>
                                                        </methodList>
                                                      </child>
                                                      <child name="returnToDesignFacilityTeam" type="repeatActivity">
                                                        <element>proc_workflow.installOrderProcess_cwr8/seqActivity_start/seqActivity_startProvisioningWorkflow/switchActivity_isPRNRAccepted/caseActivity_yes/seqActivity_startPRNAndTFRManagement/switchActivity_skipFacilityDesignTeamActivities/caseActivity_no/seqActivity_start</element>
                                                        <label>Return To Design Facility Team</label>
                                                        <x>475.37488</x>
                                                        <y>2293.8196</y>
                                                      </child>
                                                    </childList>
                                                  </child>
                                                </childList>
                                                <methodList>
                                                  <method name="cwOnProcActCond" type="action">
                                                    <category>cond</category>
                                                    <system>true</system>
                                                    <script>return (this.process.processDocument.rejectToInitiator);</script>
                                                  </method>
                                                </methodList>
                                              </child>
                                              <child name="createBITicket" type="caseActivity">
                                                <label>Create BI Ticket</label>
                                                <x>464.0</x>
                                                <y>1252.0</y>
                                                <childList>
                                                  <child name="startIssueInFacilityDesignManagement" type="seqActivity">
                                                    <label>Start Issue In Facility Design Management</label>
                                                    <x>589.53467</x>
                                                    <y>1518.3319</y>
                                                    <childList>
                                                      <child name="biProcForFacilityManagement" type="scriptActivity">
                                                        <label>Start Blocking Issue process for Facility Management</label>
                                                        <x>581.72253</x>
                                                        <y>1997.509</y>
                                                        <methodList>
                                                          <method name="cwOnProcActBefore" type="action">
                                                            <category>before</category>
                                                            <system>true</system>
                                                            <script><![CDATA[
                                                              debugPrintln("Requested BI Management for TFR");

                                                              var processId = Process.startProcess("workflow.biAssociationProcess", this.process.processOrder.id, this.process.processOrder.tfrDocument.id);

                                                              var dataSharing = new Document("workflow.dataSharingForBIAssociation");
                                                              dataSharing.processId = processId;
                                                              dataSharing.parentProcessId = this.process.id;
                                                              dataSharing.requestNotification = true;
                                                              dataSharing.save();

                                                              debugPrintln(workflow.getLogHeaderForProcess(this.process.id) + "Started BI Association Process with id " + processId);
                                                            ]]></script>
                                                          </method>
                                                        </methodList>
                                                      </child>
                                                      <child name="wait" type="syncActivity">
                                                        <element>signal_workflow.wakeUpParent</element>
                                                        <label>Wait</label>
                                                        <x>600.744</x>
                                                        <y>2315.8713</y>
                                                      </child>
                                                      <child name="issueInFacilityManagementSolved" type="repeatActivity">
                                                        <element>proc_workflow.installOrderProcess_cwr8/seqActivity_start/seqActivity_startProvisioningWorkflow/switchActivity_isPRNRAccepted/caseActivity_yes/seqActivity_startPRNAndTFRManagement/switchActivity_skipFacilityDesignTeamActivities/caseActivity_no/seqActivity_start</element>
                                                        <label>Issue In Reservation Solved</label>
                                                        <x>584.7284</x>
                                                        <y>2441.9749</y>
                                                        <methodList>
                                                          <method name="cwOnProcActBefore" type="action">
                                                            <category>before</category>
                                                            <system>true</system>
                                                            <script><![CDATA[
                                                              this.process.processOrder.tfrDocument.tfrStatus =  configuration.getExternalNameForStatusByInternalName("ISSUE IN COMPLETING NI SOLVED", "TFR");
                                                              this.process.processOrder.save();
                                                            ]]></script>
                                                          </method>
                                                        </methodList>
                                                      </child>
                                                    </childList>
                                                  </child>
                                                </childList>
                                              </child>
                                            </childList>
                                          </child>
                                        </childList>
                                        <methodList>
                                          <method name="cwOnProcActCond" type="action">
                                            <category>cond</category>
                                            <system>true</system>
                                            <script>return (! this.process.processDocument.isCompleteNIOK);</script>
                                          </method>
                                        </methodList>
                                      </child>
                                      <child name="proceedWithNextStep" type="caseActivity">
                                        <label>Proceed With Next Step</label>
                                        <x>366.37488</x>
                                        <y>2019.5608</y>
                                      </child>
                                    </childList>
                                  </child>
                                </childList>
                              </child>
                            </childList>
                            <methodList>
                              <method name="cwOnProcActCond" type="action">
                                <category>cond</category>
                                <system>true</system>
                                <script>return (!this.process.processDocument.skipFacilityDesignTeamActivities);</script>
                              </method>
                            </methodList>
                          </child>
                          <child name="yes" type="caseActivity">
                            <label>Yes</label>
                            <x>138.18677</x>
                            <y>2612.4807</y>
                          </child>
                        </childList>
                      </child>
                      <child name="assignToXCTeam" type="switchActivity">
                        <label>Assign To XC Team?</label>
                        <x>250.60162</x>
                        <y>2768.5842</y>
                        <childList>
                          <child name="yes" type="caseActivity">
                            <label>Yes</label>
                            <x>937.06116</x>
                            <y>2189.8218</y>
                            <childList>
                              <child name="startXCManagement" type="seqActivity">
                                <label>Start XC Management</label>
                                <x>266.16257</x>
                                <y>2895.658</y>
                                <childList>
                                  <child name="performXC" type="opActivity">
                                    <element>iface_workflow.xcTeamIF/oper_performCrossConnection</element>
                                    <label>Perform CrossConnection</label>
                                    <participant>part_workflow.xcTeamParticipant</participant>
                                    <x>316.83948</x>
                                    <y>3021.09</y>
                                  </child>
                                  <child name="xcConnectionManagement" type="choiceActivity">
                                    <label>XC Connection Management</label>
                                    <x>255.82971</x>
                                    <y>3154.843</y>
                                    <childList>
                                      <child name="switchActivationNotRequired" type="opActivity">
                                        <element>iface_workflow.xcTeamIF/oper_switchActivationNotRequired</element>
                                        <label>Switch Activation Not Required</label>
                                        <participant>part_workflow.xcTeamParticipant</participant>
                                        <x>236.82092</x>
                                        <y>3422.05</y>
                                        <methodList>
                                          <method name="cwOnProcActAfter" type="action">
                                            <category>script</category>
                                            <system>true</system>
                                            <script><![CDATA[
                                              this.process.processOrder.tfrDocument.tfrStatus =  configuration.getExternalNameForStatusByInternalName("SWITCH ACTIVATION NOT REQUIRED", "TFR");
                                              this.process.processOrder.save();
                                            ]]></script>
                                          </method>
                                        </methodList>
                                      </child>
                                      <child name="switchActivationRequired" type="opActivity">
                                        <element>iface_workflow.xcTeamIF/oper_switchActivationRequired</element>
                                        <label>Switch Activation Required</label>
                                        <participant>part_workflow.xcTeamParticipant</participant>
                                        <x>336.84143</x>
                                        <y>3280.9465</y>
                                        <childList>
                                          <child name="startSwitchActivationActivities" type="seqActivity">
                                            <label>Start Switch Activation Activities</label>
                                            <x>325.77444</x>
                                            <y>3445.072</y>
                                            <childList>
                                              <child name="prepareToCompleteSwitchActivation" type="opActivity">
                                                <element>iface_workflow.switchActivationTeamIF/oper_prepareToCompleteActivation</element>
                                                <label>Prepare To Complete Switch Activation</label>
                                                <participant>part_workflow.switchActivationParticipant</participant>
                                                <x>295.07666</x>
                                                <y>3562.8547</y>
                                              </child>
                                              <child name="switchActivationCompleted" type="opActivity">
                                                <element>iface_workflow.switchActivationTeamIF/oper_switchActivationCompleted</element>
                                                <label>Switch Activation Completed</label>
                                                <participant>part_workflow.switchActivationParticipant</participant>
                                                <x>296.07568</x>
                                                <y>3844.464</y>
                                                <methodList>
                                                  <method name="cwOnProcActAfter" type="action">
                                                    <category>script</category>
                                                    <system>true</system>
                                                    <script><![CDATA[
                                                      this.process.processOrder.tfrDocument.tfrStatus =  configuration.getExternalNameForStatusByInternalName("SWITCH ACTIVATION COMPLETED", "TFR");
                                                      this.process.processOrder.save();
                                                    ]]></script>
                                                  </method>
                                                </methodList>
                                              </child>
                                            </childList>
                                          </child>
                                        </childList>
                                        <methodList>
                                          <method name="cwOnProcActAfter" type="action">
                                            <category>script</category>
                                            <system>true</system>
                                            <script><![CDATA[
                                              this.process.processOrder.tfrDocument.tfrStatus =  configuration.getExternalNameForStatusByInternalName("SWITCH ACTIVATION REQUIRED", "TFR");
                                              this.process.processOrder.save();
                                            ]]></script>
                                          </method>
                                        </methodList>
                                      </child>
                                    </childList>
                                  </child>
                                  <child name="startLoadingTasksForIntermediateSites" type="seqActivity">
                                    <label>Start loading tasks for intermediate sites</label>
                                    <x>258.4828</x>
                                    <y>3970.5676</y>
                                    <childList>
                                      <child name="loadIntermediateSiteTasks" type="opActivity">
                                        <element>iface_workflow.xcTeamIF/oper_loadIntermediateSitesTasks</element>
                                        <label>Load intermediate site tasks</label>
                                        <participant>part_workflow.xcTeamParticipant</participant>
                                        <x>340.2671</x>
                                        <y>4071.209</y>
                                      </child>
                                      <child name="intermediateSitesTasksLoaded" type="opActivity">
                                        <element>iface_workflow.xcTeamIF/oper_intermediateSitesTasksLoaded</element>
                                        <label>Intermediate sites tasks loaded</label>
                                        <participant>part_workflow.xcTeamParticipant</participant>
                                        <x>389.09033</x>
                                        <y>4197.3125</y>
                                        <methodList>
                                          <method name="cwOnProcActBefore" type="action">
                                            <category>before</category>
                                            <system>true</system>
                                            <script><![CDATA[
                                              this.process.processOrder.tfrDocument.tfrStatus =  configuration.getExternalNameForStatusByInternalName("LOADED INTERMEDIATE SITE TASKS", "TFR");
                                              this.process.processOrder.save();
                                            ]]></script>
                                          </method>
                                        </methodList>
                                      </child>
                                      <child name="cleanTFRUser" type="scriptActivity">
                                        <label>Clean TFR user</label>
                                        <x>393.43506</x>
                                        <y>4323.416</y>
                                        <methodList>
                                          <method name="cwOnProcActBefore" type="action">
                                            <category>before</category>
                                            <system>true</system>
                                            <script><![CDATA[
                                              // clean TFR user after XC activities finished
                                              this.process.processOrder.tfrDocument.currentUserId=null;
                                              this.process.processOrder.save();
                                            ]]></script>
                                          </method>
                                        </methodList>
                                      </child>
                                    </childList>
                                  </child>
                                </childList>
                              </child>
                            </childList>
                            <methodList>
                              <method name="cwOnProcActCond" type="action">
                                <category>cond</category>
                                <system>true</system>
                                <script>return (this.process.processDocument.assignToXC);</script>
                              </method>
                            </methodList>
                          </child>
                          <child name="no" type="caseActivity">
                            <label>No</label>
                            <x>196.82092</x>
                            <y>3725.7112</y>
                          </child>
                        </childList>
                      </child>
                      <child name="startQualityTeamManagement" type="seqActivity">
                        <label>Start Quality Team Management</label>
                        <x>279.6189</x>
                        <y>4457.8403</y>
                        <childList>
                          <child name="loadA_ZSiteTasks" type="scriptActivity">
                            <label>Load A &amp; Z Site Tasks</label>
                            <x>285.61383</x>
                            <y>4590.324</y>
                            <methodList>
                              <method name="cwOnProcActBefore" type="action">
                                <category>before</category>
                                <system>true</system>
                                <script><![CDATA[
                                  workflow.createTaskForSite(this.process.processOrder, true);
                                  workflow.createTaskForSite(this.process.processOrder, false);
                                  workflow.createEnd2EndTask(this.process.processOrder);

                                  for(var i=0; i<this.process.processOrder.tasks.length; i++) {
                                      this.process.processOrder.tasks[i].tfrTask.tfrRevisionNumber = this.process.processOrder.tfrDocument.revision;
                                      this.process.processOrder.tasks[i].tfrTask.save();
                                  }


                                  this.process.processOrder.tfrDocument.tfrStatus =  configuration.getExternalNameForStatusByInternalName("LOADED A & Z SITE TASKS", "TFR");
                                  this.process.processOrder.save();

                                  this.process.processDocument.tasksStarted = 0;
                                  this.process.processDocument.tasksCompleted = 0;
                                ]]></script>
                              </method>
                            </methodList>
                          </child>
                          <child name="allTasksStarted" type="switchActivity">
                            <label>All Tasks Started?</label>
                            <x>312.43024</x>
                            <y>4716.4277</y>
                            <childList>
                              <child name="no" type="caseActivity">
                                <label>No</label>
                                <x>1566.0</x>
                                <y>1992.0</y>
                                <childList>
                                  <child name="startNthTaskManagement" type="seqActivity">
                                    <label>Start N-th Task Management</label>
                                    <x>308.50153</x>
                                    <y>4828.8003</y>
                                    <childList>
                                      <child name="processTask" type="scriptActivity">
                                        <label>Process Task</label>
                                        <x>315.10114</x>
                                        <y>4924.5312</y>
                                        <methodList>
                                          <method name="cwOnProcActBefore" type="action">
                                            <category>before</category>
                                            <system>true</system>
                                            <script><![CDATA[
                                              debugPrintln(workflow.getLogHeaderForProcess(this.process.id) + "Starting workflow for Task  # " + (this.process.processDocument.tasksStarted + 1));

                                              if(!this.process.processOrder.tasks[this.process.processDocument.tasksStarted].tfrTask.isEnd2End) {
                                                  var childElementId = this.process.processOrder.tasks[this.process.processDocument.tasksStarted].tfrTask.id;
                                                  this.process.processOrder.tasks[this.process.processDocument.tasksStarted].tfrTask.parentProcessId = this.process.id;
                                                  this.process.processOrder.save();

                                                  var processId = Process.startProcess("workflow:taskManagementProcess", this.process.processOrder.id, childElementId);

                                                  debugPrintln(workflow.getLogHeaderForProcess(this.process.id) + "Started workflow for Task #"  + (this.process.processDocument.tasksStarted + 1) + "; elementId = " +  childElementId + "; processId = " + processId);
                                              }
                                              else {
                                                  debugPrintln(workflow.getLogHeaderForProcess(this.process.id) + "Doesn't started workflow for Task #"  + (this.process.processDocument.tasksStarted + 1) + " because it's an End2End task");
                                              }
                                            ]]></script>
                                          </method>
                                        </methodList>
                                      </child>
                                      <child name="repeatTaskManagement" type="repeatActivity">
                                        <element>proc_workflow.installOrderProcess_cwr8/seqActivity_start/seqActivity_startProvisioningWorkflow/switchActivity_isPRNRAccepted/caseActivity_yes/seqActivity_startPRNAndTFRManagement/seqActivity_startQualityTeamManagement/switchActivity_allTasksStarted</element>
                                        <label>Repeat Task Management</label>
                                        <x>263.42017</x>
                                        <y>5050.9336</y>
                                        <methodList>
                                          <method name="cwOnProcActBefore" type="action">
                                            <category>before</category>
                                            <system>true</system>
                                            <script><![CDATA[
                                              this.process.processDocument.tasksStarted++;

                                              return;
                                            ]]></script>
                                          </method>
                                        </methodList>
                                      </child>
                                    </childList>
                                  </child>
                                </childList>
                                <methodList>
                                  <method name="cwOnProcActCond" type="action">
                                    <category>cond</category>
                                    <system>true</system>
                                    <script><![CDATA[
                                      return (this.process.processDocument.tasksStarted < this.process.processOrder.tasks.length);
                                    ]]></script>
                                  </method>
                                </methodList>
                              </child>
                              <child name="yes" type="caseActivity">
                                <label>Yes</label>
                                <x>475.62677</x>
                                <y>4827.83</y>
                              </child>
                            </childList>
                          </child>
                          <child name="allTasksCompleted" type="switchActivity">
                            <label>All Tasks Completed?</label>
                            <x>459.26642</x>
                            <y>4924.5312</y>
                            <childList>
                              <child name="no" type="caseActivity">
                                <label>No</label>
                                <x>1566.0</x>
                                <y>1992.0</y>
                                <childList>
                                  <child name="start" type="seqActivity">
                                    <label>Start</label>
                                    <x>457.0672</x>
                                    <y>5067.9854</y>
                                    <childList>
                                      <child name="waitForTaskManagementCompletion" type="syncActivity">
                                        <element>signal_workflow.wakeUpParentForTaskProcess</element>
                                        <label>Wait For Task Management Completion</label>
                                        <x>444.04572</x>
                                        <y>5177.037</y>
                                        <methodList>
                                          <method name="cwOnProcActAfter" type="action">
                                            <category>script</category>
                                            <system>true</system>
                                            <script><![CDATA[
                                              debugPrintln(workflow.getLogHeaderForProcess(this.process.id) + "Received wakeup from workflow for Task #"  + (this.process.processDocument.tasksCompleted + 1));
                                            ]]></script>
                                          </method>
                                        </methodList>
                                      </child>
                                      <child name="repeatTaskManagement" type="repeatActivity">
                                        <element>proc_workflow.installOrderProcess_cwr8/seqActivity_start/seqActivity_startProvisioningWorkflow/switchActivity_isPRNRAccepted/caseActivity_yes/seqActivity_startPRNAndTFRManagement/seqActivity_startQualityTeamManagement/switchActivity_allTasksCompleted</element>
                                        <label>Repeat Task Management</label>
                                        <x>408.53497</x>
                                        <y>5332.842</y>
                                        <methodList>
                                          <method name="cwOnProcActBefore" type="action">
                                            <category>before</category>
                                            <system>true</system>
                                            <script><![CDATA[
                                              this.process.processDocument.tasksCompleted++;

                                              return;
                                            ]]></script>
                                          </method>
                                        </methodList>
                                      </child>
                                    </childList>
                                  </child>
                                </childList>
                                <methodList>
                                  <method name="cwOnProcActCond" type="action">
                                    <category>cond</category>
                                    <system>true</system>
                                    <script><![CDATA[
                                      return (this.process.processDocument.tasksCompleted < (this.process.processOrder.tasks.length - 1)); // now there is the End2End task that doesn't have a workflow
                                    ]]></script>
                                  </method>
                                </methodList>
                              </child>
                              <child name="yes" type="caseActivity">
                                <label>Yes</label>
                                <x>571.7674</x>
                                <y>5065.635</y>
                              </child>
                            </childList>
                          </child>
                          <child name="completeEnd2EndTask" type="scriptActivity">
                            <label>Complete End2End Task</label>
                            <x>562.0887</x>
                            <y>5184.3877</y>
                            <methodList>
                              <method name="cwOnProcActBefore" type="action">
                                <category>before</category>
                                <system>true</system>
                                <script><![CDATA[
                                  if(this.process.processOrder.tasks != null) {
                                      for(var i=0; i<this.process.processOrder.tasks.length; i++) {
                                          if(this.process.processOrder.tasks[i].tfrTask.isEnd2End) {
                                              this.process.processOrder.tasks[i].tfrTask.acceptDate = new Date();
                                              this.process.processOrder.tasks[i].tfrTask.status = configuration.getExternalNameForStatusByInternalName("ACCEPTED", "TFR_TASK");
                                              this.process.processOrder.tasks[i].tfrTask.save();
                                              this.process.processOrder.save();
                                              debugPrintln(workflow.getLogHeaderForProcess(this.process.id) + "Completed End2End task #");
                                          }
                                      }
                                      this.process.processOrder.prnDocument.releasedDate = new Date();
                                      this.process.processOrder.prnDocument.prnAvailable = true;
                                      this.process.processOrder.tfrDocument.tfrStatus = configuration.getExternalNameForStatusByInternalName("FA COMPLETED", "TFR");
                                      this.process.processOrder.tfrDocument.faCompletionDate = new Date();
                                      this.process.processOrder.save();
                                  }
                                ]]></script>
                              </method>
                            </methodList>
                          </child>
                        </childList>
                        <methodList>
                          <method name="cwOnProcActBefore" type="action">
                            <category>before</category>
                            <system>true</system>
                            <script><![CDATA[
                              // clean TFR user after CWO and XC activities finished
                              this.process.processOrder.tfrDocument.currentUserId=null;
                              this.process.processOrder.tfrDocument.currentUserDepartment = null;
                              this.process.processOrder.save();
                            ]]></script>
                          </method>
                        </methodList>
                      </child>
                      <child name="startReviewCWOReport" type="seqActivity">
                        <label>Start Review CWO Report</label>
                        <x>805.17474</x>
                        <y>5348.513</y>
                        <childList>
                          <child name="isInstallStartedFromRehome" type="switchActivity">
                            <label>Is Install started from Rehome?</label>
                            <x>859.2603</x>
                            <y>5458.9453</y>
                            <childList>
                              <child name="no" type="caseActivity">
                                <label>No</label>
                                <x>919.2028</x>
                                <y>5601.72</y>
                              </child>
                              <child name="yes" type="caseActivity">
                                <label>Yes</label>
                                <x>817.0185</x>
                                <y>4012.3306</y>
                                <childList>
                                  <child name="reconnectProcessFinalization" type="seqActivity">
                                    <label>Reconnect Process Finalization</label>
                                    <x>818.6664</x>
                                    <y>5599.75</y>
                                    <childList>
                                      <child name="completeReconnect" type="scriptActivity">
                                        <label>Complete Reconnect Process</label>
                                        <x>806.1608</x>
                                        <y>5715.3916</y>
                                        <methodList>
                                          <method name="cwOnProcActBefore" type="action">
                                            <category>before</category>
                                            <system>true</system>
                                            <script><![CDATA[
                                              // notify parent process about process complete
                                              // required to wake up Rehome process
                                              if( this.process.processOrder.prnrDocument.parentProcId ){
                                                  Process.sendSignal("workflow:wakeUpParent", this.process.processOrder.prnrDocument.parentProcId);
                                              }
                                            ]]></script>
                                          </method>
                                        </methodList>
                                      </child>
                                      <child name="end" type="completeActivity">
                                        <label>End</label>
                                        <x>818.8454</x>
                                        <y>5841.495</y>
                                      </child>
                                    </childList>
                                  </child>
                                </childList>
                                <methodList>
                                  <method name="cwOnProcActCond" type="action">
                                    <category>cond</category>
                                    <system>true</system>
                                    <script><![CDATA[
                                      // Complete flow in case it was started from Rehome
                                      debugPrintln("Checking if Install has been started from Rehome...");
                                      debugPrintln("Reconnect process: Parent process id:"+this.process.processOrder.prnrDocument.parentProcId);

                                      if(this.process.processOrder.prnrDocument.parentProcId){
                                          var parentProcInfo = Process.getProcessInfo(this.process.processOrder.prnrDocument.parentProcId);
                                          var REHOME_PROCESS_NAME = "workflow.rehomingOrderProcess";
                                          debugPrintln("Reconnect process: Parent process type: "+parentProcInfo.metadataTypeName);

                                          if( parentProcInfo.metadataTypeName == REHOME_PROCESS_NAME ){ // if Install started from Rehome
                                              debugPrintln("Reconnect process: Skipped 'Review CWO Report' activity.");
                                              return true; // skip Review CWO Report activity
                                          }
                                      }
                                      return false;
                                    ]]></script>
                                  </method>
                                </methodList>
                              </child>
                            </childList>
                          </child>
                          <child name="reviewCWOReport" type="opActivity">
                            <element>iface_workflow.orderInitiatorTeamIF/oper_reviewCWOReport</element>
                            <label>Review CWO Report</label>
                            <participant>part_workflow.installOrderInitiatorParticipant</participant>
                            <x>915.52997</x>
                            <y>5715.3916</y>
                          </child>
                          <child name="cwoReportReview" type="choiceActivity">
                            <label>CWO Report Review</label>
                            <x>840.7283</x>
                            <y>1729.0549</y>
                            <childList>
                              <child name="rejectCWOReport" type="opActivity">
                                <element>iface_workflow.orderInitiatorTeamIF/oper_rejectCWOReport</element>
                                <label>Reject CWO Report</label>
                                <participant>part_workflow.installOrderInitiatorParticipant</participant>
                                <x>973.0681</x>
                                <y>2019.5608</y>
                                <methodList>
                                  <method name="cwOnProcActAfter" type="action">
                                    <category>script</category>
                                    <system>true</system>
                                    <script><![CDATA[
                                      this.process.processDocument.isCWOReportOK = false;

                                      this.process.processOrder.tfrDocument.tfrStatus = configuration.getExternalNameForStatusByInternalName("REJECTED", "TFR");
                                      this.process.processOrder.prnDocument.prnStatus = configuration.getExternalNameForStatusByInternalName("REJECTED", "PRN");
                                      this.process.processOrder.prnrDocument.prnrStatus = configuration.getExternalNameForStatusByInternalName("REJECTED", "PRNR");
                                      this.process.processOrder.save();
                                    ]]></script>
                                  </method>
                                </methodList>
                              </child>
                              <child name="acceptCWOReport" type="opActivity">
                                <element>iface_workflow.orderInitiatorTeamIF/oper_acceptCWOReport</element>
                                <label>Accept CWO Report</label>
                                <participant>part_workflow.installOrderInitiatorParticipant</participant>
                                <x>845.9566</x>
                                <y>2019.5608</y>
                                <methodList>
                                  <method name="cwOnProcActAfter" type="action">
                                    <category>script</category>
                                    <system>true</system>
                                    <script><![CDATA[
                                      this.process.processDocument.isCWOReportOK = true;

                                      this.process.processOrder.tfrDocument.tfrStatus = configuration.getExternalNameForStatusByInternalName("COMPLETED", "TFR");
                                      this.process.processOrder.tfrDocument.currentUserId = null;
                                      this.process.processOrder.tfrDocument.currentUserDepartment = null;
                                      this.process.processOrder.prnDocument.prnStatus = configuration.getExternalNameForStatusByInternalName("COMPLETED", "PRN");
                                      this.process.processOrder.prnDocument.currentUserId = null;
                                      this.process.processOrder.prnDocument.currentUserDepartment = null;
                                      this.process.processOrder.prnrDocument.prnrStatus = configuration.getExternalNameForStatusByInternalName("COMPLETED", "PRNR");
                                      this.process.processOrder.prnrDocument.currentUserId = null;
                                      this.process.processOrder.prnrDocument.currentUserDepartment = null;
                                      this.process.processOrder.save();
                                    ]]></script>
                                  </method>
                                </methodList>
                              </child>
                            </childList>
                          </child>
                          <child name="isCWOReportAccepted" type="switchActivity">
                            <label>Is CWO Report Accepted</label>
                            <x>883.46246</x>
                            <y>2167.716</y>
                            <childList>
                              <child name="accepted" type="caseActivity">
                                <label>Accepted</label>
                                <x>811.8564</x>
                                <y>2303.222</y>
                                <childList>
                                  <child name="end" type="completeActivity">
                                    <label>End</label>
                                    <x>938.06525</x>
                                    <y>2315.8713</y>
                                    <methodList>
                                      <method name="cwOnProcActBefore" type="action">
                                        <category>before</category>
                                        <system>true</system>
                                        <script><![CDATA[debugPrintln("CWO report reviewed and accepted!.");]]></script>
                                      </method>
                                    </methodList>
                                  </child>
                                </childList>
                                <methodList>
                                  <method name="cwOnProcActCond" type="action">
                                    <category>cond</category>
                                    <system>true</system>
                                    <script>return this.process.processDocument.isCWOReportOK;</script>
                                  </method>
                                </methodList>
                              </child>
                              <child name="rejected" type="caseActivity">
                                <label>Rejected</label>
                                <x>530.0</x>
                                <y>206.0</y>
                                <childList>
                                  <child name="startRejectionProcess" type="seqActivity">
                                    <label>Start Rejection Process</label>
                                    <x>840.584</x>
                                    <y>2316.8416</y>
                                    <childList>
                                      <child name="startRejectionProcess" type="scriptActivity">
                                        <label>Start Rejection Process</label>
                                        <x>843.0516</x>
                                        <y>2441.9749</y>
                                        <methodList>
                                          <method name="cwOnProcActBefore" type="action">
                                            <category>before</category>
                                            <system>true</system>
                                            <script><![CDATA[
                                              debugPrintln(workflow.getLogHeaderForProcess(this.process.id) + "Starting Rejection Process");

                                              var rejectionProcessOrder = new Order("tfs.rejectionOrder");
                                              rejectionProcessOrder.rejectionProcData.tfrId = this.process.processOrder.tfrDocument.id;
                                              rejectionProcessOrder.rejectionProcData.currentUserId = workflow.getUserForOrder(this.process.processOrder.id, this.process.processOrderItemId, "OrderInitiator");
                                              rejectionProcessOrder.rejectionProcData.parentProcessId = this.process.id;
                                              rejectionProcessOrder.save();

                                              var processId = Process.startProcess("workflow.rejectionProcess", rejectionProcessOrder.id);

                                              this.process.processDocument.rejectionProcessId = processId;

                                              debugPrintln(workflow.getLogHeaderForProcess(this.process.id) + "Started Rejection Process with id " + processId);
                                            ]]></script>
                                          </method>
                                        </methodList>
                                      </child>
                                      <child name="waitForWakeUpParentSignal" type="syncActivity">
                                        <element>signal_workflow.wakeUpParent</element>
                                        <label>Wait For &quot;Wake Up Parent&quot; Signal</label>
                                        <x>841.26154</x>
                                        <y>2590.429</y>
                                        <methodList>
                                          <method name="cwOnProcActAfter" type="action">
                                            <category>script</category>
                                            <system>true</system>
                                            <script><![CDATA[
                                              debugPrintln(workflow.getLogHeaderForProcess(this.process.id) + "Completed Rejection Process");

                                              var rejectionProcessDocument = Process.getProcessDocument(this.process.processDocument.rejectionProcessId);
                                              var returnPoint = rejectionProcessDocument.returnPoint;
                                              debugPrintln(workflow.getLogHeaderForProcess(this.process.id) + "Completed Rejection Process - returnPoint is " + returnPoint);

                                              workflow.overload_computeNextUser(this.process.processOrder.id, "0", this.process.id, "installOrderProcess", "rejectionProcessCompleted");

                                              this.process.processOrder.tfrDocument.rejectionCode = returnPoint;
                                              this.process.processOrder.save();
                                            ]]></script>
                                          </method>
                                        </methodList>
                                      </child>
                                    </childList>
                                  </child>
                                </childList>
                              </child>
                            </childList>
                          </child>
                          <child name="rejectionProcessCompleted" type="scriptActivity">
                            <label>Rejection Process Completed</label>
                            <x>839.0496</x>
                            <y>2761.2336</y>
                            <methodList>
                              <method name="cwOnProcActBefore" type="action">
                                <category>before</category>
                                <system>true</system>
                                <script><![CDATA[
                                  debugPrintln("Rejection process completed. Assign task to Integration team.");
                                  workflow.overload_computeNextUser(this.process.processOrder.id, this.process.processOrderItemId, this.process.id, "installOrderProcess", "rejectionProcessCompleted");
                                ]]></script>
                              </method>
                            </methodList>
                          </child>
                          <child name="analyzeRejection" type="opActivity">
                            <element>iface_workflow.integrationTeamIF/oper_analyzeRejection</element>
                            <label>Analyze Rejection</label>
                            <participant>part_workflow.integrationTeamParticipant</participant>
                            <x>919.2672</x>
                            <y>2887.3372</y>
                          </child>
                          <child name="acceptOrReject" type="choiceActivity">
                            <label>Accept Or Reject</label>
                            <x>985.4474</x>
                            <y>3021.09</y>
                            <childList>
                              <child name="acceptAnalysis" type="opActivity">
                                <element>iface_workflow.integrationTeamIF/oper_accept</element>
                                <label>Accept Analysis</label>
                                <participant>part_workflow.integrationTeamParticipant</participant>
                                <x>923.4474</x>
                                <y>3162.1936</y>
                                <childList>
                                  <child name="startIssueFixing" type="seqActivity">
                                    <label>Start Issue Fixing</label>
                                    <x>912.71655</x>
                                    <y>3297.9983</y>
                                    <childList>
                                      <child name="fixIssue" type="opActivity">
                                        <element>iface_workflow.integrationTeamIF/oper_fixIssue</element>
                                        <label>Fix Issue</label>
                                        <participant>part_workflow.integrationTeamParticipant</participant>
                                        <x>885.4474</x>
                                        <y>3444.1018</y>
                                      </child>
                                      <child name="issueFixed" type="opActivity">
                                        <element>iface_workflow.integrationTeamIF/oper_issueFixed</element>
                                        <label>Issue Fixed</label>
                                        <participant>part_workflow.integrationTeamParticipant</participant>
                                        <x>852.7706</x>
                                        <y>3725.7112</y>
                                        <methodList>
                                          <method name="cwOnProcActAfter" type="action">
                                            <category>script</category>
                                            <system>true</system>
                                            <script><![CDATA[
                                              this.process.processOrder.tfrDocument.tfrStatus = configuration.getExternalNameForStatusByInternalName("REJECTION FIXED", "TFR");
                                              this.process.processOrder.save();
                                            ]]></script>
                                          </method>
                                        </methodList>
                                      </child>
                                      <child name="returnToReviewCWOReport" type="repeatActivity">
                                        <element>proc_workflow.installOrderProcess_cwr8/seqActivity_start/seqActivity_startProvisioningWorkflow/switchActivity_isPRNRAccepted/caseActivity_yes/seqActivity_startPRNAndTFRManagement/seqActivity_startReviewCWOReport</element>
                                        <label>Return To Review CWO Report</label>
                                        <x>856.7726</x>
                                        <y>4575.623</y>
                                      </child>
                                    </childList>
                                  </child>
                                </childList>
                              </child>
                              <child name="rejectAnalysis" type="opActivity">
                                <element>iface_workflow.integrationTeamIF/oper_reject</element>
                                <label>Reject Analysis</label>
                                <participant>part_workflow.integrationTeamParticipant</participant>
                                <x>964.44495</x>
                                <y>3577.556</y>
                                <childList>
                                  <child name="returnToReviewCWOReport" type="repeatActivity">
                                    <element>proc_workflow.installOrderProcess_cwr8/seqActivity_start/seqActivity_startProvisioningWorkflow/switchActivity_isPRNRAccepted/caseActivity_yes/seqActivity_startPRNAndTFRManagement/seqActivity_startReviewCWOReport</element>
                                    <label>Return To Review CWO Report</label>
                                    <x>960.1168</x>
                                    <y>4434.8184</y>
                                  </child>
                                </childList>
                                <methodList>
                                  <method name="cwOnProcActAfter" type="action">
                                    <category>script</category>
                                    <system>true</system>
                                    <script><![CDATA[
                                      this.process.processOrder.tfrDocument.tfrStatus = configuration.getExternalNameForStatusByInternalName("REJECTION REJECTED", "TFR");
                                      this.process.processOrder.save();
                                    ]]></script>
                                  </method>
                                </methodList>
                              </child>
                            </childList>
                          </child>
                        </childList>
                      </child>
                    </childList>
                  </child>
                </childList>
              </child>
            </childList>
          </child>
        </childList>
      </child>
      <child name="stopProcess" type="onExceptionActivity">
        <element>excp_cwf.stop</element>
        <label>Stop Process on Exception</label>
        <x>126.537415</x>
        <y>4057.711</y>
        <childList>
          <child name="stopProcessActivities" type="seqActivity">
            <label>Stop Process Activities</label>
            <x>1399.5468</x>
            <y>171.10353</y>
            <childList>
              <child name="installProcessStopFinalizing" type="scriptActivity">
                <label>Install Process Stop Finalizing</label>
                <x>1398.7551</x>
                <y>265.86447</y>
                <methodList>
                  <method name="cwOnProcActBefore" type="action">
                    <category>before</category>
                    <system>true</system>
                    <script><![CDATA[
                      // Install process stop is possible from Cancel Install process
                      // Install process could be started as standalone process and as a part of Rehome process
                      // In case of start from Rehome process we need also to stop rehome process

                      // getting order id from Rehome process
                      // Install TFR connected with Rehome TFR through connection_tfr_id

                      debugPrintln("Install: Stop process requested...");
                      debugPrintln("Checking if linked Rehome process exists...");
                      var connection_id = null;

                      if (this.process.processOrder.tfrDocument != null) {
                          connection_id = this.process.processOrder.tfrDocument.connectionTFRId;
                      }
                      else if(this.process.processOrder.prnrDocument != null){
                          connection_id = this.process.processOrder.prnrDocument.connectionTFRId;
                      }

                      debugPrintln("Connection TFR:"+connection_id);

                      if( connection_id ){  // if Rehome TFR exists
                          debugPrintln("Rehome process exists. Stopping Rehome process...");
                          var rehomeTFR = Document.readDoc("tfs.tfr", connection_id); // load document
                          workflow.terminateProcessByOrderId(rehomeTFR.cwOrderId, "workflow.rehomingOrderProcess"); // stop Rehome process
                      }
                      else{
                          debugPrintln("Rehome process does not exist.");
                      }
                    ]]></script>
                  </method>
                </methodList>
              </child>
              <child name="completeOnStopSignal" type="completeActivity">
                <label>Complete On Stop Exception</label>
                <x>1397.7502</x>
                <y>421.37033</y>
                <methodList>
                  <method name="cwOnProcActBefore" type="action">
                    <category>before</category>
                    <system>true</system>
                    <script><![CDATA[debugPrintln(workflow.getLogHeaderForProcess(this.process.id) + "Received Stop for Process");]]></script>
                  </method>
                </methodList>
              </child>
            </childList>
            <methodList>
              <method name="cwOnProcActBefore" type="action">
                <category>before</category>
                <system>true</system>
                <script><![CDATA[debugPrintln("Stopping process on 'stop' exception. Process id:"+this.process.id);]]></script>
              </method>
            </methodList>
          </child>
        </childList>
      </child>
      <child name="installOrderInitiatorParticipant" type="participantActivity">
        <label>Install Order Initiator Participant</label>
        <participant>part_workflow.installOrderInitiatorParticipant</participant>
        <x>932.074</x>
        <y>1721.7043</y>
      </child>
      <child name="networkDesignParticipant" type="participantActivity">
        <label>Network Design Participant</label>
        <participant>part_workflow.networkDesignParticipant</participant>
        <x>985.97974</x>
        <y>614.2268</y>
      </child>
      <child name="facilityDesignTeamParticipant" type="participantActivity">
        <label>Facility Design Team Participant</label>
        <participant>part_workflow.facilityDesignTeamParticipant</participant>
        <x>380.64722</x>
        <y>606.8762</y>
      </child>
      <child name="xcTeamParticipant" type="participantActivity">
        <label>XC Team Participant</label>
        <participant>part_workflow.xcTeamParticipant</participant>
        <x>377.87268</x>
        <y>3162.1936</y>
      </child>
      <child name="switchActivationParticipant" type="participantActivity">
        <label>Switch Activation Team Participant</label>
        <participant>part_workflow.switchActivationParticipant</participant>
        <x>310.59912</x>
        <y>3703.6594</y>
      </child>
      <child name="integrationTeamParticipant" type="participantActivity">
        <label>Integration Team Participant</label>
        <participant>part_workflow.integrationTeamParticipant</participant>
        <x>819.4474</x>
        <y>3013.7395</y>
      </child>
    </childList>
    <methodList>
      <method name="cwOnProcActBefore" type="action">
        <category>before</category>
        <system>true</system>
        <script><![CDATA[debugPrintln(workflow.getLogHeaderForProcess(this.process.id) + "Start");]]></script>
      </method>
    </methodList>
  </activity>
  <curRevision>true</curRevision>
  <document>doc_workflow.installOrderProcessDocument</document>
  <label>Install Order Process</label>
  <metaVersion>22</metaVersion>
  <priority>8</priority>
  <revision>8</revision>
  <type>User</type>
</process>