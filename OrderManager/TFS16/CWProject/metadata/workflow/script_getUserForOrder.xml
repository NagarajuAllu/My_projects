<?xml version="1.0" encoding="UTF-8" ?>
<script name="workflow.getUserForOrder">
  <label>Get User For Order</label>
  <metaVersion>4</metaVersion>
  <parameterList>
    <parameter name="orderId" type="rifp">
      <type>dtype_cwf.docId</type>
    </parameter>
    <parameter name="orderItemId" type="rifp">
      <type>dtype_cwf.docId</type>
    </parameter>
    <parameter name="participantType" type="rifp">
      <type>dtype_com.conceptwave.system.String</type>
    </parameter>
  </parameterList>
  <script><![CDATA[
    var finder = new Finder("workflow.usersForOrderFinder");
    finder.searchDocument.orderId = orderId;
    finder.searchDocument.orderItemId = orderItemId;
    var recordsFound = finder.search();

    var userForOrder = null;

    var mappingTable = workflow.getTypeToUserIdMapping();

    if(recordsFound != null && recordsFound.length > 0) {
        var attr = mappingTable[participantType];
        debugPrintln("Getting USER: " + attr + " for order:"+orderId + " orderItemId:"+orderItemId + " participantType:"+participantType);
        if(attr){
            userForOrder = recordsFound[0][attr];
            debugPrintln("User assigned attribute: " + userForOrder);
        }
    }

    return userForOrder;
  ]]></script>
</script>