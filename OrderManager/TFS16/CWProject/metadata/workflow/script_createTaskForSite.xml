<?xml version="1.0" encoding="UTF-8" ?>
<script name="workflow.createTaskForSite">
  <label>Create Task For Site</label>
  <metaVersion>25</metaVersion>
  <parameterList>
    <parameter name="order" type="rifp">
      <type>nmeta_com.conceptwave.system.Object</type>
    </parameter>
    <parameter name="isASite" type="rifp">
      <type>dtype_com.conceptwave.system.Boolean</type>
    </parameter>
  </parameterList>
  <script><![CDATA[
    var existingTasks = (order.tasks != null ? order.tasks.length : 0);

    var tfrTask = order.createOrderItemByPath("tasks." + (existingTasks + 1) + ".tfrTask");
    tfrTask.taskName = "Task Name for site - " + (isASite ? order.tfrDocument.siteAName.visualKey : order.tfrDocument.siteZName.visualKey);
    tfrTask.tfrId =  order.tfrDocument.tfrId;
    tfrTask.status = "NEW";
    tfrTask.isEnd2End = false;
    tfrTask.siteName = (isASite ? order.tfrDocument.siteAName : order.tfrDocument.siteZName);
    tfrTask.siteIF = (isASite ? order.tfrDocument.siteAIF : order.tfrDocument.siteZIF);
    tfrTask.siteJVC = (isASite ? order.tfrDocument.siteAJVC : order.tfrDocument.siteZJVC);
    tfrTask.siteTermination = (isASite ? order.tfrDocument.siteATermination : order.tfrDocument.siteZTermination);
    tfrTask.siteExchangeType = (isASite ? order.tfrDocument.siteAExchangeType : order.tfrDocument.siteZExchangeType);
    tfrTask.siteSwitchType = (isASite ? order.tfrDocument.siteASwitchType : order.tfrDocument.siteZSwitchType);
    tfrTask.creationDate = new Date();
    tfrTask.description = "Task automatically created by the system for " + (isASite ? "A" : "Z") + " site";
    tfrTask.save();
    order.save();
  ]]></script>
</script>