<?xml version="1.0" encoding="UTF-8" ?>
<script filenameHash="9efff11479e3da83853fe3e349aa1cc0" versionHash="a87ff679a2f3e71d9181a67b7542122c" name="common.sendEmailToUserForWLRecord">
  <label>Send Email To User For WL Record</label>
  <metaVersion>4</metaVersion>
  <parameterList>
    <parameter name="userId" type="rifp">
      <type>dtype_com.conceptwave.system.String</type>
    </parameter>
    <parameter name="operation" type="rifp">
      <type>dtype_com.conceptwave.system.String</type>
    </parameter>
    <parameter name="objectType" type="rifp">
      <type>dtype_com.conceptwave.system.String</type>
    </parameter>
    <parameter name="objectName" type="rifp">
      <type>dtype_com.conceptwave.system.String</type>
    </parameter>
  </parameterList>
  <script><![CDATA[
    var userProfile = UserProfile.getUserProfile(userId);
    if(! common.isNullValue(userProfile.email)) {
        var from = Global.getConfigVariable("APPLICATION_SENDER"); // mail address sender
        var subject = Global.translateText("AI0003", null, [operation, objectType, objectName]);
        var message = Global.translateText("AI0004", null, [operation, objectType, objectName]);

        var userIdSender = null;
        if(! common.isNullValue(Global.getConfigVariable("USER_ID_SENDER"))) {
            userIdSender = Global.getConfigVariable("USER_ID_SENDER"); // sending user id into mail server
        }

        var password = null;
        if(! common.isNullValue(Global.getConfigVariable("PASSWORD_SENDER"))) {
            password = Global.getConfigVariable("PASSWORD_SENDER"); // sending user password into mail server
        }

        var mailServer = null;
        if(! common.isNullValue(Global.getConfigVariable("MAIL_SERVER"))) {
            mailServer = Global.getConfigVariable("MAIL_SERVER"); // mail server
        }

        var port = null;
        if(! common.isNullValue(Global.getConfigVariable("PORT_MAIL_SERVER"))) {
            port = Global.getConfigVariable("PORT_MAIL_SERVER"); // port mail server
        }

        var secure = null;
        if(! common.isNullValue(Global.getConfigVariable("SECURE_MAIL_SERVER"))) {
            secure   = (Global.getConfigVariable("SECURE_MAIL_SERVER") == "YES"); // mail server requires SSL
        }

        try {
    debugPrintln("Sending email to " + userProfile.email + " with subject " + subject);
            Global.sendEmailMessage(from, userProfile.email, subject, message, "text/plain", "UTF-8", null, null, userIdSender, password, mailServer, port, secure);
    debugPrintln("Sending email to " + userProfile.email + " with subject " + subject);
        }
        catch(exc) {
            Global.logDebug("Error in sending E-Mail - exc = " + exc.message);
    debugPrintln("Error in sending E-Mail - exc = " + exc.message);
        }
    }
  ]]></script>
</script>