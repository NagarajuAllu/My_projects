<?xml version="1.0" encoding="UTF-8" ?>
<script filenameHash="7c851e4b2510f5c9202bc80ef7d8a8e" versionHash="a87ff679a2f3e71d9181a67b7542122c" name="ds_ws.validateNVAndGetFirstValue">
  <label>Validate And Get First Value for NV Pair</label>
  <metaVersion>4</metaVersion>
  <parameterList>
    <parameter name="orders" type="rifp">
      <array>true</array>
      <type>order_ds_ws.default_orderSTC_HOME</type>
    </parameter>
    <parameter name="nvPairToCheck" type="rifp">
      <type>dtype_com.conceptwave.system.String</type>
    </parameter>
    <parameter name="performValidation" type="rifp">
      <type>dtype_com.conceptwave.system.Boolean</type>
    </parameter>
  </parameterList>
  <script><![CDATA[
    var firstValueFound = null;
    for (var s = 0; s < orders.length; s++) {
        if(orders[s].serviceParametersList != null) {
            for (var p = 0; p < orders[s].serviceParametersList.length; p++) {
                if(orders[s].serviceParametersList[p].nameValueList != null) {
                    for (var n =0; n < orders[s].serviceParametersList[p].nameValueList.length; n++) {
                        var nvPairName = orders[s].serviceParametersList[p].nameValueList[n].nameValue.name;
                        var nvPairValue = orders[s].serviceParametersList[p].nameValueList[n].nameValue.value;
                        if(nvPairName == nvPairToCheck) {
                            if(! ds_ws.common_isNullValue(nvPairValue)) {
                                var valid = false;
                                if(performValidation) {
                                    valid = refTables.checkIfItsValidValueForNVPairName(nvPairName, nvPairValue);
                                }
                                else {
                                    valid = true;
                                }

                                if(valid) {
    debugPrintln("[" + ds_ws.common_currentDateAsStringDDMMYYYYHH24MISS() + "][validateNVAndGetFirstValue] 'orders'[" + s + "].serviceParametersList[" + p + "].nameValueList [" + n + "] = " + orders[s].serviceParametersList[p].nameValueList[n].nameValue.toXML());
                                    if(firstValueFound == null) {
                                        firstValueFound = nvPairValue;
                                    }
                                }
                                else {
                                    Global.throwException("AE0027", [orders[s].serviceParametersList[p].serviceParameters.serviceNumber, nvPairName, nvPairValue]);
                                }
                            }
                        }
                    }
                }
            }
        }
    }

    return firstValueFound;
  ]]></script>
</script>