<?xml version="1.0" encoding="UTF-8" ?>
<document filenameHash="f6206cd497b440531962b1243cfacfc3" versionHash="eccbc87e4b5ce2fe28308fd9f2a7baf3" name="ds_ws.details_nameValue">
  <dbSchema>ORDER</dbSchema>
  <extends>doc_com.conceptwave.system.Document</extends>
  <generatedKey>true</generatedKey>
  <guid>{018af567-129f-7640-e841-e59fe113d2be}</guid>
  <label>Details: Name Value</label>
  <metaVersion>3</metaVersion>
  <variableList>
    <variable name="name" type="leaf">
      <column>NAME</column>
      <guid>{0a8224c3-ab9d-6ae7-224a-f3d622e48834}</guid>
      <label>Name</label>
      <propertyElement type="elfld">
        <label>Name</label>
        <optional type="varPath">
          <variablePathList>
            <variablePath>dtype_com.conceptwave.system.Boolean/leaf_FALSE</variablePath>
          </variablePathList>
        </optional>
      </propertyElement>
      <table>STC_NAME_VALUE</table>
      <valueType>dtype_ds_ws.string100</valueType>
    </variable>
    <variable name="value" type="leaf">
      <column>VALUE</column>
      <guid>{0c3c234d-df44-dc21-0bf3-5f53eae8bef3}</guid>
      <label>Value</label>
      <propertyElement type="elfld">
        <label>Value</label>
      </propertyElement>
      <table>STC_NAME_VALUE</table>
      <valueType>dtype_ds_ws.string4000</valueType>
    </variable>
    <variable name="cwDocStamp" type="leaf">
      <column>CWDOCSTAMP</column>
      <guid>{0d554b5e-7f0e-1abb-2b4f-ef33a8ed8f30}</guid>
      <label>System doc stamp</label>
      <propertyElement type="elfld">
        <label>System doc stamp</label>
      </propertyElement>
      <table>STC_NAME_VALUE</table>
      <valueType>dtype_cwf.cwDocStamp</valueType>
    </variable>
    <variable name="cwDocId" type="leaf">
      <column>CWDOCID</column>
      <guid>{05d01f17-bc88-7d5f-e312-04781ae0b3db}</guid>
      <key>1</key>
      <label>System document ID</label>
      <propertyElement type="elfld">
        <label>System document ID</label>
      </propertyElement>
      <table>STC_NAME_VALUE</table>
      <valueType>dtype_cwf.cwDocId</valueType>
    </variable>
    <variable name="lastUpdatedDate" type="leaf">
      <column>LASTUPDATEDDATE</column>
      <guid>{04cfd735-0b2f-551c-c36b-60b6966b92d0}</guid>
      <label>System last updated timestamp</label>
      <propertyElement type="eldatetime">
        <label>System last updated timestamp</label>
      </propertyElement>
      <table>STC_NAME_VALUE</table>
      <valueType>dtype_cwf.lastUpdatedDate</valueType>
    </variable>
    <variable name="cwOrderCreationDate" type="leaf">
      <column>CWORDERCREATIONDATE</column>
      <guid>{03770147-019d-4913-bcd1-551cb181cd2c}</guid>
      <label>System order creation timestamp</label>
      <propertyElement type="eldatetime">
        <label>System order creation timestamp</label>
      </propertyElement>
      <table>STC_NAME_VALUE</table>
      <valueType>dtype_cwf.cwOrderCreationDate</valueType>
    </variable>
    <variable name="cwOrderId" type="leaf">
      <column>CWORDERID</column>
      <guid>{0ecf8cf5-998e-c8c4-55d0-2f262385ab07}</guid>
      <label>System order ID</label>
      <propertyElement type="elfld">
        <label>System order ID</label>
      </propertyElement>
      <table>STC_NAME_VALUE</table>
      <valueType>dtype_cwf.cwOrderId</valueType>
    </variable>
    <variable name="cwParentId" type="leaf">
      <column>CWPARENTID</column>
      <guid>{0def84e0-9d80-59ca-1a0a-8b7c03ee5993}</guid>
      <label>System parent ID</label>
      <propertyElement type="elfld">
        <label>System parent ID</label>
      </propertyElement>
      <table>STC_NAME_VALUE</table>
      <valueType>dtype_cwf.cwParentId</valueType>
    </variable>
    <variable name="updatedBy" type="leaf">
      <column>UPDATEDBY</column>
      <guid>{029dd33d-4b5e-24b7-12c1-d4a0b8e7e4c1}</guid>
      <label>System updated by</label>
      <propertyElement type="elfld">
        <label>System updated by</label>
      </propertyElement>
      <table>STC_NAME_VALUE</table>
      <valueType>dtype_cwf.updatedBy</valueType>
    </variable>
  </variableList>
  <methodList>
    <method name="cwLeafTriggerAction$name" type="laction">
      <guid>{04954a4b-18df-932d-b070-485aebc02e0c}</guid>
      <path>doc_ds_ws.details_nameValue/leaf_name</path>
      <type>trigger</type>
      <script><![CDATA[
        var order = document.order;

        document.name = document.name != null ? document.name.trim() : null;

        if (order != null && order.orderMessage.actionOnOrder == "Create" && document.name != null){

              // Check to prevent any attribute cuold be duplicated:
              // - retrive the parent of the document
              var parentId = -1;
              for (var k = 0; k < order.serviceParametersList.count; k++) {
                    for (var j = 0; order.serviceParametersList[k].nameValueList != null &&
                                            j < order.serviceParametersList[k].nameValueList.count; j++) {
                          if (order.serviceParametersList[k].nameValueList[j].nameValue.id == document.id) {
                                parentId = k;
                                break;
                          }
                    }
              }
              // - check if the attribute is already defined
              if (parentId > -1) {
                    for (var j = 0; j < order.serviceParametersList[parentId].nameValueList.count; j++) {
                          if (order.serviceParametersList[parentId].nameValueList[j].nameValue.name != null &&
                                order.serviceParametersList[parentId].nameValueList[j].nameValue.name.toUpperCase() == document.name.toUpperCase() &&
                                order.serviceParametersList[parentId].nameValueList[j].nameValue.id != document.id) {
                                document.name = null;
                                var attributeName = order.serviceParametersList[parentId].nameValueList[j].nameValue.name;
                                Global.throwException("Action not performed: the service already contains an attribute '" + attributeName + "'!");
                          }
                    }
              }
        }
      ]]></script>
    </method>
    <method name="cwOnDocVisualKey" type="action">
      <guid>{0122eaf1-4581-63ef-94fd-d66c7c129d9c}</guid>
      <system>true</system>
      <script><![CDATA[
        var name = null;
        name = (document.name != null ? document.name : "Not Defined") +
                 (document.value != null ? " [" + document.value + "]" : " [ ]");
        return name;
      ]]></script>
    </method>
    <method name="permView_By_Action_On_Order____Create__and___NameView" type="permMethod">
      <script><![CDATA[
        // SCRIPT MIGRATION: if null, return false
        function functionToReturnFalseWhenNull(scriptToReturnFalseWhenNullThis) {

              // Modified on 09.12.2008:
              // - only if Action On Order requested is 'Create';
              return (scriptToReturnFalseWhenNullThis.order != null ? scriptToReturnFalseWhenNullThis.order.orderMessage.actionOnOrder == "Create" : false) &&
                       (scriptToReturnFalseWhenNullThis.name == null);
        }

        var functionToReturnFalseWhenNullRes = functionToReturnFalseWhenNull(this);
        if(functionToReturnFalseWhenNullRes == null)
          return false;
        else
          return functionToReturnFalseWhenNullRes;
      ]]></script>
    </method>
    <method name="permView_By_Action_On_Order____Create__and_Name_and_Parent_____VOIP__and__HSI_View" type="permMethod">
      <script><![CDATA[
        // SCRIPT MIGRATION: if null, return false
        function functionToReturnFalseWhenNull(scriptToReturnFalseWhenNullThis) {

              var different = false;

              var parent = null;
              for (var k = 0; k < scriptToReturnFalseWhenNullThis.order.serviceParametersList.count; k++) {
                    for (var j = 0; scriptToReturnFalseWhenNullThis.order.serviceParametersList[k].nameValueList != null &&
                                            j < scriptToReturnFalseWhenNullThis.order.serviceParametersList[k].nameValueList.count; j++) {
                          if (scriptToReturnFalseWhenNullThis.order.serviceParametersList[k].nameValueList[j].nameValue.id == scriptToReturnFalseWhenNullThis.id) {
                                parent = scriptToReturnFalseWhenNullThis.order.serviceParametersList[k].serviceParameters;
                                break;
                          }
                    }
              }

              // [NB] We can show a Name Value item with 'Name' read only and 'Value' editable if:
              if (parent != null) {
                    // - we encountered a service different from VOIP and HSI
                    if(parent.serviceType != "FTTH_VOIP" && parent.serviceType != "FTTH_HSI") {
                          different = true;
                    }
                    // - we encountered a service equal to VOIP or HSI but not a mandatory attribute like...
                    if(parent.serviceType == "FTTH_VOIP" || parent.serviceType == "FTTH_HSI") {
                          if (scriptToReturnFalseWhenNullThis.name != "CSC" && scriptToReturnFalseWhenNullThis.name != "Rate Plan" && scriptToReturnFalseWhenNullThis.name != "SUPP_CODES" &&
                                 scriptToReturnFalseWhenNullThis.name != "UpstreamBandwidth" && scriptToReturnFalseWhenNullThis.name != "DownstreamBandwidth"){
                                 different = true;
                           }
                    }
              }

              // Modified on 09.12.2008:
              // - only if Action On Order requested is null;
              return (scriptToReturnFalseWhenNullThis.order != null ? scriptToReturnFalseWhenNullThis.order.orderMessage.actionOnOrder == "Create" : false) &&
                       (scriptToReturnFalseWhenNullThis.name != null) &&
                       different;
        }

        var functionToReturnFalseWhenNullRes = functionToReturnFalseWhenNull(this);
        if(functionToReturnFalseWhenNullRes == null)
          return false;
        else
          return functionToReturnFalseWhenNullRes;
      ]]></script>
    </method>
    <method name="permView_By_Action_On_Order____Create__and_Name_and_Parent____VOIP__or__HSI_View" type="permMethod">
      <script><![CDATA[
        // SCRIPT MIGRATION: if null, return false
        function functionToReturnFalseWhenNull(scriptToReturnFalseWhenNullThis) {

              var equal = false;

              var parent = null;
              for (var k = 0; k < scriptToReturnFalseWhenNullThis.order.serviceParametersList.count; k++) {
                    for (var j = 0; scriptToReturnFalseWhenNullThis.order.serviceParametersList[k].nameValueList != null &&
                                            j < scriptToReturnFalseWhenNullThis.order.serviceParametersList[k].nameValueList.count; j++) {
                          if (scriptToReturnFalseWhenNullThis.order.serviceParametersList[k].nameValueList[j].nameValue.id == scriptToReturnFalseWhenNullThis.id) {
                                parent = scriptToReturnFalseWhenNullThis.order.serviceParametersList[k].serviceParameters;
                                break;
                          }
                    }
              }

              if (parent != null &&
                    (parent.serviceType == "FTTH_VOIP" || parent.serviceType == "FTTH_HSI") &&
                    (scriptToReturnFalseWhenNullThis.name == "CSC" || scriptToReturnFalseWhenNullThis.name == "Rate Plan" || scriptToReturnFalseWhenNullThis.name == "SUPP_CODES" ||      // - for VOIP
                     scriptToReturnFalseWhenNullThis.name == "UpstreamBandwidth" || scriptToReturnFalseWhenNullThis.name == "DownstreamBandwidth")) {                                          // - for HSI
                    equal = true;
              }

              // Modified on 09.12.2008:
              // - only if Action On Order requested is null;
              return (scriptToReturnFalseWhenNullThis.order != null ? scriptToReturnFalseWhenNullThis.order.orderMessage.actionOnOrder == "Create" : false) &&
                       (scriptToReturnFalseWhenNullThis.name != null) &&
                       equal;
        }

        var functionToReturnFalseWhenNullRes = functionToReturnFalseWhenNull(this);
        if(functionToReturnFalseWhenNullRes == null)
          return false;
        else
          return functionToReturnFalseWhenNullRes;
      ]]></script>
    </method>
    <method name="permView_By_Action_On_Order____Update_View" type="permMethod">
      <script><![CDATA[
        // SCRIPT MIGRATION: if null, return false
        function functionToReturnFalseWhenNull(scriptToReturnFalseWhenNullThis) {

              // Modified on 09.12.2008:
              // - only if Action On Order requested is 'Update';
              return (scriptToReturnFalseWhenNullThis.order != null ? scriptToReturnFalseWhenNullThis.order.orderMessage.actionOnOrder == "Update" : false);
        }

        var functionToReturnFalseWhenNullRes = functionToReturnFalseWhenNull(this);
        if(functionToReturnFalseWhenNullRes == null)
          return false;
        else
          return functionToReturnFalseWhenNullRes;
      ]]></script>
    </method>
    <method name="permView_By_Default__when_Action_On_Order_is_null_View" type="permMethod">
      <script><![CDATA[
        // SCRIPT MIGRATION: if null, return false
        function functionToReturnFalseWhenNull(scriptToReturnFalseWhenNullThis) {

              // Modified on 09.12.2008:
              // - only if Action On Order requested is null;
              return (scriptToReturnFalseWhenNullThis.order != null ? scriptToReturnFalseWhenNullThis.order.orderMessage.actionOnOrder == null : false);
        }

        var functionToReturnFalseWhenNullRes = functionToReturnFalseWhenNull(this);
        if(functionToReturnFalseWhenNullRes == null)
          return false;
        else
          return functionToReturnFalseWhenNullRes;
      ]]></script>
    </method>
  </methodList>
  <UserInterface name="UserInterface" type="ui">
    <extends>ui_com.conceptwave.system.DocumentWithTabsUserInterface</extends>
    <variableList>
      <variable name="model" type="uivar">
        <label>model</label>
        <valueType>doc_ds_ws.details_nameValue</valueType>
      </variable>
    </variableList>
    <vformList>
      <vform name="Forms" type="frmui">
        <extends>ui_com.conceptwave.system.DocumentWithTabsUserInterface/frmui_Forms</extends>
        <overlayList>
          <overlay name="create_mainInformation_woName" type="vform">
            <label>create_mainInformation_woName</label>
            <root name="create_mainInformation_woNameGrid_vCentering" type="elvltstck">
              <height>100%</height>
              <membersMargin>5</membersMargin>
              <visible type="varPath">
                <variablePathList>
                  <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/uivar_model</variablePath>
                  <variablePath>doc_ds_ws.details_nameValue/permMethod_permView_By_Action_On_Order____Create__and___NameView</variablePath>
                </variablePathList>
              </visible>
              <width>100%</width>
              <elementList>
                <element name="details_nameValueHeader" type="elhdr">
                  <label>Name Value: Main Information</label>
                  <showValidation>true</showValidation>
                  <style>CwFOT</style>
                </element>
                <element name="create_mainInformation_woNameGrid" type="elgrd">
                  <colWidths>195,195</colWidths>
                  <numOfCols>2</numOfCols>
                  <useDefaultHeight>true</useDefaultHeight>
                  <width>390px</width>
                  <elementList>
                    <element name="name1" type="elfld">
                      <columnSpan>1</columnSpan>
                      <optional type="varPath">
                        <variablePathList>
                          <variablePath>dtype_com.conceptwave.system.Boolean/leaf_FALSE</variablePath>
                        </variablePathList>
                      </optional>
                      <variable type="varPath">
                        <variablePathList>
                          <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/uivar_model</variablePath>
                          <variablePath>doc_ds_ws.details_nameValue/leaf_name</variablePath>
                        </variablePathList>
                      </variable>
                    </element>
                    <element name="value1" type="elfld">
                      <columnSpan>1</columnSpan>
                      <variable type="varPath">
                        <variablePathList>
                          <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/uivar_model</variablePath>
                          <variablePath>doc_ds_ws.details_nameValue/leaf_value</variablePath>
                        </variablePathList>
                      </variable>
                    </element>
                  </elementList>
                </element>
              </elementList>
            </root>
          </overlay>
          <overlay name="create_mainInformation_wName_VOIP_HSI" type="vform">
            <label>create_mainInformation_wName_VOIP_HSI</label>
            <root name="create_mainInformation_wName_VOIP_HSIGrid_vCentering" type="elvltstck">
              <height>100%</height>
              <membersMargin>5</membersMargin>
              <visible type="varPath">
                <variablePathList>
                  <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/uivar_model</variablePath>
                  <variablePath>doc_ds_ws.details_nameValue/permMethod_permView_By_Action_On_Order____Create__and_Name_and_Parent____VOIP__or__HSI_View</variablePath>
                </variablePathList>
              </visible>
              <width>100%</width>
              <elementList>
                <element name="details_nameValueHeader" type="elhdr">
                  <label>Name Value: Main Information</label>
                  <showValidation>true</showValidation>
                  <style>CwFOT</style>
                </element>
                <element name="create_mainInformation_wName_VOIP_HSIGrid" type="elgrd">
                  <colWidths>195,195</colWidths>
                  <numOfCols>2</numOfCols>
                  <useDefaultHeight>true</useDefaultHeight>
                  <width>390px</width>
                  <elementList>
                    <element name="name3" type="elfld">
                      <columnSpan>1</columnSpan>
                      <editable type="varPath">
                        <variablePathList>
                          <variablePath>dtype_com.conceptwave.system.Boolean/leaf_FALSE</variablePath>
                        </variablePathList>
                      </editable>
                      <optional type="varPath">
                        <variablePathList>
                          <variablePath>dtype_com.conceptwave.system.Boolean/leaf_FALSE</variablePath>
                        </variablePathList>
                      </optional>
                      <variable type="varPath">
                        <variablePathList>
                          <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/uivar_model</variablePath>
                          <variablePath>doc_ds_ws.details_nameValue/leaf_name</variablePath>
                        </variablePathList>
                      </variable>
                    </element>
                    <element name="value3" type="elfld">
                      <columnSpan>1</columnSpan>
                      <variable type="varPath">
                        <variablePathList>
                          <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/uivar_model</variablePath>
                          <variablePath>doc_ds_ws.details_nameValue/leaf_value</variablePath>
                        </variablePathList>
                      </variable>
                    </element>
                  </elementList>
                </element>
              </elementList>
            </root>
          </overlay>
          <overlay name="create_mainInformation_wName_not_VOIP_HSI" type="vform">
            <label>create_mainInformation_wName_not_VOIP_HSI</label>
            <root name="create_mainInformation_wName_not_VOIP_HSIGrid_vCentering" type="elvltstck">
              <height>100%</height>
              <membersMargin>5</membersMargin>
              <visible type="varPath">
                <variablePathList>
                  <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/uivar_model</variablePath>
                  <variablePath>doc_ds_ws.details_nameValue/permMethod_permView_By_Action_On_Order____Create__and_Name_and_Parent_____VOIP__and__HSI_View</variablePath>
                </variablePathList>
              </visible>
              <width>100%</width>
              <elementList>
                <element name="details_nameValueHeader" type="elhdr">
                  <label>Name Value: Main Information</label>
                  <showValidation>true</showValidation>
                  <style>CwFOT</style>
                </element>
                <element name="create_mainInformation_wName_not_VOIP_HSIGrid" type="elgrd">
                  <colWidths>195,195</colWidths>
                  <numOfCols>2</numOfCols>
                  <useDefaultHeight>true</useDefaultHeight>
                  <width>390px</width>
                  <elementList>
                    <element name="name4" type="elfld">
                      <columnSpan>1</columnSpan>
                      <editable type="varPath">
                        <variablePathList>
                          <variablePath>dtype_com.conceptwave.system.Boolean/leaf_FALSE</variablePath>
                        </variablePathList>
                      </editable>
                      <optional type="varPath">
                        <variablePathList>
                          <variablePath>dtype_com.conceptwave.system.Boolean/leaf_FALSE</variablePath>
                        </variablePathList>
                      </optional>
                      <variable type="varPath">
                        <variablePathList>
                          <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/uivar_model</variablePath>
                          <variablePath>doc_ds_ws.details_nameValue/leaf_name</variablePath>
                        </variablePathList>
                      </variable>
                    </element>
                    <element name="value4" type="elfld">
                      <columnSpan>1</columnSpan>
                      <variable type="varPath">
                        <variablePathList>
                          <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/uivar_model</variablePath>
                          <variablePath>doc_ds_ws.details_nameValue/leaf_value</variablePath>
                        </variablePathList>
                      </variable>
                    </element>
                  </elementList>
                </element>
              </elementList>
            </root>
          </overlay>
          <overlay name="update_mainInformation" type="vform">
            <label>update_mainInformation</label>
            <root name="update_mainInformationGrid_vCentering" type="elvltstck">
              <height>100%</height>
              <membersMargin>5</membersMargin>
              <visible type="varPath">
                <variablePathList>
                  <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/uivar_model</variablePath>
                  <variablePath>doc_ds_ws.details_nameValue/permMethod_permView_By_Action_On_Order____Update_View</variablePath>
                </variablePathList>
              </visible>
              <width>100%</width>
              <elementList>
                <element name="details_nameValueHeader" type="elhdr">
                  <label>Name Value: Main Information</label>
                  <showValidation>true</showValidation>
                  <style>CwFOT</style>
                </element>
                <element name="update_mainInformationGrid" type="elgrd">
                  <colWidths>195,195</colWidths>
                  <numOfCols>2</numOfCols>
                  <useDefaultHeight>true</useDefaultHeight>
                  <width>390px</width>
                  <elementList>
                    <element name="name5" type="elfld">
                      <columnSpan>1</columnSpan>
                      <editable type="varPath">
                        <variablePathList>
                          <variablePath>dtype_com.conceptwave.system.Boolean/leaf_FALSE</variablePath>
                        </variablePathList>
                      </editable>
                      <optional type="varPath">
                        <variablePathList>
                          <variablePath>dtype_com.conceptwave.system.Boolean/leaf_FALSE</variablePath>
                        </variablePathList>
                      </optional>
                      <variable type="varPath">
                        <variablePathList>
                          <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/uivar_model</variablePath>
                          <variablePath>doc_ds_ws.details_nameValue/leaf_name</variablePath>
                        </variablePathList>
                      </variable>
                    </element>
                    <element name="value5" type="elfld">
                      <columnSpan>1</columnSpan>
                      <editable type="varPath">
                        <variablePathList>
                          <variablePath>dtype_com.conceptwave.system.Boolean/leaf_FALSE</variablePath>
                        </variablePathList>
                      </editable>
                      <variable type="varPath">
                        <variablePathList>
                          <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/uivar_model</variablePath>
                          <variablePath>doc_ds_ws.details_nameValue/leaf_value</variablePath>
                        </variablePathList>
                      </variable>
                    </element>
                  </elementList>
                </element>
              </elementList>
            </root>
          </overlay>
          <overlay name="default_mainInformation" type="vform">
            <label>default_mainInformation</label>
            <root name="default_mainInformationGrid_vCentering" type="elvltstck">
              <height>100%</height>
              <membersMargin>5</membersMargin>
              <visible type="varPath">
                <variablePathList>
                  <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/uivar_model</variablePath>
                  <variablePath>doc_ds_ws.details_nameValue/permMethod_permView_By_Default__when_Action_On_Order_is_null_View</variablePath>
                </variablePathList>
              </visible>
              <width>100%</width>
              <elementList>
                <element name="details_nameValueHeader" type="elhdr">
                  <label>Name Value: Main Information</label>
                  <showValidation>true</showValidation>
                  <style>CwFOT</style>
                </element>
                <element name="default_mainInformationGrid" type="elgrd">
                  <colWidths>195,195</colWidths>
                  <numOfCols>2</numOfCols>
                  <useDefaultHeight>true</useDefaultHeight>
                  <width>390px</width>
                  <elementList>
                    <element name="name6" type="elfld">
                      <columnSpan>1</columnSpan>
                      <editable type="varPath">
                        <variablePathList>
                          <variablePath>dtype_com.conceptwave.system.Boolean/leaf_FALSE</variablePath>
                        </variablePathList>
                      </editable>
                      <optional type="varPath">
                        <variablePathList>
                          <variablePath>dtype_com.conceptwave.system.Boolean/leaf_FALSE</variablePath>
                        </variablePathList>
                      </optional>
                      <variable type="varPath">
                        <variablePathList>
                          <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/uivar_model</variablePath>
                          <variablePath>doc_ds_ws.details_nameValue/leaf_name</variablePath>
                        </variablePathList>
                      </variable>
                    </element>
                    <element name="value6" type="elfld">
                      <columnSpan>1</columnSpan>
                      <editable type="varPath">
                        <variablePathList>
                          <variablePath>dtype_com.conceptwave.system.Boolean/leaf_FALSE</variablePath>
                        </variablePathList>
                      </editable>
                      <variable type="varPath">
                        <variablePathList>
                          <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/uivar_model</variablePath>
                          <variablePath>doc_ds_ws.details_nameValue/leaf_value</variablePath>
                        </variablePathList>
                      </variable>
                    </element>
                  </elementList>
                </element>
              </elementList>
            </root>
          </overlay>
          <overlay name="Default" type="exov">
            <base>ui_com.conceptwave.system.DocumentUserInterface/frmui_Forms/exov_Default</base>
            <extends>ui_com.conceptwave.system.DocumentUserInterface/frmui_Forms/exov_Default</extends>
            <label>Default</label>
            <overrideList>
              <override name="Forms" type="eltset">
                <dataSource type="varPath">
                  <variablePathList>
                    <variablePath>ui_com.conceptwave.system.DocumentWithTabsUserInterface/leaf_selectedTab</variablePath>
                  </variablePathList>
                </dataSource>
                <tabChangedMethod type="varPath">
                  <variablePathList>
                    <variablePath>ui_com.conceptwave.system.DocumentWithTabsUserInterface/uimthd_onTabChanged</variablePath>
                  </variablePathList>
                </tabChangedMethod>
                <elementList>
                  <element name="create_mainInformation_woNameTab" type="eltab">
                    <formReference type="varPath">
                      <variablePathList>
                        <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/frmui_Forms</variablePath>
                        <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/frmui_Forms/vform_create_mainInformation_woName</variablePath>
                      </variablePathList>
                    </formReference>
                    <label>Name Value: Main Information</label>
                    <validationDisplay>Static Icons</validationDisplay>
                    <visible type="varPath">
                      <variablePathList>
                        <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/uivar_model</variablePath>
                        <variablePath>doc_ds_ws.details_nameValue/permMethod_permView_By_Action_On_Order____Create__and___NameView</variablePath>
                      </variablePathList>
                    </visible>
                  </element>
                  <element name="create_mainInformation_wName_VOIP_HSITab" type="eltab">
                    <formReference type="varPath">
                      <variablePathList>
                        <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/frmui_Forms</variablePath>
                        <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/frmui_Forms/vform_create_mainInformation_wName_VOIP_HSI</variablePath>
                      </variablePathList>
                    </formReference>
                    <label>Name Value: Main Information</label>
                    <validationDisplay>Static Icons</validationDisplay>
                    <visible type="varPath">
                      <variablePathList>
                        <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/uivar_model</variablePath>
                        <variablePath>doc_ds_ws.details_nameValue/permMethod_permView_By_Action_On_Order____Create__and_Name_and_Parent____VOIP__or__HSI_View</variablePath>
                      </variablePathList>
                    </visible>
                  </element>
                  <element name="create_mainInformation_wName_not_VOIP_HSITab" type="eltab">
                    <formReference type="varPath">
                      <variablePathList>
                        <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/frmui_Forms</variablePath>
                        <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/frmui_Forms/vform_create_mainInformation_wName_not_VOIP_HSI</variablePath>
                      </variablePathList>
                    </formReference>
                    <label>Name Value: Main Information</label>
                    <validationDisplay>Static Icons</validationDisplay>
                    <visible type="varPath">
                      <variablePathList>
                        <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/uivar_model</variablePath>
                        <variablePath>doc_ds_ws.details_nameValue/permMethod_permView_By_Action_On_Order____Create__and_Name_and_Parent_____VOIP__and__HSI_View</variablePath>
                      </variablePathList>
                    </visible>
                  </element>
                  <element name="update_mainInformationTab" type="eltab">
                    <formReference type="varPath">
                      <variablePathList>
                        <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/frmui_Forms</variablePath>
                        <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/frmui_Forms/vform_update_mainInformation</variablePath>
                      </variablePathList>
                    </formReference>
                    <label>Name Value: Main Information</label>
                    <validationDisplay>Static Icons</validationDisplay>
                    <visible type="varPath">
                      <variablePathList>
                        <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/uivar_model</variablePath>
                        <variablePath>doc_ds_ws.details_nameValue/permMethod_permView_By_Action_On_Order____Update_View</variablePath>
                      </variablePathList>
                    </visible>
                  </element>
                  <element name="default_mainInformationTab" type="eltab">
                    <formReference type="varPath">
                      <variablePathList>
                        <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/frmui_Forms</variablePath>
                        <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/frmui_Forms/vform_default_mainInformation</variablePath>
                      </variablePathList>
                    </formReference>
                    <label>Name Value: Main Information</label>
                    <validationDisplay>Static Icons</validationDisplay>
                    <visible type="varPath">
                      <variablePathList>
                        <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/uivar_model</variablePath>
                        <variablePath>doc_ds_ws.details_nameValue/permMethod_permView_By_Default__when_Action_On_Order_is_null_View</variablePath>
                      </variablePathList>
                    </visible>
                  </element>
                </elementList>
              </override>
            </overrideList>
          </overlay>
          <overlay name="Menu" type="exov">
            <base>ui_com.conceptwave.system.DocumentUserInterface/frmui_Forms/vform_Menu</base>
            <extends>ui_com.conceptwave.system.DocumentUserInterface/frmui_Forms/vform_Menu</extends>
            <label>Menu</label>
            <overrideList>
              <override name="cwfSave" type="eldel"/>
              <override name="hl1" type="elext">
                <elementList>
                  <element name="validate" type="elmnu">
                    <menuAccel type="mAccelP">
                      <keyName>V</keyName>
                      <keys enum-type="menuAccelFlag">ALT_KEY</keys>
                    </menuAccel>
                    <clickMethod type="varPath">
                      <variablePathList>
                        <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/usrActionMethod_validateMeth_menu</variablePath>
                      </variablePathList>
                    </clickMethod>
                    <icon>/cwf/complete.gif</icon>
                    <menuType>5</menuType>
                    <showDown>true</showDown>
                    <showRollOver>true</showRollOver>
                    <visible type="varPath">
                      <variablePathList>
                        <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/permMethod_validateMethView</variablePath>
                      </variablePathList>
                    </visible>
                  </element>
                  <element name="submitOrder" type="elmnu">
                    <clickMethod type="varPath">
                      <variablePathList>
                        <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/usrActionMethod_submitOrder_menu</variablePath>
                      </variablePathList>
                    </clickMethod>
                    <label>Submit Order (To Granite)</label>
                    <menuType>5</menuType>
                    <showDown>true</showDown>
                    <showRollOver>true</showRollOver>
                    <visible type="varPath">
                      <variablePathList>
                        <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/permMethod_viewByActionOnOrderCreateForOMAndHomeView</variablePath>
                      </variablePathList>
                    </visible>
                  </element>
                  <element name="updateOrder" type="elmnu">
                    <clickMethod type="varPath">
                      <variablePathList>
                        <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/usrActionMethod_updateOrder_menu</variablePath>
                      </variablePathList>
                    </clickMethod>
                    <label>Update Order (To Granite)</label>
                    <menuType>5</menuType>
                    <showDown>true</showDown>
                    <showRollOver>true</showRollOver>
                    <visible type="varPath">
                      <variablePathList>
                        <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/permMethod_viewByActionOnOrderUpdateForOMView</variablePath>
                      </variablePathList>
                    </visible>
                  </element>
                  <element name="addSP_VOIP" type="elmnu">
                    <clickMethod type="varPath">
                      <variablePathList>
                        <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/usrActionMethod_addSP_VOIP_menu</variablePath>
                      </variablePathList>
                    </clickMethod>
                    <label>Add Service Parameters: &quot;VOIP&quot;</label>
                    <menuType>5</menuType>
                    <showDown>true</showDown>
                    <showRollOver>true</showRollOver>
                    <visible type="varPath">
                      <variablePathList>
                        <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/permMethod_viewByActionOnOrderCreateForOMAndHomeView1</variablePath>
                      </variablePathList>
                    </visible>
                  </element>
                  <element name="addSP_HSI" type="elmnu">
                    <clickMethod type="varPath">
                      <variablePathList>
                        <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/usrActionMethod_addSP_HSI_menu</variablePath>
                      </variablePathList>
                    </clickMethod>
                    <label>Add Service Parameters: &quot;HSI&quot;</label>
                    <menuType>5</menuType>
                    <showDown>true</showDown>
                    <showRollOver>true</showRollOver>
                    <visible type="varPath">
                      <variablePathList>
                        <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/permMethod_viewByActionOnOrderCreateForOMAndHomeView2</variablePath>
                      </variablePathList>
                    </visible>
                  </element>
                  <element name="addSP" type="elmnu">
                    <clickMethod type="varPath">
                      <variablePathList>
                        <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/usrActionMethod_addSP_menu</variablePath>
                      </variablePathList>
                    </clickMethod>
                    <label>Add Further Service Parameters</label>
                    <menuType>5</menuType>
                    <showDown>true</showDown>
                    <showRollOver>true</showRollOver>
                    <visible type="varPath">
                      <variablePathList>
                        <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/permMethod_viewByActionOnOrderCreateForOMAndHomeView3</variablePath>
                      </variablePathList>
                    </visible>
                  </element>
                  <element name="addNV" type="elmnu">
                    <clickMethod type="varPath">
                      <variablePathList>
                        <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/usrActionMethod_addNV_menu</variablePath>
                      </variablePathList>
                    </clickMethod>
                    <label>Add &quot;Name Value&quot;</label>
                    <menuType>5</menuType>
                    <showDown>true</showDown>
                    <showRollOver>true</showRollOver>
                    <visible type="varPath">
                      <variablePathList>
                        <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/permMethod_viewByActionOnOrderCreateForSPAndHomeView</variablePath>
                      </variablePathList>
                    </visible>
                  </element>
                  <element name="deleteSP" type="elmnu">
                    <clickMethod type="varPath">
                      <variablePathList>
                        <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/usrActionMethod_deleteSP_menu</variablePath>
                      </variablePathList>
                    </clickMethod>
                    <label>Delete &quot;Service Parameters&quot;</label>
                    <menuType>5</menuType>
                    <showDown>true</showDown>
                    <showRollOver>true</showRollOver>
                    <visible type="varPath">
                      <variablePathList>
                        <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/permMethod_viewByActionOnOrderCreateForSPAndHomeView1</variablePath>
                      </variablePathList>
                    </visible>
                  </element>
                  <element name="deleteNV" type="elmnu">
                    <clickMethod type="varPath">
                      <variablePathList>
                        <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/usrActionMethod_deleteNV_menu</variablePath>
                      </variablePathList>
                    </clickMethod>
                    <label>Delete &quot;Name Value&quot;</label>
                    <menuType>5</menuType>
                    <showDown>true</showDown>
                    <showRollOver>true</showRollOver>
                    <visible type="varPath">
                      <variablePathList>
                        <variablePath>doc_ds_ws.details_nameValue/ui_UserInterface/permMethod_viewByActionOnOrderCreateForNVView</variablePath>
                      </variablePathList>
                    </visible>
                  </element>
                </elementList>
              </override>
            </overrideList>
          </overlay>
        </overlayList>
      </vform>
    </vformList>
    <methodList>
      <method name="runTrigger" type="usrActionMethod">
        <script><![CDATA[
          this.cw$super_runTrigger();
          Global.runContentDisplayScript(this, "displayScript");
        ]]></script>
      </method>
      <method name="validateMeth" type="usrActionMethod">
        <allowInvalidObject>true</allowInvalidObject>
        <autosave>true</autosave>
        <script>return 1;</script>
      </method>
      <method name="validateMeth_menu" type="usrActionMethod">
        <allowInvalidObject>true</allowInvalidObject>
        <confirmation>doc_ds_ws.details_nameValue/ui_UserInterface/action_cwAutosaveConfirmation</confirmation>
        <validate>true</validate>
        <script><![CDATA[
          var result = this.validateMeth();
          Global.runContentDisplayScript(this, "displayScript");
          return result;
        ]]></script>
      </method>
      <method name="cwAutosaveConfirmation" type="action">
        <valueType>dtype_com.conceptwave.system.String</valueType>
        <script><![CDATA[
          if (!this.isValid && Global.isAutosaveEnabled() && !this.model.readonly && this.model.isSavable()) {
            return "UU0256:YN";
          }
          return null;
        ]]></script>
      </method>
      <method name="validateMethView" type="permMethod">
        <script><![CDATA[
          // SCRIPT MIGRATION: if null, return false
          var $v=
          !this.model._isSearch() && this.model._getNoDBOperations();
          if ($v == null)
             return false;
          else return $v;
        ]]></script>
      </method>
      <method name="submitOrder" type="usrActionMethod">
        <allowInvalidObject>true</allowInvalidObject>
        <autosave>true</autosave>
        <script><![CDATA[
          var document = this.model;

                var debug = "[MENU ITEM: SUBMIT ORDER]";
                // Submit the order to Granite
                var order = document.order;


                // [b] Validation of the 'STC Order'
                var validation = null;
                var exceptionMessage = "";
                try {

                      var checkHSI = false;
                      var checkVOIP = false;
                      var checkAttributeCSC = false;
                      var checkAttributeRatePlan = false;
                      var checkAttributeSuppCodes = false;
                      var checkAttributeDownStreamBW = false;
                      var checkAttributeUpStreamBW = false;

                      // [a] Validation on the services of the order
                      var services = order.serviceParametersList;
                      if (services != null && services.count > 0) {
                            for (var p = 0; p < services.count; p++) {
                                  var service = services[p].serviceParameters.serviceType;
                                  if (service == "FTTH_VOIP") {
                                        checkVOIP = true;
                                        var attributes = services[p].nameValueList;
                                        if (attributes != null && attributes.count > 0) {
                                              for (var v = 0; v < attributes.count; v++) {
                                                    var attribute = attributes[v].nameValue.name;
                                                    var value = attributes[v].nameValue.value;
                                                    if (attribute == "CSC" && value != null && value.trim() != "") checkAttributeCSC = true;
                                                    if (attribute == "Rate Plan" && value != null && value.trim() != "") checkAttributeRatePlan = true;
                                                    if (attribute == "SUPP_CODES" && value != null && value.trim() != "") checkAttributeSuppCodes = true;
                                              }
                                        }
                                  }
                                  if (service == "FTTH_HSI") {
                                        checkHSI = true;
                                        var attributes = services[p].nameValueList;
                                        if (attributes != null && attributes.count > 0) {
                                              for (var v = 0; v < attributes.count; v++) {
                                                    var attribute = attributes[v].nameValue.name;
                                                    var value = attributes[v].nameValue.value;
                                                    if (attribute == "DownstreamBandwidth" && value != null && value.trim() != "") checkAttributeDownStreamBW = true;
                                                    if (attribute == "UpstreamBandwidth" && value != null && value.trim() != "") checkAttributeUpStreamBW = true;
                                              }
                                        }
                                  }
                            }
                      }
                      // - check if HSI or VOIP services are included (at least one must be there)
                      if (!checkHSI && !checkVOIP){
                            // Customized exception AE0010:
                            // - Inconsistent request: at least one service, either HSI or VOIP, must be defined!
                            Global.throwException("AE0010");
                      }
                      // - check if VOIP service includes all the mandatory attributes
                      if (checkVOIP && (!checkAttributeCSC || !checkAttributeRatePlan || !checkAttributeSuppCodes)) {
                            // Customized exception AE0011:
                            // - Incosistent request: attributes 'CSC', 'Rate Plan' and 'SUPP_CODES' must be defined for VOIP service!
                            Global.throwException("AE0011");
                      }
                      // - check if HSI service includes all the mandatory attributes
                      if (checkHSI && (!checkAttributeDownStreamBW || !checkAttributeUpStreamBW)) {
                            // Customized exception AE0012:
                            // - Incosistent request: attributes 'DownstreamBandwidth' and 'UpstreamBandwidth' must be defined for HSI service!
                            Global.throwException("AE0012");
                      }

                      validation = order.validate(10, true);
                      if (validation != null) {
          debugPrintln("[" + ds_ws.common_currentDateAsStringDDMMYYYYHH24MISS() + "]" + debug + "FOUND VALIDATIONS ERROR FOR ORDER STC WITH ID: " + order.id + "...");

                            for (var j = 0; j < validation.length; j = j + 2) {
                                  exceptionMessage = exceptionMessage + "[CODE '" + validation[j] + "' MESSAGE '" + validation[j + 1] + "']\n";
                            }


                            var errorMessage = "";
                            if(validation.length > 1) {
                                  errorMessage = (validation[1] == null ? validation[0] : validation[1]);
                            }
                            else if(validation.length > 0) {
                                  errorMessage = validation[0];
                            }
                            // Customized exception AE0003:
                            // - Validation errors found while processing "{0}" with id. "{1}": {2}!
                            Global.throwException(Global.translateText("AE0003", null, ["Order STC", order.orderMessage.orderNumber, errorMessage]));
                      }
                      // Modified the 09.10.2008:
                      // - according to mail of Mick Winters
                      // ["RE: Additional functionality for Expediter passthrough", Thu 10/9/2008 12:52 PM]
                      order.orderMessage.internalOrderStatus = "Order Received";
                      order.save();
          debugPrintln("[" + ds_ws.common_currentDateAsStringDDMMYYYYHH24MISS() + "]" + debug + "ORDER MADE PERSISTENT ON THE DB...");

                      // Modified the 09.10.2008:
                      // - according to mail of Mick Winters
                      // ["RE: Additional functionality for Expediter passthrough", Thu 10/9/2008 12:52 PM]
                      order.orderMessage.internalOrderStatus = "Waiting for Granite Response";
                      order.save();

                      var pid = Process.startProcess("processSTC:mainSTCProcess", order.id);
          debugPrintln("[" + ds_ws.common_currentDateAsStringDDMMYYYYHH24MISS() + "]" + debug + "Started Process with pid " + pid);

                      Global.commitTransaction("ORDER");

                      var countSleeping = 0;

                      var processCompleted = false;
                      while(!processCompleted) {
                            // pauses 5 seconds and checks the status of the process ...
          //debugPrintln("[" + ds_ws.common_currentDateAsStringDDMMYYYYHH24MISS() + "]" + debug + "Sleeping before checking the status of Process " + pid);
                            processSTC.timeDelay("GRANITE_RESPONSE_DELAY_TIME");

                            processCompleted = processSTC.checkIfProcessIsCompleted(pid);
                            countSleeping++;
                      }

                      // reload the order because modified by the process
                      var cworderId = order.id;
                      order = Order.getOrderById(cworderId);

                      if (order.orderACK.Status == "SUCCESS") {
                            // Modified the 09.10.2008:
                            // - according to mail of Mick Winters
                            // ["RE: Additional functionality for Expediter passthrough", Thu 10/9/2008 12:52 PM]
                            order.orderMessage.internalOrderStatus = "Granite Call SUCCESSFUL";
                            order.orderMessage.circuitStatus = "ORDERED";
                            order.orderMessage.orderStatus = "READY";
                            order.save();
          debugPrintln("[" + ds_ws.common_currentDateAsStringDDMMYYYYHH24MISS() + "]" + "<SUBMIT ORDER> WITH 'ORDER #': '" + order.orderMessage.orderNumber + "' WORKED CORRECTLY!");
                            Global.logDebug("<SUBMIT ORDER> WITH 'ORDER #': '" + order.orderMessage.orderNumber + "' WORKED CORRECTLY!");

                            var message = "ACTION: SUBMIT ORDER (TO GRANITE):\nORDER # '" + order.orderMessage.orderNumber + "' WORKED CORRECTLY!";
                            Global.showUserMessage(message);

                            Global.setApplication("ds_ws:report");
                      }
                      else{
                            // Modified the 09.10.2008:
                            // - according to mail of Mick Winters
                            // ["RE: Additional functionality for Expediter passthrough", Thu 10/9/2008 12:52 PM]
                            order.orderMessage.internalOrderStatus = "Order Rejected By Granite";
                            order.save();
          debugPrintln("[" + ds_ws.common_currentDateAsStringDDMMYYYYHH24MISS() + "]" + "<SUBMIT ORDER> WITH 'ORDER #': '" + order.orderMessage.orderNumber + "' NOT STORED... Order Rejected By Granite [" + order.orderACK.ErrorDescription + "]...");
                            Global.logDebug("<SUBMIT ORDER> WITH 'ORDER #': '" + order.orderMessage.orderNumber + "' NOT STORED... Order Rejected By Granite [" + order.orderACK.ErrorDescription + "]...");

                            var message = "ACTION: SUBMIT ORDER (TO GRANITE):\nORDER # '" + order.orderMessage.orderNumber + "' NOT STORED... Order Rejected By Granite [" + order.orderACK.ErrorDescription + "]...";
                            Global.showUserMessage(message);
                      }
                }
                catch(exc){
          debugPrintln("[" + ds_ws.common_currentDateAsStringDDMMYYYYHH24MISS() + "]" + debug + "CATCHED ERROR MAKING THE ORDER PERSISTENT ON THE DB [" + exc.message + "]...");
                      var message = "ACTION: SUBMIT ORDER (TO GRANITE):\n" + exc.message + "\n" + exceptionMessage;
                      Global.showUserMessage(message);
                }
        ]]></script>
      </method>
      <method name="submitOrder_menu" type="usrActionMethod">
        <allowInvalidObject>true</allowInvalidObject>
        <confirmation>doc_ds_ws.details_nameValue/ui_UserInterface/action_cwAutosaveConfirmation</confirmation>
        <validate>true</validate>
        <script><![CDATA[
          var result = this.submitOrder();
          Global.runContentDisplayScript(this, "displayScript");
          return result;
        ]]></script>
      </method>
      <method name="viewByActionOnOrderCreateForOMAndHomeView" type="permMethod">
        <reference>permMethod_ds_ws.viewByActionOnOrderCreateForOMAndHomeView</reference>
      </method>
      <method name="updateOrder" type="usrActionMethod">
        <allowInvalidObject>true</allowInvalidObject>
        <autosave>true</autosave>
        <script><![CDATA[
          var document = this.model;

                var debug = "[MENU ITEM: UPDATE ORDER]";
                // Update the order to Granite
                var order = document.order;

                // [b] Validation of the 'STC Order'
                var validation = null;
                var exceptionMessage = "";
                try {

                      validation = order.validate(10, true);
                      if (validation != null) {
          debugPrintln("[" + ds_ws.common_currentDateAsStringDDMMYYYYHH24MISS() + "]" + debug + "FOUND VALIDATIONS ERROR FOR ORDER STC WITH ID: " + order.id + "...");

                            for (var j = 0; j < validation.length; j = j + 2) {
                                  exceptionMessage = exceptionMessage + "[CODE '" + validation[j] + "' MESSAGE '" + validation[j + 1] + "']\n";
                            }

                            var errorMessage = "";
                            if(validation.length > 1) {
                                  errorMessage = (validation[1] == null ? validation[0] : validation[1]);
                            }
                            else if(validation.length > 0) {
                                  errorMessage = validation[0];
                            }
                            // Customized exception AE0003:
                            // - Validation errors found while processing "{0}" with id. "{1}": {2}!
                            Global.throwException(Global.translateText("AE0003", null, ["Order STC", order.orderMessage.orderNumber, errorMessage]));
                      }
                      // Modified the 09.10.2008:
                      // - according to mail of Mick Winters
                      // ["RE: Additional functionality for Expediter passthrough", Thu 10/9/2008 12:52 PM]
                      order.orderMessage.internalOrderStatus = "Order Received";
                      order.save();
          debugPrintln("[" + ds_ws.common_currentDateAsStringDDMMYYYYHH24MISS() + "]" + debug + "ORDER MADE PERSISTENT ON THE DB...");

                      // Modified the 09.10.2008:
                      // - according to mail of Mick Winters
                      // ["RE: Additional functionality for Expediter passthrough", Thu 10/9/2008 12:52 PM]
                      order.orderMessage.internalOrderStatus = "Waiting for Granite Response";
                      order.save();

                      var pid = Process.startProcess("processSTC:mainSTCProcess", order.id);
          debugPrintln("[" + ds_ws.common_currentDateAsStringDDMMYYYYHH24MISS() + "]" + debug + "Started Process with pid " + pid);

                      Global.commitTransaction("ORDER");

                      var countSleeping = 0;

                      var processCompleted = false;
                      while(!processCompleted) {
                            // sleeps 5 seconds and checks the status of the process ...
          //debugPrintln("[" + ds_ws.common_currentDateAsStringDDMMYYYYHH24MISS() + "]" + debug + "Sleeping before checking the status of Process " + pid);
                            processSTC.timeDelay("GRANITE_RESPONSE_DELAY_TIME");

                            processCompleted = processSTC.checkIfProcessIsCompleted(pid);
                            countSleeping++;
                      }

                      // reload the order because modified by the process
                      var cworderId = order.id;
                      order = Order.getOrderById(cworderId);

                      if (order.orderACK.Status == "SUCCESS") {
                            // Modified the 09.10.2008:
                            // - according to mail of Mick Winters
                            // ["RE: Additional functionality for Expediter passthrough", Thu 10/9/2008 12:52 PM]
                            order.orderMessage.internalOrderStatus = "Granite Call SUCCESSFUL";
                            order.save();
          debugPrintln("[" + ds_ws.common_currentDateAsStringDDMMYYYYHH24MISS() + "]" + "<UPDATE ORDER> WITH 'ORDER #': '" + order.orderMessage.orderNumber + "' WORKED CORRECTLY!");
                            Global.logDebug("<UPDATE ORDER> WITH 'ORDER #': '" + order.orderMessage.orderNumber + "' WORKED CORRECTLY!");

                            var message = "ACTION: UPDATE ORDER (TO GRANITE):\nORDER # '" + order.orderMessage.orderNumber + "' WORKED CORRECTLY!";
                            Global.showUserMessage(message);

                            Global.setApplication("ds_ws:report");
                      }
                      else{
                            // Modified the 09.10.2008:
                            // - according to mail of Mick Winters
                            // ["RE: Additional functionality for Expediter passthrough", Thu 10/9/2008 12:52 PM]
                            order.orderMessage.internalOrderStatus = "Order Rejected By Granite";
                            order.save();
          debugPrintln("[" + ds_ws.common_currentDateAsStringDDMMYYYYHH24MISS() + "]" + "<UPDATE ORDER> WITH 'ORDER #': '" + order.orderMessage.orderNumber + "' NOT STORED... Order Rejected By Granite [" + order.orderACK.ErrorDescription + "]...");
                            Global.logDebug("<UPDATE ORDER> WITH 'ORDER #': '" + order.orderMessage.orderNumber + "' NOT STORED... Order Rejected By Granite [" + order.orderACK.ErrorDescription + "]...");

                            var message = "ACTION: UPDATE ORDER (TO GRANITE):\nORDER # '" + order.orderMessage.orderNumber + "' NOT STORED... Order Rejected By Granite [" + order.orderACK.ErrorDescription + "]...";
                            Global.showUserMessage(message);
                      }
                }
                catch(exc){
          debugPrintln("[" + ds_ws.common_currentDateAsStringDDMMYYYYHH24MISS() + "]" + debug + "CATCHED ERROR MAKING THE ORDER PERSISTENT ON THE DB [" + exc.message + "]...");
                      var message = "ACTION: UPDATE ORDER (TO GRANITE):\n" + exc.message + "\n" + exceptionMessage;
                      Global.showUserMessage(message);
                }
        ]]></script>
      </method>
      <method name="updateOrder_menu" type="usrActionMethod">
        <allowInvalidObject>true</allowInvalidObject>
        <confirmation>doc_ds_ws.details_nameValue/ui_UserInterface/action_cwAutosaveConfirmation</confirmation>
        <validate>true</validate>
        <script><![CDATA[
          var result = this.updateOrder();
          Global.runContentDisplayScript(this, "displayScript");
          return result;
        ]]></script>
      </method>
      <method name="viewByActionOnOrderUpdateForOMView" type="permMethod">
        <reference>permMethod_ds_ws.viewByActionOnOrderUpdateForOMView</reference>
      </method>
      <method name="addSP_VOIP" type="usrActionMethod">
        <allowInvalidObject>true</allowInvalidObject>
        <autosave>true</autosave>
        <script><![CDATA[
          var document = this.model;

                // Retrieve the document defined in the pop-up window
          //      if (this.confirmObject != null) {

          //            var sp = this.confirmObject.listSP;
          //            if (sp == "VOIP") {

                            // Check if the Service Parameters requested is already defined
                            var order = document.order;
                            for (var k = 0; order.serviceParametersList != null && k < order.serviceParametersList.count; k++) {
                                  if (order.serviceParametersList[k].serviceParameters.serviceType == "FTTH_VOIP") {
                                        Global.throwException("Action not performed: the order already contains a 'VOIP' service!");
                                  }
                            }

                            // Add a VOIP "Service Parameters" item
                            if (order.serviceParametersList == null){
                                  order.addItem("serviceParametersList");
                            }
                            var item = order.serviceParametersList.newInstance();
                            item.serviceParameters.serviceType = "FTTH_VOIP";
                            item.serviceParameters.creationDate = new Date();
                            // Setting the Service Date as today + 7 days
                            var today = new Date();
                            var todayMS = today.getTime();
                            var weekMS = 604800000;
                            item.serviceParameters.serviceDate = new Date(todayMS + weekMS);

                            // Adding the attributes for VOIP
                            if (item.nameValueList == null){
                                  item.addItem("nameValueList");
                            }
                            var attributeCSC = item.nameValueList.newInstance();
                            attributeCSC.nameValue.name = "CSC";
                            var attributeRatePlan = item.nameValueList.newInstance();
                            attributeRatePlan.nameValue.name = "Rate Plan";
                            var attributeSuppCodes = item.nameValueList.newInstance();
                            attributeSuppCodes.nameValue.name = "SUPP_CODES";
          //            }
          //            else if (sp == "HSI") {

                            // Add a VOIP "Service Parameters" item
          //                  var order = document.order;
          //                  if (order.serviceParametersList == null){
          //                        order.addItem("serviceParametersList");
          //                  }
          //                  var item = order.serviceParametersList.newInstance();
          //                  item.serviceParameters.serviceType = "HSI";
                            // Adding the attributes for HSI
          //                  if (item.nameValueList == null){
          //                        item.addItem("nameValueList");
          //                  }
          //                  var attributeDownStreamBW = item.nameValueList.newInstance();
          //                  attributeDownStreamBW.nameValue.name = "DownstreamBandwidth";
          //                  var attributeUpStreamBW = item.nameValueList.newInstance();
          //                  attributeUpStreamBW.nameValue.name = "UpstreamBandwidth";
          //            }
          //            else{

                            // Add a generic "Service Parameters" item
          //                  var order = document.order;
          //                  if (order.serviceParametersList == null){
          //                        order.addItem("serviceParametersList");
          //                  }
          //                  order.serviceParametersList.newInstance();
          //            }
          //      }
        ]]></script>
      </method>
      <method name="addSP_VOIP_menu" type="usrActionMethod">
        <allowInvalidObject>true</allowInvalidObject>
        <confirmation>doc_ds_ws.details_nameValue/ui_UserInterface/action_cwAutosaveConfirmation</confirmation>
        <validate>true</validate>
        <script><![CDATA[
          var result = this.addSP_VOIP();
          Global.runContentDisplayScript(this, "displayScript");
          return result;
        ]]></script>
      </method>
      <method name="viewByActionOnOrderCreateForOMAndHomeView1" type="permMethod">
        <reference>permMethod_ds_ws.viewByActionOnOrderCreateForOMAndHomeView</reference>
      </method>
      <method name="addSP_HSI" type="usrActionMethod">
        <allowInvalidObject>true</allowInvalidObject>
        <autosave>true</autosave>
        <script><![CDATA[
          var document = this.model;

                // Retrieve the document defined in the pop-up window
          //      if (this.confirmObject != null) {

          //            var sp = this.confirmObject.listSP;
          //            if (sp == "VOIP") {

                            // Add a VOIP "Service Parameters" item
          //                  var order = document.order;
          //                  if (order.serviceParametersList == null){
          //                        order.addItem("serviceParametersList");
          //                  }
          //                  var item = order.serviceParametersList.newInstance();
          //                  item.serviceParameters.serviceType = "VOIP";
                            // Adding the attributes for VOIP
          //                  if (item.nameValueList == null){
          //                        item.addItem("nameValueList");
          //                  }
          //                  var attributeCSC = item.nameValueList.newInstance();
          //                  attributeCSC.nameValue.name = "CSC";
          //                  var attributeRatePlan = item.nameValueList.newInstance();
          //                  attributeRatePlan.nameValue.name = "Rate Plan";
          //                  var attributeSuppCodes = item.nameValueList.newInstance();
          //                  attributeSuppCodes.nameValue.name = "SUPP_CODES";
          //            }
          //            else if (sp == "HSI") {

                            // Check if the Service Parameters requested is already defined
                            var order = document.order;
                            for (var k = 0; order.serviceParametersList != null && k < order.serviceParametersList.count; k++) {
                                  if (order.serviceParametersList[k].serviceParameters.serviceType == "FTTH_HSI") {
                                        Global.throwException("Action not performed: the order already contains a 'HSI' service!");
                                  }
                            }

                            // Add a HSI "Service Parameters" item
                            if (order.serviceParametersList == null){
                                  order.addItem("serviceParametersList");
                            }
                            var item = order.serviceParametersList.newInstance();
                            item.serviceParameters.serviceType = "FTTH_HSI";
                            item.serviceParameters.creationDate = new Date();
                            // Setting the Service Date as today + 7 days
                            var today = new Date();
                            var todayMS = today.getTime();
                            var weekMS = 604800000;
                            item.serviceParameters.serviceDate = new Date(todayMS + weekMS);

                            // Adding the attributes for HSI
                            if (item.nameValueList == null){
                                  item.addItem("nameValueList");
                            }
                            var attributeDownStreamBW = item.nameValueList.newInstance();
                            attributeDownStreamBW.nameValue.name = "DownstreamBandwidth";
                            var attributeUpStreamBW = item.nameValueList.newInstance();
                            attributeUpStreamBW.nameValue.name = "UpstreamBandwidth";
          //            }
          //            else{

                            // Add a generic "Service Parameters" item
          //                  var order = document.order;
          //                  if (order.serviceParametersList == null){
          //                        order.addItem("serviceParametersList");
          //                  }
          //                  order.serviceParametersList.newInstance();
          //            }
          //      }
        ]]></script>
      </method>
      <method name="addSP_HSI_menu" type="usrActionMethod">
        <allowInvalidObject>true</allowInvalidObject>
        <confirmation>doc_ds_ws.details_nameValue/ui_UserInterface/action_cwAutosaveConfirmation</confirmation>
        <validate>true</validate>
        <script><![CDATA[
          var result = this.addSP_HSI();
          Global.runContentDisplayScript(this, "displayScript");
          return result;
        ]]></script>
      </method>
      <method name="viewByActionOnOrderCreateForOMAndHomeView2" type="permMethod">
        <reference>permMethod_ds_ws.viewByActionOnOrderCreateForOMAndHomeView</reference>
      </method>
      <method name="addSP" type="usrActionMethod">
        <allowInvalidObject>true</allowInvalidObject>
        <autosave>true</autosave>
        <script><![CDATA[
          var document = this.model;

                // Retrieve the document defined in the pop-up window
          //      if (this.confirmObject != null) {

          //            var sp = this.confirmObject.listSP;
          //            if (sp == "VOIP") {

                            // Add a VOIP "Service Parameters" item
          //                  var order = document.order;
          //                  if (order.serviceParametersList == null){
          //                        order.addItem("serviceParametersList");
          //                  }
          //                  var item = order.serviceParametersList.newInstance();
          //                  item.serviceParameters.serviceType = "VOIP";
                            // Adding the attributes for VOIP
          //                  if (item.nameValueList == null){
          //                        item.addItem("nameValueList");
          //                  }
          //                  var attributeCSC = item.nameValueList.newInstance();
          //                  attributeCSC.nameValue.name = "CSC";
          //                  var attributeRatePlan = item.nameValueList.newInstance();
          //                  attributeRatePlan.nameValue.name = "Rate Plan";
          //                  var attributeSuppCodes = item.nameValueList.newInstance();
          //                  attributeSuppCodes.nameValue.name = "SUPP_CODES";
          //            }
          //            else if (sp == "HSI") {

                            // Add a VOIP "Service Parameters" item
          //                  var order = document.order;
          //                  if (order.serviceParametersList == null){
          //                        order.addItem("serviceParametersList");
          //                  }
          //                  var item = order.serviceParametersList.newInstance();
          //                  item.serviceParameters.serviceType = "HSI";
                            // Adding the attributes for HSI
          //                  if (item.nameValueList == null){
          //                        item.addItem("nameValueList");
          //                  }
          //                  var attributeDownStreamBW = item.nameValueList.newInstance();
          //                  attributeDownStreamBW.nameValue.name = "DownstreamBandwidth";
          //                  var attributeUpStreamBW = item.nameValueList.newInstance();
          //                  attributeUpStreamBW.nameValue.name = "UpstreamBandwidth";
          //            }
          //            else{

                            // Add a generic "Service Parameters" item
                            var order = document.order;
                            if (order.serviceParametersList == null){
                                  order.addItem("serviceParametersList");
                            }
                            var item = order.serviceParametersList.newInstance();
                            item.serviceParameters.creationDate = new Date();
                            // Setting the Service Date as today + 7 days
                            var today = new Date();
                            var todayMS = today.getTime();
                            var weekMS = 604800000;
                            item.serviceParameters.serviceDate = new Date(todayMS + weekMS);
          //            }
          //      }
        ]]></script>
      </method>
      <method name="addSP_menu" type="usrActionMethod">
        <allowInvalidObject>true</allowInvalidObject>
        <confirmation>doc_ds_ws.details_nameValue/ui_UserInterface/action_cwAutosaveConfirmation</confirmation>
        <validate>true</validate>
        <script><![CDATA[
          var result = this.addSP();
          Global.runContentDisplayScript(this, "displayScript");
          return result;
        ]]></script>
      </method>
      <method name="viewByActionOnOrderCreateForOMAndHomeView3" type="permMethod">
        <reference>permMethod_ds_ws.viewByActionOnOrderCreateForOMAndHomeView</reference>
      </method>
      <method name="addNV" type="usrActionMethod">
        <allowInvalidObject>true</allowInvalidObject>
        <autosave>true</autosave>
        <script><![CDATA[
          var document = this.model;

                // Add a "Name Value" item
                var order = document.order;

                var position = -1;
                for (var k = 0; k < order.serviceParametersList.count; k++) {
                      if (order.serviceParametersList[k].serviceParameters.id == document.id) {
                            position = k;
                            break;
                      }
                }

                if (order.serviceParametersList[position].nameValueList == null){
                      order.serviceParametersList[position].addItem("nameValueList");
                }

                order.serviceParametersList[position].nameValueList.newInstance();

          //      order.save();
        ]]></script>
      </method>
      <method name="addNV_menu" type="usrActionMethod">
        <allowInvalidObject>true</allowInvalidObject>
        <confirmation>doc_ds_ws.details_nameValue/ui_UserInterface/action_cwAutosaveConfirmation</confirmation>
        <validate>true</validate>
        <script><![CDATA[
          var result = this.addNV();
          Global.runContentDisplayScript(this, "displayScript");
          return result;
        ]]></script>
      </method>
      <method name="viewByActionOnOrderCreateForSPAndHomeView" type="permMethod">
        <reference>permMethod_ds_ws.viewByActionOnOrderCreateForSPAndHomeView</reference>
      </method>
      <method name="deleteSP" type="usrActionMethod">
        <allowInvalidObject>true</allowInvalidObject>
        <autosave>true</autosave>
        <script><![CDATA[
          var document = this.model;

                // Delete a "Service Parameters" item
                var order = document.order;

                var list = document.parentOrderItem.allChildren;

                if (list != null && list.length > 0) {
                      for (var k = 0; k < list.length; k++) {
                            list[k].deleteItem();
                      }
                }

          //      order.save();

                Global.setCurrentObject(order);
        ]]></script>
      </method>
      <method name="deleteSP_menu" type="usrActionMethod">
        <allowInvalidObject>true</allowInvalidObject>
        <confirmation>doc_ds_ws.details_nameValue/ui_UserInterface/action_cwAutosaveConfirmation</confirmation>
        <validate>true</validate>
        <script><![CDATA[
          var result = this.deleteSP();
          Global.runContentDisplayScript(this, "displayScript");
          return result;
        ]]></script>
      </method>
      <method name="viewByActionOnOrderCreateForSPAndHomeView1" type="permMethod">
        <reference>permMethod_ds_ws.viewByActionOnOrderCreateForSPAndHomeView</reference>
      </method>
      <method name="deleteNV" type="usrActionMethod">
        <allowInvalidObject>true</allowInvalidObject>
        <autosave>true</autosave>
        <script><![CDATA[
          var document = this.model;

                // Delete a "Name Value" item
                var order = document.order;

                var parent = null;
                for (var k = 0; k < order.serviceParametersList.count; k++) {
                      for (var j = 0; j < order.serviceParametersList[k].nameValueList.count; j++) {
                            if (order.serviceParametersList[k].nameValueList[j].nameValue.id == document.id) {
                                  parent = order.serviceParametersList[k].serviceParameters;
                                  break;
                            }
                      }
                }

                // Those attributes are mandatory for VOIP
                if (parent != null && parent.serviceType == "FTTH_VOIP") {
                      if (document.name == "CSC" ||
                            document.name == "SUPP_CODES" ||
                            document.name == "Rate Plan"){
                            Global.throwException("Action not performed: attribute mandatory for 'VOIP' service!");
                      }
                }

                // Those attributes are mandatory for HSI
                if (parent != null && parent.serviceType == "FTTH_HSI") {
                      if (document.name == "UpstreamBandwidth" ||
                            document.name == "DownstreamBandwidth"){
                            Global.throwException("Action not performed: attribute mandatory for 'HSI' service!");
                      }
                }

                document.deleteItem();

          //      order.save();

                Global.setCurrentObject(order);
        ]]></script>
      </method>
      <method name="deleteNV_menu" type="usrActionMethod">
        <allowInvalidObject>true</allowInvalidObject>
        <confirmation>doc_ds_ws.details_nameValue/ui_UserInterface/action_cwAutosaveConfirmation</confirmation>
        <validate>true</validate>
        <script><![CDATA[
          var result = this.deleteNV();
          Global.runContentDisplayScript(this, "displayScript");
          return result;
        ]]></script>
      </method>
      <method name="viewByActionOnOrderCreateForNVView" type="permMethod">
        <reference>permMethod_ds_ws.viewByActionOnOrderCreateForNVView</reference>
      </method>
    </methodList>
  </UserInterface>
</document>