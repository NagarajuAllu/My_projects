<?xml version="1.0" encoding="UTF-8" ?>
<script filenameHash="d5116108739705d507402cac372cf338" versionHash="eccbc87e4b5ce2fe28308fd9f2a7baf3" name="ds_ws.searchAllOrderMessageForResubmitInHoldOrder">
  <guid>{0a03d836-fb85-5adf-3617-7f34f13dc62a}</guid>
  <label>Search All Order Message For Re-submit &quot;In Hold&quot; Order</label>
  <metaVersion>3</metaVersion>
  <script><![CDATA[
    var debug = "[SEARCH ALL ORDER MESSAGE FOR RE-SUBMIT 'IN HOLD' ORDER] ";
    var result = null;

    // Creating the date for one week ago
    var today = new Date();
    var todayMS = today.getTime();
    var weekMS = 604800000;
    var oneWeekAgo = Calendar.formatDate(new Date(todayMS - weekMS), "dd.MM.yyyy");

    // Definition of the SQL script to be executed
    var sql = "select distinct * from STC_ORDER_MESSAGE om where " +
                  "om.INHOLD = 1 and " +
                  "om.INTERNALORDERSTATUS in ('Granite Call FAILURE', 'Granite Communication FAILED', 'Order Rejected By Granite') and " +
                  "om.CREATIONDATE <= to_date('" + oneWeekAgo + "', 'dd.MM.yyyy')";
    var output = Global.runSQLQuery("ORDER",
                                                  "ds_ws:details_orderMessage",
                                                  99999,
                                                  null,
                                                  sql);

    if (output != null && output.size > 0) {
    debugPrintln("[" + ds_ws.common_currentDateAsStringDDMMYYYYHH24MISS() + "]" + debug + " RETRIEVED # " + output.size + " RECORDS FROM STC_ORDER_MESSAGE TABLE...")
                result = new Array();

    //            var ratio = output.totalSize / output.size;
    //            for (var j = 0; j < ratio; j++) {
                      // [A]. Increase the page load
                      output.loadPage(0);
                      // [B]. Fetch the current page
                      for (var i=0; i < output.size; i++){
                            result = result.concat(output[i]);
                      }
     //           }
          }
          else{
    debugPrintln("[" + ds_ws.common_currentDateAsStringDDMMYYYYHH24MISS() + "]" + debug + " RETRIEVED NO RECORDS FROM STC_ORDER_MESSAGE TABLE...")
          }

          return result;
  ]]></script>
</script>