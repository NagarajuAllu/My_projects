<?xml version="1.0" encoding="UTF-8" ?>
<script filenameHash="53a53e4df9d457d6713b3d448f38c96b" versionHash="a87ff679a2f3e71d9181a67b7542122c" name="ds_ws.setValueForNVPair">
  <label>Set Value for NV Pair</label>
  <metaVersion>4</metaVersion>
  <parameterList>
    <parameter name="orders" type="rifp">
      <array>true</array>
      <type>order_ds_ws.default_orderSTC_HOME</type>
    </parameter>
    <parameter name="nvPairToCheck" type="rifp">
      <type>dtype_com.conceptwave.system.String</type>
    </parameter>
    <parameter name="newValue" type="rifp">
      <type>dtype_com.conceptwave.system.String</type>
    </parameter>
  </parameterList>
  <script><![CDATA[
    for (var s = 0; s < orders.length; s++) {
        if(orders[s].serviceParametersList != null) {
            for (var p = 0; p < orders[s].serviceParametersList.length; p++) {
                var nvFound = false;
                if(orders[s].serviceParametersList[p].nameValueList != null) {
                    for (var n =0; n < orders[s].serviceParametersList[p].nameValueList.length && !nvFound; n++) {
                        var nvPairName = orders[s].serviceParametersList[p].nameValueList[n].nameValue.name;
                        var nvPairValue = orders[s].serviceParametersList[p].nameValueList[n].nameValue.value;
                        if(nvPairName == nvPairToCheck) {
                            nvFound = true;
                            if(ds_ws.common_isNullValue(nvPairValue)) {
                                // setting value to the first value found because null
                                orders[s].serviceParametersList[p].nameValueList[n].nameValue.value = newValue;
    debugPrintln("[" + ds_ws.common_currentDateAsStringDDMMYYYYHH24MISS() + "][setValueForNVPair] update orders[" + s + "].serviceParametersList[" + p + "].nameValueList [" + n + "] = " + orders[s].serviceParametersList[p].nameValueList[n].nameValue.toXML());
                            }
                        }
                    }
                }
                if(!nvFound) {
                    // not found so adding the NV pair
                    var newNVPair = orders[s].createOrderItemByPath("serviceParametersList." + (p + 1) +
                                                                    ".nameValueList." + (orders[s].serviceParametersList[p].nameValueList != null ? (orders[s].serviceParametersList[p].nameValueList.length + 1) : 1) +
                                                                    ".nameValue");
                    newNVPair.name = nvPairToCheck;
                    newNVPair.value = newValue;
    debugPrintln("[" + ds_ws.common_currentDateAsStringDDMMYYYYHH24MISS() + "][setValueForNVPair] add orders[" + s + "].serviceParametersList[" + p + "] = " + newNVPair.toXML());
                }
            }
        }
    }

    return orders;
  ]]></script>
</script>