<?xml version="1.0" encoding="UTF-8" ?>
<script filenameHash="dfddc446c199e50d18957b8c4bdac221" versionHash="eccbc87e4b5ce2fe28308fd9f2a7baf3" name="ifGranite_jms.manageGraniteMsg_WorkOrderStatusUpdate">
  <guid>{0241bfa1-d2dc-3330-46a8-60d69a522f96}</guid>
  <highlight>22</highlight>
  <label>[17.12.2008] Manage Granite Message: Work Order Status Update [JMS]</label>
  <metaVersion>3</metaVersion>
  <parameterList>
    <parameter name="input" type="rifp">
      <type>nmeta_com.conceptwave.system.Object</type>
    </parameter>
  </parameterList>
  <script><![CDATA[
    var debug = "[MANAGE GRANITE MESSAGE VIA 'JMS': WORK ORDER STATUS UPDATE] ";
    debugPrintln("[" + ds_ws.common_currentDateAsStringDDMMYYYYHH24MISS() + "]" + debug + "START...");
    debugPrintln("[" + ds_ws.common_currentDateAsStringDDMMYYYYHH24MISS() + "]" + debug + "INPUT: " + (input != null ? input.toXML() : "") + "...");
          var logMsgId = UserProfile.getMsgLogId();

          if (input != null) {
                ds_ws.storeReceivedGraniteEvent(input, "WOSU");

                var userData1 = input.orderNumber;
                var userData2 = null;
                if (input.businessUnit == "Home") {
                      if(input.parentOrderNumber == null){
                            var orderMessage = ds_ws.searchOrderMessageHomeByOrderNumber(input.orderNumber);
                            if (orderMessage != null && orderMessage.parentOrderNumber != null) {
                                  // - replacing the Order Number
                                  userData1 = orderMessage.parentOrderNumber;
                                  userData2 = input.orderNumber;
                            }
                      }
                      else {
                          userData1 = input.parentOrderNumber;
                          userData2 = input.orderNumber;
                      }
                }

                // Modified on 20.03.2010:
                // - add the 'Order #' to the CWMESSAGELOG table in the USER_DATA1;
    debugPrintln("[" + ds_ws.common_currentDateAsStringDDMMYYYYHH24MISS() + "]" + debug + "Adding UserData_1 = " + userData1 + " to id = " + logMsgId);
                if(logMsgId != null && logMsgId > 0) {
                      UserProfile.setMsgLogData(userData1, userData2, null, logMsgId);
                }
          }
          else {
    debugPrintln("[" + ds_ws.common_currentDateAsStringDDMMYYYYHH24MISS() + "]" + debug + "- WARNING - INTERFACE NOT INVOKED: INPUT IS NULL...");
          }

    debugPrintln("[" + ds_ws.common_currentDateAsStringDDMMYYYYHH24MISS() + "]" + debug + "END...");
  ]]></script>
</script>